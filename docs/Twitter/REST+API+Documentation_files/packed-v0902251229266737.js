var Prototype={Version:"1.6.0",Browser:{IE:!!(window.attachEvent&&!window.opera),Opera:!!window.opera,WebKit:navigator.userAgent.indexOf("AppleWebKit/")>-1,Gecko:navigator.userAgent.indexOf("Gecko")>-1&&navigator.userAgent.indexOf("KHTML")==-1,MobileSafari:!!navigator.userAgent.match(/Apple.*Mobile.*Safari/)},BrowserFeatures:{XPath:!!document.evaluate,ElementExtensions:!!window.HTMLElement,SpecificElementExtensions:document.createElement("div").__proto__&&document.createElement("div").__proto__!==document.createElement("form").__proto__},ScriptFragment:"<script[^>]*>([\\S\\s]*?)<\/script>",JSONFilter:/^\/\*-secure-([\s\S]*)\*\/\s*$/,emptyFunction:function(){},K:function(A){return A}};if(Prototype.Browser.MobileSafari){Prototype.BrowserFeatures.SpecificElementExtensions=false}if(Prototype.Browser.WebKit){Prototype.BrowserFeatures.XPath=false}var Class={create:function(){var E=null,D=$A(arguments);if(Object.isFunction(D[0])){E=D.shift()}function A(){this.initialize.apply(this,arguments)}Object.extend(A,Class.Methods);A.superclass=E;A.subclasses=[];if(E){var B=function(){};B.prototype=E.prototype;A.prototype=new B;E.subclasses.push(A)}for(var C=0;C<D.length;C++){A.addMethods(D[C])}if(!A.prototype.initialize){A.prototype.initialize=Prototype.emptyFunction}A.prototype.constructor=A;return A}};Class.Methods={addMethods:function(G){var C=this.superclass&&this.superclass.prototype;var B=Object.keys(G);if(!Object.keys({toString:true}).length){B.push("toString","valueOf")}for(var A=0,D=B.length;A<D;A++){var F=B[A],E=G[F];if(C&&Object.isFunction(E)&&E.argumentNames().first()=="$super"){var H=E,E=Object.extend((function(I){return function(){return C[I].apply(this,arguments)}})(F).wrap(H),{valueOf:function(){return H},toString:function(){return H.toString()}})}this.prototype[F]=E}return this}};var Abstract={};Object.extend=function(A,C){for(var B in C){A[B]=C[B]}return A};Object.extend(Object,{inspect:function(A){try{if(A===undefined){return"undefined"}if(A===null){return"null"}return A.inspect?A.inspect():A.toString()}catch(B){if(B instanceof RangeError){return"..."}throw B}},toJSON:function(A){var C=typeof A;switch(C){case"undefined":case"function":case"unknown":return ;case"boolean":return A.toString()}if(A===null){return"null"}if(A.toJSON){return A.toJSON()}if(Object.isElement(A)){return }var B=[];for(var E in A){var D=Object.toJSON(A[E]);if(D!==undefined){B.push(E.toJSON()+": "+D)}}return"{"+B.join(", ")+"}"},toQueryString:function(A){return $H(A).toQueryString()},toHTML:function(A){return A&&A.toHTML?A.toHTML():String.interpret(A)},keys:function(A){var B=[];for(var C in A){B.push(C)}return B},values:function(B){var A=[];for(var C in B){A.push(B[C])}return A},clone:function(A){return Object.extend({},A)},isElement:function(A){return A&&A.nodeType==1},isArray:function(A){return A&&A.constructor===Array},isHash:function(A){return A instanceof Hash},isFunction:function(A){return typeof A=="function"},isString:function(A){return typeof A=="string"},isNumber:function(A){return typeof A=="number"},isUndefined:function(A){return typeof A=="undefined"}});Object.extend(Function.prototype,{argumentNames:function(){var A=this.toString().match(/^[\s\(]*function[^(]*\((.*?)\)/)[1].split(",").invoke("strip");return A.length==1&&!A[0]?[]:A},bind:function(){if(arguments.length<2&&arguments[0]===undefined){return this}var A=this,C=$A(arguments),B=C.shift();return function(){return A.apply(B,C.concat($A(arguments)))}},bindAsEventListener:function(){var A=this,C=$A(arguments),B=C.shift();return function(D){return A.apply(B,[D||window.event].concat(C))}},curry:function(){if(!arguments.length){return this}var A=this,B=$A(arguments);return function(){return A.apply(this,B.concat($A(arguments)))}},delay:function(){var A=this,B=$A(arguments),C=B.shift()*1000;return window.setTimeout(function(){return A.apply(A,B)},C)},wrap:function(B){var A=this;return function(){return B.apply(this,[A.bind(this)].concat($A(arguments)))}},methodize:function(){if(this._methodized){return this._methodized}var A=this;return this._methodized=function(){return A.apply(null,[this].concat($A(arguments)))}}});Function.prototype.defer=Function.prototype.delay.curry(0.01);Date.prototype.toJSON=function(){return'"'+this.getUTCFullYear()+"-"+(this.getUTCMonth()+1).toPaddedString(2)+"-"+this.getUTCDate().toPaddedString(2)+"T"+this.getUTCHours().toPaddedString(2)+":"+this.getUTCMinutes().toPaddedString(2)+":"+this.getUTCSeconds().toPaddedString(2)+'Z"'};var Try={these:function(){var C;for(var B=0,D=arguments.length;B<D;B++){var A=arguments[B];try{C=A();break}catch(E){}}return C}};RegExp.prototype.match=RegExp.prototype.test;RegExp.escape=function(A){return String(A).replace(/([.*+?^=!:${}()|[\]\/\\])/g,"\\$1")};var PeriodicalExecuter=Class.create({initialize:function(B,A){this.callback=B;this.frequency=A;this.currentlyExecuting=false;this.registerCallback()},registerCallback:function(){this.timer=setInterval(this.onTimerEvent.bind(this),this.frequency*1000)},execute:function(){this.callback(this)},stop:function(){if(!this.timer){return }clearInterval(this.timer);this.timer=null},onTimerEvent:function(){if(!this.currentlyExecuting){try{this.currentlyExecuting=true;this.execute()}finally{this.currentlyExecuting=false}}}});Object.extend(String,{interpret:function(A){return A==null?"":String(A)},specialChar:{"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r","\\":"\\\\"}});Object.extend(String.prototype,{gsub:function(E,C){var A="",D=this,B;C=arguments.callee.prepareReplacement(C);while(D.length>0){if(B=D.match(E)){A+=D.slice(0,B.index);A+=String.interpret(C(B));D=D.slice(B.index+B[0].length)}else{A+=D,D=""}}return A},sub:function(C,A,B){A=this.gsub.prepareReplacement(A);B=B===undefined?1:B;return this.gsub(C,function(D){if(--B<0){return D[0]}return A(D)})},scan:function(B,A){this.gsub(B,A);return String(this)},truncate:function(B,A){B=B||30;A=A===undefined?"...":A;return this.length>B?this.slice(0,B-A.length)+A:String(this)},strip:function(){return this.replace(/^\s+/,"").replace(/\s+$/,"")},stripTags:function(){return this.replace(/<\/?[^>]+>/gi,"")},stripScripts:function(){return this.replace(new RegExp(Prototype.ScriptFragment,"img"),"")},extractScripts:function(){var B=new RegExp(Prototype.ScriptFragment,"img");var A=new RegExp(Prototype.ScriptFragment,"im");return(this.match(B)||[]).map(function(C){return(C.match(A)||["",""])[1]})},evalScripts:function(){return this.extractScripts().map(function(script){return eval(script)})},escapeHTML:function(){var A=arguments.callee;A.text.data=this;return A.div.innerHTML},unescapeHTML:function(){var A=new Element("div");A.innerHTML=this.stripTags();return A.childNodes[0]?(A.childNodes.length>1?$A(A.childNodes).inject("",function(B,C){return B+C.nodeValue}):A.childNodes[0].nodeValue):""},toQueryParams:function(B){var A=this.strip().match(/([^?#]*)(#.*)?$/);if(!A){return{}}return A[1].split(B||"&").inject({},function(E,F){if((F=F.split("="))[0]){var C=decodeURIComponent(F.shift());var D=F.length>1?F.join("="):F[0];if(D!=undefined){D=decodeURIComponent(D)}if(C in E){if(!Object.isArray(E[C])){E[C]=[E[C]]}E[C].push(D)}else{E[C]=D}}return E})},toArray:function(){return this.split("")},succ:function(){return this.slice(0,this.length-1)+String.fromCharCode(this.charCodeAt(this.length-1)+1)},times:function(A){return A<1?"":new Array(A+1).join(this)},camelize:function(){var D=this.split("-"),A=D.length;if(A==1){return D[0]}var C=this.charAt(0)=="-"?D[0].charAt(0).toUpperCase()+D[0].substring(1):D[0];for(var B=1;B<A;B++){C+=D[B].charAt(0).toUpperCase()+D[B].substring(1)}return C},capitalize:function(){return this.charAt(0).toUpperCase()+this.substring(1).toLowerCase()},underscore:function(){return this.gsub(/::/,"/").gsub(/([A-Z]+)([A-Z][a-z])/,"#{1}_#{2}").gsub(/([a-z\d])([A-Z])/,"#{1}_#{2}").gsub(/-/,"_").toLowerCase()},dasherize:function(){return this.gsub(/_/,"-")},inspect:function(B){var A=this.gsub(/[\x00-\x1f\\]/,function(C){var D=String.specialChar[C[0]];return D?D:"\\u00"+C[0].charCodeAt().toPaddedString(2,16)});if(B){return'"'+A.replace(/"/g,'\\"')+'"'}return"'"+A.replace(/'/g,"\\'")+"'"},toJSON:function(){return this.inspect(true)},unfilterJSON:function(A){return this.sub(A||Prototype.JSONFilter,"#{1}")},isJSON:function(){var A=this.replace(/\\./g,"@").replace(/"[^"\\\n\r]*"/g,"");return(/^[,:{}\[\]0-9.\-+Eaeflnr-u \n\r\t]*$/).test(A)},evalJSON:function(sanitize){var json=this.unfilterJSON();try{if(!sanitize||json.isJSON()){return eval("("+json+")")}}catch(e){}throw new SyntaxError("Badly formed JSON string: "+this.inspect())},include:function(A){return this.indexOf(A)>-1},startsWith:function(A){return this.indexOf(A)===0},endsWith:function(A){var B=this.length-A.length;return B>=0&&this.lastIndexOf(A)===B},empty:function(){return this==""},blank:function(){return/^\s*$/.test(this)},interpolate:function(A,B){return new Template(this,B).evaluate(A)}});if(Prototype.Browser.WebKit||Prototype.Browser.IE){Object.extend(String.prototype,{escapeHTML:function(){return this.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")},unescapeHTML:function(){return this.replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">")}})}String.prototype.gsub.prepareReplacement=function(B){if(Object.isFunction(B)){return B}var A=new Template(B);return function(C){return A.evaluate(C)}};String.prototype.parseQuery=String.prototype.toQueryParams;Object.extend(String.prototype.escapeHTML,{div:document.createElement("div"),text:document.createTextNode("")});with(String.prototype.escapeHTML){div.appendChild(text)}var Template=Class.create({initialize:function(A,B){this.template=A.toString();this.pattern=B||Template.Pattern},evaluate:function(A){if(Object.isFunction(A.toTemplateReplacements)){A=A.toTemplateReplacements()}return this.template.gsub(this.pattern,function(D){if(A==null){return""}var F=D[1]||"";if(F=="\\"){return D[2]}var B=A,G=D[3];var E=/^([^.[]+|\[((?:.*?[^\\])?)\])(\.|\[|$)/,D=E.exec(G);if(D==null){return F}while(D!=null){var C=D[1].startsWith("[")?D[2].gsub("\\\\]","]"):D[1];B=B[C];if(null==B||""==D[3]){break}G=G.substring("["==D[3]?D[1].length:D[0].length);D=E.exec(G)}return F+String.interpret(B)}.bind(this))}});Template.Pattern=/(^|.|\r|\n)(#\{(.*?)\})/;var $break={};var Enumerable={each:function(C,B){var A=0;C=C.bind(B);try{this._each(function(E){C(E,A++)})}catch(D){if(D!=$break){throw D}}return this},eachSlice:function(D,C,B){C=C?C.bind(B):Prototype.K;var A=-D,E=[],F=this.toArray();while((A+=D)<F.length){E.push(F.slice(A,A+D))}return E.collect(C,B)},all:function(C,B){C=C?C.bind(B):Prototype.K;var A=true;this.each(function(E,D){A=A&&!!C(E,D);if(!A){throw $break}});return A},any:function(C,B){C=C?C.bind(B):Prototype.K;var A=false;this.each(function(E,D){if(A=!!C(E,D)){throw $break}});return A},collect:function(C,B){C=C?C.bind(B):Prototype.K;var A=[];this.each(function(E,D){A.push(C(E,D))});return A},detect:function(C,B){C=C.bind(B);var A;this.each(function(E,D){if(C(E,D)){A=E;throw $break}});return A},findAll:function(C,B){C=C.bind(B);var A=[];this.each(function(E,D){if(C(E,D)){A.push(E)}});return A},grep:function(D,C,B){C=C?C.bind(B):Prototype.K;var A=[];if(Object.isString(D)){D=new RegExp(D)}this.each(function(F,E){if(D.match(F)){A.push(C(F,E))}});return A},include:function(A){if(Object.isFunction(this.indexOf)){if(this.indexOf(A)!=-1){return true}}var B=false;this.each(function(C){if(C==A){B=true;throw $break}});return B},inGroupsOf:function(B,A){A=A===undefined?null:A;return this.eachSlice(B,function(C){while(C.length<B){C.push(A)}return C})},inject:function(A,C,B){C=C.bind(B);this.each(function(E,D){A=C(A,E,D)});return A},invoke:function(B){var A=$A(arguments).slice(1);return this.map(function(C){return C[B].apply(C,A)})},max:function(C,B){C=C?C.bind(B):Prototype.K;var A;this.each(function(E,D){E=C(E,D);if(A==undefined||E>=A){A=E}});return A},min:function(C,B){C=C?C.bind(B):Prototype.K;var A;this.each(function(E,D){E=C(E,D);if(A==undefined||E<A){A=E}});return A},partition:function(D,B){D=D?D.bind(B):Prototype.K;var C=[],A=[];this.each(function(F,E){(D(F,E)?C:A).push(F)});return[C,A]},pluck:function(B){var A=[];this.each(function(C){A.push(C[B])});return A},reject:function(C,B){C=C.bind(B);var A=[];this.each(function(E,D){if(!C(E,D)){A.push(E)}});return A},sortBy:function(B,A){B=B.bind(A);return this.map(function(D,C){return{value:D,criteria:B(D,C)}}).sort(function(F,E){var D=F.criteria,C=E.criteria;return D<C?-1:D>C?1:0}).pluck("value")},toArray:function(){return this.map()},zip:function(){var B=Prototype.K,A=$A(arguments);if(Object.isFunction(A.last())){B=A.pop()}var C=[this].concat(A).map($A);return this.map(function(E,D){return B(C.pluck(D))})},size:function(){return this.toArray().length},inspect:function(){return"#<Enumerable:"+this.toArray().inspect()+">"}};Object.extend(Enumerable,{map:Enumerable.collect,find:Enumerable.detect,select:Enumerable.findAll,filter:Enumerable.findAll,member:Enumerable.include,entries:Enumerable.toArray,every:Enumerable.all,some:Enumerable.any});function $A(C){if(!C){return[]}if(C.toArray){return C.toArray()}var B=C.length,A=new Array(B);while(B--){A[B]=C[B]}return A}if(Prototype.Browser.WebKit){function $A(C){if(!C){return[]}if(!(Object.isFunction(C)&&C=="[object NodeList]")&&C.toArray){return C.toArray()}var B=C.length,A=new Array(B);while(B--){A[B]=C[B]}return A}}Array.from=$A;Object.extend(Array.prototype,Enumerable);if(!Array.prototype._reverse){Array.prototype._reverse=Array.prototype.reverse}Object.extend(Array.prototype,{_each:function(B){for(var A=0,C=this.length;A<C;A++){B(this[A])}},clear:function(){this.length=0;return this},first:function(){return this[0]},last:function(){return this[this.length-1]},compact:function(){return this.select(function(A){return A!=null})},flatten:function(){return this.inject([],function(B,A){return B.concat(Object.isArray(A)?A.flatten():[A])})},without:function(){var A=$A(arguments);return this.select(function(B){return !A.include(B)})},reverse:function(A){return(A!==false?this:this.toArray())._reverse()},reduce:function(){return this.length>1?this:this[0]},uniq:function(A){return this.inject([],function(D,C,B){if(0==B||(A?D.last()!=C:!D.include(C))){D.push(C)}return D})},intersect:function(A){return this.uniq().findAll(function(B){return A.detect(function(C){return B===C})})},clone:function(){return[].concat(this)},size:function(){return this.length},inspect:function(){return"["+this.map(Object.inspect).join(", ")+"]"},toJSON:function(){var A=[];this.each(function(B){var C=Object.toJSON(B);if(C!==undefined){A.push(C)}});return"["+A.join(", ")+"]"}});if(Object.isFunction(Array.prototype.forEach)){Array.prototype._each=Array.prototype.forEach}if(!Array.prototype.indexOf){Array.prototype.indexOf=function(C,A){A||(A=0);var B=this.length;if(A<0){A=B+A}for(;A<B;A++){if(this[A]===C){return A}}return -1}}if(!Array.prototype.lastIndexOf){Array.prototype.lastIndexOf=function(B,A){A=isNaN(A)?this.length:(A<0?this.length+A:A)+1;var C=this.slice(0,A).reverse().indexOf(B);return(C<0)?C:A-C-1}}Array.prototype.toArray=Array.prototype.clone;function $w(A){if(!Object.isString(A)){return[]}A=A.strip();return A?A.split(/\s+/):[]}if(Prototype.Browser.Opera){Array.prototype.concat=function(){var E=[];for(var B=0,C=this.length;B<C;B++){E.push(this[B])}for(var B=0,C=arguments.length;B<C;B++){if(Object.isArray(arguments[B])){for(var A=0,D=arguments[B].length;A<D;A++){E.push(arguments[B][A])}}else{E.push(arguments[B])}}return E}}Object.extend(Number.prototype,{toColorPart:function(){return this.toPaddedString(2,16)},succ:function(){return this+1},times:function(A){$R(0,this,true).each(A);return this},toPaddedString:function(C,B){var A=this.toString(B||10);return"0".times(C-A.length)+A},toJSON:function(){return isFinite(this)?this.toString():"null"}});$w("abs round ceil floor").each(function(A){Number.prototype[A]=Math[A].methodize()});function $H(A){return new Hash(A)}var Hash=Class.create(Enumerable,(function(){if(function(){var C=0,E=function(F){this.key=F};E.prototype.key="foo";for(var D in new E("bar")){C++}return C>1}()){function B(E){var C=[];for(var D in this._object){var F=this._object[D];if(C.include(D)){continue}C.push(D);var G=[D,F];G.key=D;G.value=F;E(G)}}}else{function B(D){for(var C in this._object){var E=this._object[C],F=[C,E];F.key=C;F.value=E;D(F)}}}function A(C,D){if(Object.isUndefined(D)){return C}return C+"="+encodeURIComponent(String.interpret(D))}return{initialize:function(C){this._object=Object.isHash(C)?C.toObject():Object.clone(C)},_each:B,set:function(C,D){return this._object[C]=D},get:function(C){return this._object[C]},unset:function(C){var D=this._object[C];delete this._object[C];return D},toObject:function(){return Object.clone(this._object)},keys:function(){return this.pluck("key")},values:function(){return this.pluck("value")},index:function(D){var C=this.detect(function(E){return E.value===D});return C&&C.key},merge:function(C){return this.clone().update(C)},update:function(C){return new Hash(C).inject(this,function(D,E){D.set(E.key,E.value);return D})},toQueryString:function(){return this.map(function(E){var D=encodeURIComponent(E.key),C=E.value;if(C&&typeof C=="object"){if(Object.isArray(C)){return C.map(A.curry(D)).join("&")}}return A(D,C)}).join("&")},inspect:function(){return"#<Hash:{"+this.map(function(C){return C.map(Object.inspect).join(": ")}).join(", ")+"}>"},toJSON:function(){return Object.toJSON(this.toObject())},clone:function(){return new Hash(this)}}})());Hash.prototype.toTemplateReplacements=Hash.prototype.toObject;Hash.from=$H;var ObjectRange=Class.create(Enumerable,{initialize:function(C,A,B){this.start=C;this.end=A;this.exclusive=B},_each:function(A){var B=this.start;while(this.include(B)){A(B);B=B.succ()}},include:function(A){if(A<this.start){return false}if(this.exclusive){return A<this.end}return A<=this.end}});var $R=function(C,A,B){return new ObjectRange(C,A,B)};var Ajax={getTransport:function(){return Try.these(function(){return new XMLHttpRequest()},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Microsoft.XMLHTTP")})||false},activeRequestCount:0};Ajax.Responders={responders:[],_each:function(A){this.responders._each(A)},register:function(A){if(!this.include(A)){this.responders.push(A)}},unregister:function(A){this.responders=this.responders.without(A)},dispatch:function(D,B,C,A){this.each(function(E){if(Object.isFunction(E[D])){try{E[D].apply(E,[B,C,A])}catch(F){}}})}};Object.extend(Ajax.Responders,Enumerable);Ajax.Responders.register({onCreate:function(){Ajax.activeRequestCount++},onComplete:function(){Ajax.activeRequestCount--}});Ajax.Base=Class.create({initialize:function(A){this.options={method:"post",asynchronous:true,contentType:"application/x-www-form-urlencoded",encoding:"UTF-8",parameters:"",evalJSON:true,evalJS:true};Object.extend(this.options,A||{});this.options.method=this.options.method.toLowerCase();if(Object.isString(this.options.parameters)){this.options.parameters=this.options.parameters.toQueryParams()}}});Ajax.Request=Class.create(Ajax.Base,{_complete:false,initialize:function($super,B,A){$super(A);this.transport=Ajax.getTransport();this.request(B)},request:function(B){this.url=B;this.method=this.options.method;var D=Object.clone(this.options.parameters);if(!["get","post"].include(this.method)){D._method=this.method;this.method="post"}this.parameters=D;if(D=Object.toQueryString(D)){if(this.method=="get"){this.url+=(this.url.include("?")?"&":"?")+D}else{if(/Konqueror|Safari|KHTML/.test(navigator.userAgent)){D+="&_="}}}try{var A=new Ajax.Response(this);if(this.options.onCreate){this.options.onCreate(A)}Ajax.Responders.dispatch("onCreate",this,A);this.transport.open(this.method.toUpperCase(),this.url,this.options.asynchronous);if(this.options.asynchronous){this.respondToReadyState.bind(this).defer(1)}this.transport.onreadystatechange=this.onStateChange.bind(this);this.setRequestHeaders();this.body=this.method=="post"?(this.options.postBody||D):null;this.transport.send(this.body);if(!this.options.asynchronous&&this.transport.overrideMimeType){this.onStateChange()}}catch(C){this.dispatchException(C)}},onStateChange:function(){var A=this.transport.readyState;if(A>1&&!((A==4)&&this._complete)){this.respondToReadyState(this.transport.readyState)}},setRequestHeaders:function(){var E={"X-Requested-With":"XMLHttpRequest","X-Prototype-Version":Prototype.Version,Accept:"text/javascript, text/html, application/xml, text/xml, */*"};if(this.method=="post"){E["Content-type"]=this.options.contentType+(this.options.encoding?"; charset="+this.options.encoding:"");if(this.transport.overrideMimeType&&(navigator.userAgent.match(/Gecko\/(\d{4})/)||[0,2005])[1]<2005){E.Connection="close"}}if(typeof this.options.requestHeaders=="object"){var C=this.options.requestHeaders;if(Object.isFunction(C.push)){for(var B=0,D=C.length;B<D;B+=2){E[C[B]]=C[B+1]}}else{$H(C).each(function(F){E[F.key]=F.value})}}for(var A in E){this.transport.setRequestHeader(A,E[A])}},success:function(){var A=this.getStatus();return !A||(A>=200&&A<300)},getStatus:function(){try{return this.transport.status||0}catch(A){return 0}},respondToReadyState:function(A){var C=Ajax.Request.Events[A],B=new Ajax.Response(this);if(C=="Complete"){try{this._complete=true;(this.options["on"+B.status]||this.options["on"+(this.success()?"Success":"Failure")]||Prototype.emptyFunction)(B,B.headerJSON)}catch(D){this.dispatchException(D)}var E=B.getHeader("Content-type");if(this.options.evalJS=="force"||(this.options.evalJS&&E&&E.match(/^\s*(text|application)\/(x-)?(java|ecma)script(;.*)?\s*$/i))){this.evalResponse()}}try{(this.options["on"+C]||Prototype.emptyFunction)(B,B.headerJSON);Ajax.Responders.dispatch("on"+C,this,B,B.headerJSON)}catch(D){this.dispatchException(D)}if(C=="Complete"){this.transport.onreadystatechange=Prototype.emptyFunction}},getHeader:function(A){try{return this.transport.getResponseHeader(A)}catch(B){return null}},evalResponse:function(){try{return eval((this.transport.responseText||"").unfilterJSON())}catch(e){this.dispatchException(e)}},dispatchException:function(A){(this.options.onException||Prototype.emptyFunction)(this,A);Ajax.Responders.dispatch("onException",this,A)}});Ajax.Request.Events=["Uninitialized","Loading","Loaded","Interactive","Complete"];Ajax.Response=Class.create({initialize:function(C){this.request=C;var D=this.transport=C.transport,A=this.readyState=D.readyState;if((A>2&&!Prototype.Browser.IE)||A==4){this.status=this.getStatus();this.statusText=this.getStatusText();this.responseText=String.interpret(D.responseText);this.headerJSON=this._getHeaderJSON()}if(A==4){var B=D.responseXML;this.responseXML=B===undefined?null:B;this.responseJSON=this._getResponseJSON()}},status:0,statusText:"",getStatus:Ajax.Request.prototype.getStatus,getStatusText:function(){try{return this.transport.statusText||""}catch(A){return""}},getHeader:Ajax.Request.prototype.getHeader,getAllHeaders:function(){try{return this.getAllResponseHeaders()}catch(A){return null}},getResponseHeader:function(A){return this.transport.getResponseHeader(A)},getAllResponseHeaders:function(){return this.transport.getAllResponseHeaders()},_getHeaderJSON:function(){var A=this.getHeader("X-JSON");if(!A){return null}A=decodeURIComponent(escape(A));try{return A.evalJSON(this.request.options.sanitizeJSON)}catch(B){this.request.dispatchException(B)}},_getResponseJSON:function(){var A=this.request.options;if(!A.evalJSON||(A.evalJSON!="force"&&!(this.getHeader("Content-type")||"").include("application/json"))){return null}try{return this.transport.responseText.evalJSON(A.sanitizeJSON)}catch(B){this.request.dispatchException(B)}}});Ajax.Updater=Class.create(Ajax.Request,{initialize:function($super,A,C,B){this.container={success:(A.success||A),failure:(A.failure||(A.success?null:A))};B=B||{};var D=B.onComplete;B.onComplete=(function(E,F){this.updateContent(E.responseText);if(Object.isFunction(D)){D(E,F)}}).bind(this);$super(C,B)},updateContent:function(D){var C=this.container[this.success()?"success":"failure"],A=this.options;if(!A.evalScripts){D=D.stripScripts()}if(C=$(C)){if(A.insertion){if(Object.isString(A.insertion)){var B={};B[A.insertion]=D;C.insert(B)}else{A.insertion(C,D)}}else{C.update(D)}}if(this.success()){if(this.onComplete){this.onComplete.bind(this).defer()}}}});Ajax.PeriodicalUpdater=Class.create(Ajax.Base,{initialize:function($super,A,C,B){$super(B);this.onComplete=this.options.onComplete;this.frequency=(this.options.frequency||2);this.decay=(this.options.decay||1);this.updater={};this.container=A;this.url=C;this.start()},start:function(){this.options.onComplete=this.updateComplete.bind(this);this.onTimerEvent()},stop:function(){this.updater.options.onComplete=undefined;clearTimeout(this.timer);(this.onComplete||Prototype.emptyFunction).apply(this,arguments)},updateComplete:function(A){if(this.options.decay){this.decay=(A.responseText==this.lastText?this.decay*this.options.decay:1);this.lastText=A.responseText}this.timer=this.onTimerEvent.bind(this).delay(this.decay*this.frequency)},onTimerEvent:function(){this.updater=new Ajax.Updater(this.container,this.url,this.options)}});function $(B){if(arguments.length>1){for(var A=0,D=[],C=arguments.length;A<C;A++){D.push($(arguments[A]))}return D}if(Object.isString(B)){B=document.getElementById(B)}return Element.extend(B)}if(Prototype.BrowserFeatures.XPath){document._getElementsByXPath=function(F,A){var C=[];var E=document.evaluate(F,$(A)||document,null,XPathResult.ORDERED_NODE_SNAPSHOT_TYPE,null);for(var B=0,D=E.snapshotLength;B<D;B++){C.push(Element.extend(E.snapshotItem(B)))}return C}}if(!window.Node){var Node={}}if(!Node.ELEMENT_NODE){Object.extend(Node,{ELEMENT_NODE:1,ATTRIBUTE_NODE:2,TEXT_NODE:3,CDATA_SECTION_NODE:4,ENTITY_REFERENCE_NODE:5,ENTITY_NODE:6,PROCESSING_INSTRUCTION_NODE:7,COMMENT_NODE:8,DOCUMENT_NODE:9,DOCUMENT_TYPE_NODE:10,DOCUMENT_FRAGMENT_NODE:11,NOTATION_NODE:12})}(function(){var A=this.Element;this.Element=function(D,C){C=C||{};D=D.toLowerCase();var B=Element.cache;if(Prototype.Browser.IE&&C.name){D="<"+D+' name="'+C.name+'">';delete C.name;return Element.writeAttribute(document.createElement(D),C)}if(!B[D]){B[D]=Element.extend(document.createElement(D))}return Element.writeAttribute(B[D].cloneNode(false),C)};Object.extend(this.Element,A||{})}).call(window);Element.cache={};Element.Methods={visible:function(A){return $(A).style.display!="none"},toggle:function(A){A=$(A);Element[Element.visible(A)?"hide":"show"](A);return A},hide:function(A){$(A).style.display="none";return A},show:function(A){$(A).style.display="";return A},remove:function(A){A=$(A);A.parentNode.removeChild(A);return A},update:function(A,B){A=$(A);if(B&&B.toElement){B=B.toElement()}if(Object.isElement(B)){return A.update().insert(B)}B=Object.toHTML(B);A.innerHTML=B.stripScripts();B.evalScripts.bind(B).defer();return A},replace:function(B,C){B=$(B);if(C&&C.toElement){C=C.toElement()}else{if(!Object.isElement(C)){C=Object.toHTML(C);var A=B.ownerDocument.createRange();A.selectNode(B);C.evalScripts.bind(C).defer();C=A.createContextualFragment(C.stripScripts())}}B.parentNode.replaceChild(C,B);return B},insert:function(C,E){C=$(C);if(Object.isString(E)||Object.isNumber(E)||Object.isElement(E)||(E&&(E.toElement||E.toHTML))){E={bottom:E}}var D,B,A;for(position in E){D=E[position];position=position.toLowerCase();B=Element._insertionTranslations[position];if(D&&D.toElement){D=D.toElement()}if(Object.isElement(D)){B.insert(C,D);continue}D=Object.toHTML(D);A=C.ownerDocument.createRange();B.initializeRange(C,A);B.insert(C,A.createContextualFragment(D.stripScripts()));D.evalScripts.bind(D).defer()}return C},wrap:function(B,C,A){B=$(B);if(Object.isElement(C)){$(C).writeAttribute(A||{})}else{if(Object.isString(C)){C=new Element(C,A)}else{C=new Element("div",C)}}if(B.parentNode){B.parentNode.replaceChild(C,B)}C.appendChild(B);return C},inspect:function(B){B=$(B);var A="<"+B.tagName.toLowerCase();$H({id:"id",className:"class"}).each(function(F){var E=F.first(),C=F.last();var D=(B[E]||"").toString();if(D){A+=" "+C+"="+D.inspect(true)}});return A+">"},recursivelyCollect:function(A,C){A=$(A);var B=[];while(A=A[C]){if(A.nodeType==1){B.push(Element.extend(A))}}return B},ancestors:function(A){return $(A).recursivelyCollect("parentNode")},descendants:function(A){return $A($(A).getElementsByTagName("*")).each(Element.extend)},firstDescendant:function(A){A=$(A).firstChild;while(A&&A.nodeType!=1){A=A.nextSibling}return $(A)},immediateDescendants:function(A){if(!(A=$(A).firstChild)){return[]}while(A&&A.nodeType!=1){A=A.nextSibling}if(A){return[A].concat($(A).nextSiblings())}return[]},previousSiblings:function(A){return $(A).recursivelyCollect("previousSibling")},nextSiblings:function(A){return $(A).recursivelyCollect("nextSibling")},siblings:function(A){A=$(A);return A.previousSiblings().reverse().concat(A.nextSiblings())},match:function(B,A){if(Object.isString(A)){A=new Selector(A)}return A.match($(B))},up:function(B,D,A){B=$(B);if(arguments.length==1){return $(B.parentNode)}var C=B.ancestors();return D?Selector.findElement(C,D,A):C[A||0]},down:function(B,C,A){B=$(B);if(arguments.length==1){return B.firstDescendant()}var D=B.descendants();return C?Selector.findElement(D,C,A):D[A||0]},previous:function(B,D,A){B=$(B);if(arguments.length==1){return $(Selector.handlers.previousElementSibling(B))}var C=B.previousSiblings();return D?Selector.findElement(C,D,A):C[A||0]},next:function(C,D,B){C=$(C);if(arguments.length==1){return $(Selector.handlers.nextElementSibling(C))}var A=C.nextSiblings();return D?Selector.findElement(A,D,B):A[B||0]},select:function(){var A=$A(arguments),B=$(A.shift());return Selector.findChildElements(B,A)},adjacent:function(){var A=$A(arguments),B=$(A.shift());return Selector.findChildElements(B.parentNode,A).without(B)},identify:function(B){B=$(B);var C=B.readAttribute("id"),A=arguments.callee;if(C){return C}do{C="anonymous_element_"+A.counter++}while($(C));B.writeAttribute("id",C);return C},readAttribute:function(C,A){C=$(C);if(Prototype.Browser.IE){var B=Element._attributeTranslations.read;if(B.values[A]){return B.values[A](C,A)}if(B.names[A]){A=B.names[A]}if(A.include(":")){return(!C.attributes||!C.attributes[A])?null:C.attributes[A].value}}return C.getAttribute(A)},writeAttribute:function(E,C,F){E=$(E);var B={},D=Element._attributeTranslations.write;if(typeof C=="object"){B=C}else{B[C]=F===undefined?true:F}for(var A in B){var C=D.names[A]||A,F=B[A];if(D.values[A]){C=D.values[A](E,F)}if(F===false||F===null){E.removeAttribute(C)}else{if(F===true){E.setAttribute(C,C)}else{E.setAttribute(C,F)}}}return E},getHeight:function(A){return $(A).getDimensions().height},getWidth:function(A){return $(A).getDimensions().width},classNames:function(A){return new Element.ClassNames(A)},hasClassName:function(A,B){if(!(A=$(A))){return }var C=A.className;return(C.length>0&&(C==B||new RegExp("(^|\\s)"+B+"(\\s|$)").test(C)))},addClassName:function(A,B){if(!(A=$(A))){return }if(!A.hasClassName(B)){A.className+=(A.className?" ":"")+B}return A},removeClassName:function(A,B){if(!(A=$(A))){return }A.className=A.className.replace(new RegExp("(^|\\s+)"+B+"(\\s+|$)")," ").strip();return A},toggleClassName:function(A,B){if(!(A=$(A))){return }return A[A.hasClassName(B)?"removeClassName":"addClassName"](B)},cleanWhitespace:function(B){B=$(B);var C=B.firstChild;while(C){var A=C.nextSibling;if(C.nodeType==3&&!/\S/.test(C.nodeValue)){B.removeChild(C)}C=A}return B},empty:function(A){return $(A).innerHTML.blank()},descendantOf:function(D,C){D=$(D),C=$(C);if(D.compareDocumentPosition){return(D.compareDocumentPosition(C)&8)===8}if(D.sourceIndex&&!Prototype.Browser.Opera){var E=D.sourceIndex,B=C.sourceIndex,A=C.nextSibling;if(!A){do{C=C.parentNode}while(!(A=C.nextSibling)&&C.parentNode)}if(A){return(E>B&&E<A.sourceIndex)}}while(D=D.parentNode){if(D==C){return true}}return false},scrollTo:function(A){A=$(A);var B=A.cumulativeOffset();window.scrollTo(B[0],B[1]);return A},getStyle:function(B,C){B=$(B);C=C=="float"?"cssFloat":C.camelize();var D=B.style[C];if(!D){var A=document.defaultView.getComputedStyle(B,null);D=A?A[C]:null}if(C=="opacity"){return D?parseFloat(D):1}return D=="auto"?null:D},getOpacity:function(A){return $(A).getStyle("opacity")},setStyle:function(B,C){B=$(B);var E=B.style,A;if(Object.isString(C)){B.style.cssText+=";"+C;return C.include("opacity")?B.setOpacity(C.match(/opacity:\s*(\d?\.?\d*)/)[1]):B}for(var D in C){if(D=="opacity"){B.setOpacity(C[D])}else{E[(D=="float"||D=="cssFloat")?(E.styleFloat===undefined?"cssFloat":"styleFloat"):D]=C[D]}}return B},setOpacity:function(A,B){A=$(A);A.style.opacity=(B==1||B==="")?"":(B<0.00001)?0:B;return A},getDimensions:function(C){C=$(C);var G=$(C).getStyle("display");if(G!="none"&&G!=null){return{width:C.offsetWidth,height:C.offsetHeight}}var B=C.style;var F=B.visibility;var D=B.position;var A=B.display;B.visibility="hidden";B.position="absolute";B.display="block";var H=C.clientWidth;var E=C.clientHeight;B.display=A;B.position=D;B.visibility=F;return{width:H,height:E}},makePositioned:function(A){A=$(A);var B=Element.getStyle(A,"position");if(B=="static"||!B){A._madePositioned=true;A.style.position="relative";if(window.opera){A.style.top=0;A.style.left=0}}return A},undoPositioned:function(A){A=$(A);if(A._madePositioned){A._madePositioned=undefined;A.style.position=A.style.top=A.style.left=A.style.bottom=A.style.right=""}return A},makeClipping:function(A){A=$(A);if(A._overflow){return A}A._overflow=Element.getStyle(A,"overflow")||"auto";if(A._overflow!=="hidden"){A.style.overflow="hidden"}return A},undoClipping:function(A){A=$(A);if(!A._overflow){return A}A.style.overflow=A._overflow=="auto"?"":A._overflow;A._overflow=null;return A},cumulativeOffset:function(B){var A=0,C=0;do{A+=B.offsetTop||0;C+=B.offsetLeft||0;B=B.offsetParent}while(B);return Element._returnOffset(C,A)},positionedOffset:function(B){var A=0,D=0;do{A+=B.offsetTop||0;D+=B.offsetLeft||0;B=B.offsetParent;if(B){if(B.tagName=="BODY"){break}var C=Element.getStyle(B,"position");if(C=="relative"||C=="absolute"){break}}}while(B);return Element._returnOffset(D,A)},absolutize:function(B){B=$(B);if(B.getStyle("position")=="absolute"){return }var D=B.positionedOffset();var F=D[1];var E=D[0];var C=B.clientWidth;var A=B.clientHeight;B._originalLeft=E-parseFloat(B.style.left||0);B._originalTop=F-parseFloat(B.style.top||0);B._originalWidth=B.style.width;B._originalHeight=B.style.height;B.style.position="absolute";B.style.top=F+"px";B.style.left=E+"px";B.style.width=C+"px";B.style.height=A+"px";return B},relativize:function(A){A=$(A);if(A.getStyle("position")=="relative"){return }A.style.position="relative";var C=parseFloat(A.style.top||0)-(A._originalTop||0);var B=parseFloat(A.style.left||0)-(A._originalLeft||0);A.style.top=C+"px";A.style.left=B+"px";A.style.height=A._originalHeight;A.style.width=A._originalWidth;return A},cumulativeScrollOffset:function(B){var A=0,C=0;do{A+=B.scrollTop||0;C+=B.scrollLeft||0;B=B.parentNode}while(B);return Element._returnOffset(C,A)},getOffsetParent:function(A){if(A.offsetParent){return $(A.offsetParent)}if(A==document.body){return $(A)}while((A=A.parentNode)&&A!=document.body){if(Element.getStyle(A,"position")!="static"){return $(A)}}return $(document.body)},viewportOffset:function(D){var A=0,C=0;var B=D;do{A+=B.offsetTop||0;C+=B.offsetLeft||0;if(B.offsetParent==document.body&&Element.getStyle(B,"position")=="absolute"){break}}while(B=B.offsetParent);B=D;do{if(!Prototype.Browser.Opera||B.tagName=="BODY"){A-=B.scrollTop||0;C-=B.scrollLeft||0}}while(B=B.parentNode);return Element._returnOffset(C,A)},clonePosition:function(B,D){var A=Object.extend({setLeft:true,setTop:true,setWidth:true,setHeight:true,offsetTop:0,offsetLeft:0},arguments[2]||{});D=$(D);var E=D.viewportOffset();B=$(B);var F=[0,0];var C=null;if(Element.getStyle(B,"position")=="absolute"){C=B.getOffsetParent();F=C.viewportOffset()}if(C==document.body){F[0]-=document.body.offsetLeft;F[1]-=document.body.offsetTop}if(A.setLeft){B.style.left=(E[0]-F[0]+A.offsetLeft)+"px"}if(A.setTop){B.style.top=(E[1]-F[1]+A.offsetTop)+"px"}if(A.setWidth){B.style.width=D.offsetWidth+"px"}if(A.setHeight){B.style.height=D.offsetHeight+"px"}return B}};Element.Methods.identify.counter=1;Object.extend(Element.Methods,{getElementsBySelector:Element.Methods.select,childElements:Element.Methods.immediateDescendants});Element._attributeTranslations={write:{names:{className:"class",htmlFor:"for"},values:{}}};if(!document.createRange||Prototype.Browser.Opera){Element.Methods.insert=function(E,G){E=$(E);if(Object.isString(G)||Object.isNumber(G)||Object.isElement(G)||(G&&(G.toElement||G.toHTML))){G={bottom:G}}var D=Element._insertionTranslations,F,B,H,C;for(B in G){F=G[B];B=B.toLowerCase();H=D[B];if(F&&F.toElement){F=F.toElement()}if(Object.isElement(F)){H.insert(E,F);continue}F=Object.toHTML(F);C=((B=="before"||B=="after")?E.parentNode:E).tagName.toUpperCase();if(D.tags[C]){var A=Element._getContentFromAnonymousElement(C,F.stripScripts());if(B=="top"||B=="after"){A.reverse()}A.each(H.insert.curry(E))}else{E.insertAdjacentHTML(H.adjacency,F.stripScripts())}F.evalScripts.bind(F).defer()}return E}}if(Prototype.Browser.Opera){Element.Methods._getStyle=Element.Methods.getStyle;Element.Methods.getStyle=function(A,B){switch(B){case"left":case"top":case"right":case"bottom":if(Element._getStyle(A,"position")=="static"){return null}default:return Element._getStyle(A,B)}};Element.Methods._readAttribute=Element.Methods.readAttribute;Element.Methods.readAttribute=function(A,B){if(B=="title"){return A.title}return Element._readAttribute(A,B)}}else{if(Prototype.Browser.IE){$w("positionedOffset getOffsetParent viewportOffset").each(function(A){Element.Methods[A]=Element.Methods[A].wrap(function(D,C){C=$(C);var B=C.getStyle("position");if(B!="static"){return D(C)}C.setStyle({position:"relative"});var E=D(C);C.setStyle({position:B});return E})});Element.Methods.getStyle=function(A,B){A=$(A);B=(B=="float"||B=="cssFloat")?"styleFloat":B.camelize();var C=A.style[B];if(!C&&A.currentStyle){C=A.currentStyle[B]}if(B=="opacity"){if(C=(A.getStyle("filter")||"").match(/alpha\(opacity=(.*)\)/)){if(C[1]){return parseFloat(C[1])/100}}return 1}if(C=="auto"){if((B=="width"||B=="height")&&(A.getStyle("display")!="none")){return A["offset"+B.capitalize()]+"px"}return null}return C};Element.Methods.setOpacity=function(B,E){function F(G){return G.replace(/alpha\([^\)]*\)/gi,"")}B=$(B);var A=B.currentStyle;if((A&&!A.hasLayout)||(!A&&B.style.zoom=="normal")){B.style.zoom=1}var D=B.getStyle("filter"),C=B.style;if(E==1||E===""){(D=F(D))?C.filter=D:C.removeAttribute("filter");return B}else{if(E<0.00001){E=0}}C.filter=F(D)+"alpha(opacity="+(E*100)+")";return B};Element._attributeTranslations={read:{names:{"class":"className","for":"htmlFor"},values:{_getAttr:function(A,B){return A.getAttribute(B,2)},_getAttrNode:function(A,C){var B=A.getAttributeNode(C);return B?B.value:""},_getEv:function(A,B){var B=A.getAttribute(B);return B?B.toString().slice(23,-2):null},_flag:function(A,B){return $(A).hasAttribute(B)?B:null},style:function(A){return A.style.cssText.toLowerCase()},title:function(A){return A.title}}}};Element._attributeTranslations.write={names:Object.clone(Element._attributeTranslations.read.names),values:{checked:function(A,B){A.checked=!!B},style:function(A,B){A.style.cssText=B?B:""}}};Element._attributeTranslations.has={};$w("colSpan rowSpan vAlign dateTime accessKey tabIndex encType maxLength readOnly longDesc").each(function(A){Element._attributeTranslations.write.names[A.toLowerCase()]=A;Element._attributeTranslations.has[A.toLowerCase()]=A});(function(A){Object.extend(A,{href:A._getAttr,src:A._getAttr,type:A._getAttr,action:A._getAttrNode,disabled:A._flag,checked:A._flag,readonly:A._flag,multiple:A._flag,onload:A._getEv,onunload:A._getEv,onclick:A._getEv,ondblclick:A._getEv,onmousedown:A._getEv,onmouseup:A._getEv,onmouseover:A._getEv,onmousemove:A._getEv,onmouseout:A._getEv,onfocus:A._getEv,onblur:A._getEv,onkeypress:A._getEv,onkeydown:A._getEv,onkeyup:A._getEv,onsubmit:A._getEv,onreset:A._getEv,onselect:A._getEv,onchange:A._getEv})})(Element._attributeTranslations.read.values)}else{if(Prototype.Browser.Gecko&&/rv:1\.8\.0/.test(navigator.userAgent)){Element.Methods.setOpacity=function(A,B){A=$(A);A.style.opacity=(B==1)?0.999999:(B==="")?"":(B<0.00001)?0:B;return A}}else{if(Prototype.Browser.WebKit){Element.Methods.setOpacity=function(A,B){A=$(A);A.style.opacity=(B==1||B==="")?"":(B<0.00001)?0:B;if(B==1){if(A.tagName=="IMG"&&A.width){A.width++;A.width--}else{try{var D=document.createTextNode(" ");A.appendChild(D);A.removeChild(D)}catch(C){}}}return A};Element.Methods.cumulativeOffset=function(B){var A=0,C=0;do{A+=B.offsetTop||0;C+=B.offsetLeft||0;if(B.offsetParent==document.body){if(Element.getStyle(B,"position")=="absolute"){break}}B=B.offsetParent}while(B);return Element._returnOffset(C,A)}}}}}if(Prototype.Browser.IE||Prototype.Browser.Opera){Element.Methods.update=function(B,C){B=$(B);if(C&&C.toElement){C=C.toElement()}if(Object.isElement(C)){return B.update().insert(C)}C=Object.toHTML(C);var A=B.tagName.toUpperCase();if(A in Element._insertionTranslations.tags){$A(B.childNodes).each(function(D){B.removeChild(D)});Element._getContentFromAnonymousElement(A,C.stripScripts()).each(function(D){B.appendChild(D)})}else{B.innerHTML=C.stripScripts()}C.evalScripts.bind(C).defer();return B}}if(document.createElement("div").outerHTML){Element.Methods.replace=function(C,E){C=$(C);if(E&&E.toElement){E=E.toElement()}if(Object.isElement(E)){C.parentNode.replaceChild(E,C);return C}E=Object.toHTML(E);var D=C.parentNode,B=D.tagName.toUpperCase();if(Element._insertionTranslations.tags[B]){var F=C.next();var A=Element._getContentFromAnonymousElement(B,E.stripScripts());D.removeChild(C);if(F){A.each(function(G){D.insertBefore(G,F)})}else{A.each(function(G){D.appendChild(G)})}}else{C.outerHTML=E.stripScripts()}E.evalScripts.bind(E).defer();return C}}Element._returnOffset=function(B,C){var A=[B,C];A.left=B;A.top=C;return A};Element._getContentFromAnonymousElement=function(C,B){var D=new Element("div"),A=Element._insertionTranslations.tags[C];D.innerHTML=A[0]+B+A[1];A[2].times(function(){D=D.firstChild});return $A(D.childNodes)};Element._insertionTranslations={before:{adjacency:"beforeBegin",insert:function(A,B){A.parentNode.insertBefore(B,A)},initializeRange:function(B,A){A.setStartBefore(B)}},top:{adjacency:"afterBegin",insert:function(A,B){A.insertBefore(B,A.firstChild)},initializeRange:function(B,A){A.selectNodeContents(B);A.collapse(true)}},bottom:{adjacency:"beforeEnd",insert:function(A,B){A.appendChild(B)}},after:{adjacency:"afterEnd",insert:function(A,B){A.parentNode.insertBefore(B,A.nextSibling)},initializeRange:function(B,A){A.setStartAfter(B)}},tags:{TABLE:["<table>","</table>",1],TBODY:["<table><tbody>","</tbody></table>",2],TR:["<table><tbody><tr>","</tr></tbody></table>",3],TD:["<table><tbody><tr><td>","</td></tr></tbody></table>",4],SELECT:["<select>","</select>",1]}};(function(){this.bottom.initializeRange=this.top.initializeRange;Object.extend(this.tags,{THEAD:this.tags.TBODY,TFOOT:this.tags.TBODY,TH:this.tags.TD})}).call(Element._insertionTranslations);Element.Methods.Simulated={hasAttribute:function(A,C){C=Element._attributeTranslations.has[C]||C;var B=$(A).getAttributeNode(C);return B&&B.specified}};Element.Methods.ByTag={};Object.extend(Element,Element.Methods);if(!Prototype.BrowserFeatures.ElementExtensions&&document.createElement("div").__proto__){window.HTMLElement={};window.HTMLElement.prototype=document.createElement("div").__proto__;Prototype.BrowserFeatures.ElementExtensions=true}Element.extend=(function(){if(Prototype.BrowserFeatures.SpecificElementExtensions){return Prototype.K}var A={},B=Element.Methods.ByTag;var C=Object.extend(function(F){if(!F||F._extendedByPrototype||F.nodeType!=1||F==window){return F}var D=Object.clone(A),E=F.tagName,H,G;if(B[E]){Object.extend(D,B[E])}for(H in D){G=D[H];if(Object.isFunction(G)&&!(H in F)){F[H]=G.methodize()}}F._extendedByPrototype=Prototype.emptyFunction;return F},{refresh:function(){if(!Prototype.BrowserFeatures.ElementExtensions){Object.extend(A,Element.Methods);Object.extend(A,Element.Methods.Simulated)}}});C.refresh();return C})();Element.hasAttribute=function(A,B){if(A.hasAttribute){return A.hasAttribute(B)}return Element.Methods.Simulated.hasAttribute(A,B)};Element.addMethods=function(C){var I=Prototype.BrowserFeatures,D=Element.Methods.ByTag;if(!C){Object.extend(Form,Form.Methods);Object.extend(Form.Element,Form.Element.Methods);Object.extend(Element.Methods.ByTag,{FORM:Object.clone(Form.Methods),INPUT:Object.clone(Form.Element.Methods),SELECT:Object.clone(Form.Element.Methods),TEXTAREA:Object.clone(Form.Element.Methods)})}if(arguments.length==2){var B=C;C=arguments[1]}if(!B){Object.extend(Element.Methods,C||{})}else{if(Object.isArray(B)){B.each(H)}else{H(B)}}function H(F){F=F.toUpperCase();if(!Element.Methods.ByTag[F]){Element.Methods.ByTag[F]={}}Object.extend(Element.Methods.ByTag[F],C)}function A(L,K,F){F=F||false;for(var N in L){var M=L[N];if(!Object.isFunction(M)){continue}if(!F||!(N in K)){K[N]=M.methodize()}}}function E(L){var F;var K={OPTGROUP:"OptGroup",TEXTAREA:"TextArea",P:"Paragraph",FIELDSET:"FieldSet",UL:"UList",OL:"OList",DL:"DList",DIR:"Directory",H1:"Heading",H2:"Heading",H3:"Heading",H4:"Heading",H5:"Heading",H6:"Heading",Q:"Quote",INS:"Mod",DEL:"Mod",A:"Anchor",IMG:"Image",CAPTION:"TableCaption",COL:"TableCol",COLGROUP:"TableCol",THEAD:"TableSection",TFOOT:"TableSection",TBODY:"TableSection",TR:"TableRow",TH:"TableCell",TD:"TableCell",FRAMESET:"FrameSet",IFRAME:"IFrame"};if(K[L]){F="HTML"+K[L]+"Element"}if(window[F]){return window[F]}F="HTML"+L+"Element";if(window[F]){return window[F]}F="HTML"+L.capitalize()+"Element";if(window[F]){return window[F]}window[F]={};window[F].prototype=document.createElement(L).__proto__;return window[F]}if(I.ElementExtensions){A(Element.Methods,HTMLElement.prototype);A(Element.Methods.Simulated,HTMLElement.prototype,true)}if(I.SpecificElementExtensions){for(var J in Element.Methods.ByTag){var G=E(J);if(Object.isUndefined(G)){continue}A(D[J],G.prototype)}}Object.extend(Element,Element.Methods);delete Element.ByTag;if(Element.extend.refresh){Element.extend.refresh()}Element.cache={}};document.viewport={getDimensions:function(){var A={};$w("width height").each(function(C){var B=C.capitalize();A[C]=self["inner"+B]||(document.documentElement["client"+B]||document.body["client"+B])});return A},getWidth:function(){return this.getDimensions().width},getHeight:function(){return this.getDimensions().height},getScrollOffsets:function(){return Element._returnOffset(window.pageXOffset||document.documentElement.scrollLeft||document.body.scrollLeft,window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop)}};var Selector=Class.create({initialize:function(A){this.expression=A.strip();this.compileMatcher()},compileMatcher:function(){if(Prototype.BrowserFeatures.XPath&&!(/(\[[\w-]*?:|:checked)/).test(this.expression)){return this.compileXPathMatcher()}var e=this.expression,ps=Selector.patterns,h=Selector.handlers,c=Selector.criteria,le,p,m;if(Selector._cache[e]){this.matcher=Selector._cache[e];return }this.matcher=["this.matcher = function(root) {","var r = root, h = Selector.handlers, c = false, n;"];while(e&&le!=e&&(/\S/).test(e)){le=e;for(var i in ps){p=ps[i];if(m=e.match(p)){this.matcher.push(Object.isFunction(c[i])?c[i](m):new Template(c[i]).evaluate(m));e=e.replace(m[0],"");break}}}this.matcher.push("return h.unique(n);\n}");eval(this.matcher.join("\n"));Selector._cache[this.expression]=this.matcher},compileXPathMatcher:function(){var E=this.expression,F=Selector.patterns,B=Selector.xpath,D,A;if(Selector._cache[E]){this.xpath=Selector._cache[E];return }this.matcher=[".//*"];while(E&&D!=E&&(/\S/).test(E)){D=E;for(var C in F){if(A=E.match(F[C])){this.matcher.push(Object.isFunction(B[C])?B[C](A):new Template(B[C]).evaluate(A));E=E.replace(A[0],"");break}}}this.xpath=this.matcher.join("");Selector._cache[this.expression]=this.xpath},findElements:function(A){A=A||document;if(this.xpath){return document._getElementsByXPath(this.xpath,A)}return this.matcher(A)},match:function(H){this.tokens=[];var L=this.expression,A=Selector.patterns,E=Selector.assertions;var B,D,F;while(L&&B!==L&&(/\S/).test(L)){B=L;for(var I in A){D=A[I];if(F=L.match(D)){if(E[I]){this.tokens.push([I,Object.clone(F)]);L=L.replace(F[0],"")}else{return this.findElements(document).include(H)}}}}var K=true,C,J;for(var I=0,G;G=this.tokens[I];I++){C=G[0],J=G[1];if(!Selector.assertions[C](H,J)){K=false;break}}return K},toString:function(){return this.expression},inspect:function(){return"#<Selector:"+this.expression.inspect()+">"}});Object.extend(Selector,{_cache:{},xpath:{descendant:"//*",child:"/*",adjacent:"/following-sibling::*[1]",laterSibling:"/following-sibling::*",tagName:function(A){if(A[1]=="*"){return""}return"[local-name()='"+A[1].toLowerCase()+"' or local-name()='"+A[1].toUpperCase()+"']"},className:"[contains(concat(' ', @class, ' '), ' #{1} ')]",id:"[@id='#{1}']",attrPresence:"[@#{1}]",attr:function(A){A[3]=A[5]||A[6];return new Template(Selector.xpath.operators[A[2]]).evaluate(A)},pseudo:function(A){var B=Selector.xpath.pseudos[A[1]];if(!B){return""}if(Object.isFunction(B)){return B(A)}return new Template(Selector.xpath.pseudos[A[1]]).evaluate(A)},operators:{"=":"[@#{1}='#{3}']","!=":"[@#{1}!='#{3}']","^=":"[starts-with(@#{1}, '#{3}')]","$=":"[substring(@#{1}, (string-length(@#{1}) - string-length('#{3}') + 1))='#{3}']","*=":"[contains(@#{1}, '#{3}')]","~=":"[contains(concat(' ', @#{1}, ' '), ' #{3} ')]","|=":"[contains(concat('-', @#{1}, '-'), '-#{3}-')]"},pseudos:{"first-child":"[not(preceding-sibling::*)]","last-child":"[not(following-sibling::*)]","only-child":"[not(preceding-sibling::* or following-sibling::*)]",empty:"[count(*) = 0 and (count(text()) = 0 or translate(text(), ' \t\r\n', '') = '')]",checked:"[@checked]",disabled:"[@disabled]",enabled:"[not(@disabled)]",not:function(B){var H=B[6],G=Selector.patterns,A=Selector.xpath,E,B,C;var F=[];while(H&&E!=H&&(/\S/).test(H)){E=H;for(var D in G){if(B=H.match(G[D])){C=Object.isFunction(A[D])?A[D](B):new Template(A[D]).evaluate(B);F.push("("+C.substring(1,C.length-1)+")");H=H.replace(B[0],"");break}}}return"[not("+F.join(" and ")+")]"},"nth-child":function(A){return Selector.xpath.pseudos.nth("(count(./preceding-sibling::*) + 1) ",A)},"nth-last-child":function(A){return Selector.xpath.pseudos.nth("(count(./following-sibling::*) + 1) ",A)},"nth-of-type":function(A){return Selector.xpath.pseudos.nth("position() ",A)},"nth-last-of-type":function(A){return Selector.xpath.pseudos.nth("(last() + 1 - position()) ",A)},"first-of-type":function(A){A[6]="1";return Selector.xpath.pseudos["nth-of-type"](A)},"last-of-type":function(A){A[6]="1";return Selector.xpath.pseudos["nth-last-of-type"](A)},"only-of-type":function(A){var B=Selector.xpath.pseudos;return B["first-of-type"](A)+B["last-of-type"](A)},nth:function(E,C){var F,G=C[6],B;if(G=="even"){G="2n+0"}if(G=="odd"){G="2n+1"}if(F=G.match(/^(\d+)$/)){return"["+E+"= "+F[1]+"]"}if(F=G.match(/^(-?\d*)?n(([+-])(\d+))?/)){if(F[1]=="-"){F[1]=-1}var D=F[1]?Number(F[1]):1;var A=F[2]?Number(F[2]):0;B="[((#{fragment} - #{b}) mod #{a} = 0) and ((#{fragment} - #{b}) div #{a} >= 0)]";return new Template(B).evaluate({fragment:E,a:D,b:A})}}}},criteria:{tagName:'n = h.tagName(n, r, "#{1}", c);   c = false;',className:'n = h.className(n, r, "#{1}", c); c = false;',id:'n = h.id(n, r, "#{1}", c);        c = false;',attrPresence:'n = h.attrPresence(n, r, "#{1}"); c = false;',attr:function(A){A[3]=(A[5]||A[6]);return new Template('n = h.attr(n, r, "#{1}", "#{3}", "#{2}"); c = false;').evaluate(A)},pseudo:function(A){if(A[6]){A[6]=A[6].replace(/"/g,'\\"')}return new Template('n = h.pseudo(n, "#{1}", "#{6}", r, c); c = false;').evaluate(A)},descendant:'c = "descendant";',child:'c = "child";',adjacent:'c = "adjacent";',laterSibling:'c = "laterSibling";'},patterns:{laterSibling:/^\s*~\s*/,child:/^\s*>\s*/,adjacent:/^\s*\+\s*/,descendant:/^\s/,tagName:/^\s*(\*|[\w\-]+)(\b|$)?/,id:/^#([\w\-\*]+)(\b|$)/,className:/^\.([\w\-\*]+)(\b|$)/,pseudo:/^:((first|last|nth|nth-last|only)(-child|-of-type)|empty|checked|(en|dis)abled|not)(\((.*?)\))?(\b|$|(?=\s)|(?=:))/,attrPresence:/^\[([\w]+)\]/,attr:/\[((?:[\w-]*:)?[\w-]+)\s*(?:([!^$*~|]?=)\s*((['"])([^\4]*?)\4|([^'"][^\]]*?)))?\]/},assertions:{tagName:function(A,B){return B[1].toUpperCase()==A.tagName.toUpperCase()},className:function(A,B){return Element.hasClassName(A,B[1])},id:function(A,B){return A.id===B[1]},attrPresence:function(A,B){return Element.hasAttribute(A,B[1])},attr:function(B,C){var A=Element.readAttribute(B,C[1]);return Selector.operators[C[2]](A,C[3])}},handlers:{concat:function(B,A){for(var C=0,D;D=A[C];C++){B.push(D)}return B},mark:function(A){for(var B=0,C;C=A[B];B++){C._counted=true}return A},unmark:function(A){for(var B=0,C;C=A[B];B++){C._counted=undefined}return A},index:function(A,D,G){A._counted=true;if(D){for(var B=A.childNodes,E=B.length-1,C=1;E>=0;E--){var F=B[E];if(F.nodeType==1&&(!G||F._counted)){F.nodeIndex=C++}}}else{for(var E=0,C=1,B=A.childNodes;F=B[E];E++){if(F.nodeType==1&&(!G||F._counted)){F.nodeIndex=C++}}}},unique:function(B){if(B.length==0){return B}var D=[],E;for(var C=0,A=B.length;C<A;C++){if(!(E=B[C])._counted){E._counted=true;D.push(Element.extend(E))}}return Selector.handlers.unmark(D)},descendant:function(A){var D=Selector.handlers;for(var C=0,B=[],E;E=A[C];C++){D.concat(B,E.getElementsByTagName("*"))}return B},child:function(A){var F=Selector.handlers;for(var E=0,D=[],G;G=A[E];E++){for(var B=0,C=[],H;H=G.childNodes[B];B++){if(H.nodeType==1&&H.tagName!="!"){D.push(H)}}}return D},adjacent:function(A){for(var C=0,B=[],E;E=A[C];C++){var D=this.nextElementSibling(E);if(D){B.push(D)}}return B},laterSibling:function(A){var D=Selector.handlers;for(var C=0,B=[],E;E=A[C];C++){D.concat(B,Element.nextSiblings(E))}return B},nextElementSibling:function(A){while(A=A.nextSibling){if(A.nodeType==1){return A}}return null},previousElementSibling:function(A){while(A=A.previousSibling){if(A.nodeType==1){return A}}return null},tagName:function(B,A,E,H){E=E.toUpperCase();var D=[],F=Selector.handlers;if(B){if(H){if(H=="descendant"){for(var C=0,G;G=B[C];C++){F.concat(D,G.getElementsByTagName(E))}return D}else{B=this[H](B)}if(E=="*"){return B}}for(var C=0,G;G=B[C];C++){if(G.tagName.toUpperCase()==E){D.push(G)}}return D}else{return A.getElementsByTagName(E)}},id:function(B,A,H,F){var G=$(H),D=Selector.handlers;if(!G){return[]}if(!B&&A==document){return[G]}if(B){if(F){if(F=="child"){for(var C=0,E;E=B[C];C++){if(G.parentNode==E){return[G]}}}else{if(F=="descendant"){for(var C=0,E;E=B[C];C++){if(Element.descendantOf(G,E)){return[G]}}}else{if(F=="adjacent"){for(var C=0,E;E=B[C];C++){if(Selector.handlers.previousElementSibling(G)==E){return[G]}}}else{B=D[F](B)}}}}for(var C=0,E;E=B[C];C++){if(E==G){return[G]}}return[]}return(G&&Element.descendantOf(G,A))?[G]:[]},className:function(B,A,C,D){if(B&&D){B=this[D](B)}return Selector.handlers.byClassName(B,A,C)},byClassName:function(C,B,F){if(!C){C=Selector.handlers.descendant([B])}var H=" "+F+" ";for(var E=0,D=[],G,A;G=C[E];E++){A=G.className;if(A.length==0){continue}if(A==F||(" "+A+" ").include(H)){D.push(G)}}return D},attrPresence:function(C,B,A){if(!C){C=B.getElementsByTagName("*")}var E=[];for(var D=0,F;F=C[D];D++){if(Element.hasAttribute(F,A)){E.push(F)}}return E},attr:function(A,H,G,I,B){if(!A){A=H.getElementsByTagName("*")}var J=Selector.operators[B],D=[];for(var E=0,C;C=A[E];E++){var F=Element.readAttribute(C,G);if(F===null){continue}if(J(F,I)){D.push(C)}}return D},pseudo:function(B,C,E,A,D){if(B&&D){B=this[D](B)}if(!B){B=A.getElementsByTagName("*")}return Selector.pseudos[C](B,E,A)}},pseudos:{"first-child":function(B,F,A){for(var D=0,C=[],E;E=B[D];D++){if(Selector.handlers.previousElementSibling(E)){continue}C.push(E)}return C},"last-child":function(B,F,A){for(var D=0,C=[],E;E=B[D];D++){if(Selector.handlers.nextElementSibling(E)){continue}C.push(E)}return C},"only-child":function(B,G,A){var E=Selector.handlers;for(var D=0,C=[],F;F=B[D];D++){if(!E.previousElementSibling(F)&&!E.nextElementSibling(F)){C.push(F)}}return C},"nth-child":function(B,C,A){return Selector.pseudos.nth(B,C,A)},"nth-last-child":function(B,C,A){return Selector.pseudos.nth(B,C,A,true)},"nth-of-type":function(B,C,A){return Selector.pseudos.nth(B,C,A,false,true)},"nth-last-of-type":function(B,C,A){return Selector.pseudos.nth(B,C,A,true,true)},"first-of-type":function(B,C,A){return Selector.pseudos.nth(B,"1",A,false,true)},"last-of-type":function(B,C,A){return Selector.pseudos.nth(B,"1",A,true,true)},"only-of-type":function(B,D,A){var C=Selector.pseudos;return C["last-of-type"](C["first-of-type"](B,D,A),D,A)},getIndices:function(B,A,C){if(B==0){return A>0?[A]:[]}return $R(1,C).inject([],function(D,E){if(0==(E-A)%B&&(E-A)/B>=0){D.push(E)}return D})},nth:function(A,L,N,K,C){if(A.length==0){return[]}if(L=="even"){L="2n+0"}if(L=="odd"){L="2n+1"}var J=Selector.handlers,I=[],B=[],E;J.mark(A);for(var H=0,D;D=A[H];H++){if(!D.parentNode._counted){J.index(D.parentNode,K,C);B.push(D.parentNode)}}if(L.match(/^\d+$/)){L=Number(L);for(var H=0,D;D=A[H];H++){if(D.nodeIndex==L){I.push(D)}}}else{if(E=L.match(/^(-?\d*)?n(([+-])(\d+))?/)){if(E[1]=="-"){E[1]=-1}var O=E[1]?Number(E[1]):1;var M=E[2]?Number(E[2]):0;var P=Selector.pseudos.getIndices(O,M,A.length);for(var H=0,D,F=P.length;D=A[H];H++){for(var G=0;G<F;G++){if(D.nodeIndex==P[G]){I.push(D)}}}}}J.unmark(A);J.unmark(B);return I},empty:function(B,F,A){for(var D=0,C=[],E;E=B[D];D++){if(E.tagName=="!"||(E.firstChild&&!E.innerHTML.match(/^\s*$/))){continue}C.push(E)}return C},not:function(A,D,I){var G=Selector.handlers,J,C;var H=new Selector(D).findElements(I);G.mark(H);for(var F=0,E=[],B;B=A[F];F++){if(!B._counted){E.push(B)}}G.unmark(H);return E},enabled:function(B,F,A){for(var D=0,C=[],E;E=B[D];D++){if(!E.disabled){C.push(E)}}return C},disabled:function(B,F,A){for(var D=0,C=[],E;E=B[D];D++){if(E.disabled){C.push(E)}}return C},checked:function(B,F,A){for(var D=0,C=[],E;E=B[D];D++){if(E.checked){C.push(E)}}return C}},operators:{"=":function(B,A){return B==A},"!=":function(B,A){return B!=A},"^=":function(B,A){return B.startsWith(A)},"$=":function(B,A){return B.endsWith(A)},"*=":function(B,A){return B.include(A)},"~=":function(B,A){return(" "+B+" ").include(" "+A+" ")},"|=":function(B,A){return("-"+B.toUpperCase()+"-").include("-"+A.toUpperCase()+"-")}},matchElements:function(F,G){var E=new Selector(G).findElements(),D=Selector.handlers;D.mark(E);for(var C=0,B=[],A;A=F[C];C++){if(A._counted){B.push(A)}}D.unmark(E);return B},findElement:function(B,C,A){if(Object.isNumber(C)){A=C;C=false}return Selector.matchElements(B,C||"*")[A||0]},findChildElements:function(E,G){var H=G.join(","),G=[];H.scan(/(([\w#:.~>+()\s-]+|\*|\[.*?\])+)\s*(,|$)/,function(I){G.push(I[1].strip())});var D=[],F=Selector.handlers;for(var C=0,B=G.length,A;C<B;C++){A=new Selector(G[C].strip());F.concat(D,A.findElements(E))}return(B>1)?F.unique(D):D}});function $$(){return Selector.findChildElements(document,$A(arguments))}var Form={reset:function(A){$(A).reset();return A},serializeElements:function(G,B){if(typeof B!="object"){B={hash:!!B}}else{if(B.hash===undefined){B.hash=true}}var C,F,A=false,E=B.submit;var D=G.inject({},function(H,I){if(!I.disabled&&I.name){C=I.name;F=$(I).getValue();if(F!=null&&(I.type!="submit"||(!A&&E!==false&&(!E||C==E)&&(A=true)))){if(C in H){if(!Object.isArray(H[C])){H[C]=[H[C]]}H[C].push(F)}else{H[C]=F}}}return H});return B.hash?D:Object.toQueryString(D)}};Form.Methods={serialize:function(B,A){return Form.serializeElements(Form.getElements(B),A)},getElements:function(A){return $A($(A).getElementsByTagName("*")).inject([],function(B,C){if(Form.Element.Serializers[C.tagName.toLowerCase()]){B.push(Element.extend(C))}return B})},getInputs:function(G,C,D){G=$(G);var A=G.getElementsByTagName("input");if(!C&&!D){return $A(A).map(Element.extend)}for(var E=0,H=[],F=A.length;E<F;E++){var B=A[E];if((C&&B.type!=C)||(D&&B.name!=D)){continue}H.push(Element.extend(B))}return H},disable:function(A){A=$(A);Form.getElements(A).invoke("disable");return A},enable:function(A){A=$(A);Form.getElements(A).invoke("enable");return A},findFirstElement:function(B){var C=$(B).getElements().findAll(function(D){return"hidden"!=D.type&&!D.disabled});var A=C.findAll(function(D){return D.hasAttribute("tabIndex")&&D.tabIndex>=0}).sortBy(function(D){return D.tabIndex}).first();return A?A:C.find(function(D){return["input","select","textarea"].include(D.tagName.toLowerCase())})},focusFirstElement:function(A){A=$(A);A.findFirstElement().activate();return A},request:function(B,A){B=$(B),A=Object.clone(A||{});var D=A.parameters,C=B.readAttribute("action")||"";if(C.blank()){C=window.location.href}A.parameters=B.serialize(true);if(D){if(Object.isString(D)){D=D.toQueryParams()}Object.extend(A.parameters,D)}if(B.hasAttribute("method")&&!A.method){A.method=B.method}return new Ajax.Request(C,A)}};Form.Element={focus:function(A){$(A).focus();return A},select:function(A){$(A).select();return A}};Form.Element.Methods={serialize:function(A){A=$(A);if(!A.disabled&&A.name){var B=A.getValue();if(B!=undefined){var C={};C[A.name]=B;return Object.toQueryString(C)}}return""},getValue:function(A){A=$(A);var B=A.tagName.toLowerCase();return Form.Element.Serializers[B](A)},setValue:function(A,B){A=$(A);var C=A.tagName.toLowerCase();Form.Element.Serializers[C](A,B);return A},clear:function(A){$(A).value="";return A},present:function(A){return $(A).value!=""},activate:function(A){A=$(A);try{A.focus();if(A.select&&(A.tagName.toLowerCase()!="input"||!["button","reset","submit"].include(A.type))){A.select()}}catch(B){}return A},disable:function(A){A=$(A);A.blur();A.disabled=true;return A},enable:function(A){A=$(A);A.disabled=false;return A}};var Field=Form.Element;var $F=Form.Element.Methods.getValue;Form.Element.Serializers={input:function(A,B){switch(A.type.toLowerCase()){case"checkbox":case"radio":return Form.Element.Serializers.inputSelector(A,B);default:return Form.Element.Serializers.textarea(A,B)}},inputSelector:function(A,B){if(B===undefined){return A.checked?A.value:null}else{A.checked=!!B}},textarea:function(A,B){if(B===undefined){return A.value}else{A.value=B}},select:function(D,A){if(A===undefined){return this[D.type=="select-one"?"selectOne":"selectMany"](D)}else{var C,F,G=!Object.isArray(A);for(var B=0,E=D.length;B<E;B++){C=D.options[B];F=this.optionValue(C);if(G){if(F==A){C.selected=true;return }}else{C.selected=A.include(F)}}}},selectOne:function(B){var A=B.selectedIndex;return A>=0?this.optionValue(B.options[A]):null},selectMany:function(D){var A,E=D.length;if(!E){return null}for(var C=0,A=[];C<E;C++){var B=D.options[C];if(B.selected){A.push(this.optionValue(B))}}return A},optionValue:function(A){return Element.extend(A).hasAttribute("value")?A.value:A.text}};Abstract.TimedObserver=Class.create(PeriodicalExecuter,{initialize:function($super,A,B,C){$super(C,B);this.element=$(A);this.lastValue=this.getValue()},execute:function(){var A=this.getValue();if(Object.isString(this.lastValue)&&Object.isString(A)?this.lastValue!=A:String(this.lastValue)!=String(A)){this.callback(this.element,A);this.lastValue=A}}});Form.Element.Observer=Class.create(Abstract.TimedObserver,{getValue:function(){return Form.Element.getValue(this.element)}});Form.Observer=Class.create(Abstract.TimedObserver,{getValue:function(){return Form.serialize(this.element)}});Abstract.EventObserver=Class.create({initialize:function(A,B){this.element=$(A);this.callback=B;this.lastValue=this.getValue();if(this.element.tagName.toLowerCase()=="form"){this.registerFormCallbacks()}else{this.registerCallback(this.element)}},onElementEvent:function(){var A=this.getValue();if(this.lastValue!=A){this.callback(this.element,A);this.lastValue=A}},registerFormCallbacks:function(){Form.getElements(this.element).each(this.registerCallback,this)},registerCallback:function(A){if(A.type){switch(A.type.toLowerCase()){case"checkbox":case"radio":Event.observe(A,"click",this.onElementEvent.bind(this));break;default:Event.observe(A,"change",this.onElementEvent.bind(this));break}}}});Form.Element.EventObserver=Class.create(Abstract.EventObserver,{getValue:function(){return Form.Element.getValue(this.element)}});Form.EventObserver=Class.create(Abstract.EventObserver,{getValue:function(){return Form.serialize(this.element)}});if(!window.Event){var Event={}}Object.extend(Event,{KEY_BACKSPACE:8,KEY_TAB:9,KEY_RETURN:13,KEY_ESC:27,KEY_LEFT:37,KEY_UP:38,KEY_RIGHT:39,KEY_DOWN:40,KEY_DELETE:46,KEY_HOME:36,KEY_END:35,KEY_PAGEUP:33,KEY_PAGEDOWN:34,KEY_INSERT:45,cache:{},relatedTarget:function(B){var A;switch(B.type){case"mouseover":A=B.fromElement;break;case"mouseout":A=B.toElement;break;default:return null}return Element.extend(A)}});Event.Methods=(function(){var A;if(Prototype.Browser.IE){var B={0:1,1:4,2:2};A=function(D,C){return D.button==B[C]}}else{if(Prototype.Browser.WebKit){A=function(D,C){switch(C){case 0:return D.which==1&&!D.metaKey;case 1:return D.which==1&&D.metaKey;default:return false}}}else{A=function(D,C){return D.which?(D.which===C+1):(D.button===C)}}}return{isLeftClick:function(C){return A(C,0)},isMiddleClick:function(C){return A(C,1)},isRightClick:function(C){return A(C,2)},element:function(D){var C=Event.extend(D).target;return Element.extend(C.nodeType==Node.TEXT_NODE?C.parentNode:C)},findElement:function(D,E){var C=Event.element(D);return C.match(E)?C:C.up(E)},pointer:function(C){return{x:C.pageX||(C.clientX+(document.documentElement.scrollLeft||document.body.scrollLeft)),y:C.pageY||(C.clientY+(document.documentElement.scrollTop||document.body.scrollTop))}},pointerX:function(C){return Event.pointer(C).x},pointerY:function(C){return Event.pointer(C).y},stop:function(C){Event.extend(C);C.preventDefault();C.stopPropagation();C.stopped=true}}})();Event.extend=(function(){var A=Object.keys(Event.Methods).inject({},function(B,C){B[C]=Event.Methods[C].methodize();return B});if(Prototype.Browser.IE){Object.extend(A,{stopPropagation:function(){this.cancelBubble=true},preventDefault:function(){this.returnValue=false},inspect:function(){return"[object Event]"}});return function(B){if(!B){return false}if(B._extendedByPrototype){return B}B._extendedByPrototype=Prototype.emptyFunction;var C=Event.pointer(B);Object.extend(B,{target:B.srcElement,relatedTarget:Event.relatedTarget(B),pageX:C.x,pageY:C.y});return Object.extend(B,A)}}else{Event.prototype=Event.prototype||document.createEvent("HTMLEvents").__proto__;Object.extend(Event.prototype,A);return Prototype.K}})();Object.extend(Event,(function(){var B=Event.cache;function C(J){if(J._eventID){return J._eventID}arguments.callee.id=arguments.callee.id||1;return J._eventID=++arguments.callee.id}function G(J){if(J&&J.include(":")){return"dataavailable"}return J}function A(J){return B[J]=B[J]||{}}function F(L,J){var K=A(L);return K[J]=K[J]||[]}function H(K,J,L){var O=C(K);var N=F(O,J);if(N.pluck("handler").include(L)){return false}var M=function(P){if(!Event||!Event.extend||(P.eventName&&P.eventName!=J)){return false}Event.extend(P);L.call(K,P)};M.handler=L;N.push(M);return M}function I(M,J,K){var L=F(M,J);return L.find(function(N){return N.handler==K})}function D(M,J,K){var L=A(M);if(!L[J]){return false}L[J]=L[J].without(I(M,J,K))}function E(){for(var K in B){for(var J in B[K]){B[K][J]=null}}}if(window.attachEvent){window.attachEvent("onunload",E)}return{observe:function(L,J,M){L=$(L);var K=G(J);var N=H(L,J,M);if(!N){return L}if(L.addEventListener){L.addEventListener(K,N,false)}else{L.attachEvent("on"+K,N)}return L},stopObserving:function(L,J,M){L=$(L);var O=C(L),K=G(J);if(!M&&J){F(O,J).each(function(P){L.stopObserving(J,P.handler)});return L}else{if(!J){Object.keys(A(O)).each(function(P){L.stopObserving(P)});return L}}var N=I(O,J,M);if(!N){return L}if(L.removeEventListener){L.removeEventListener(K,N,false)}else{L.detachEvent("on"+K,N)}D(O,J,M);return L},fire:function(L,K,J){L=$(L);if(L==document&&document.createEvent&&!L.dispatchEvent){L=document.documentElement}if(document.createEvent){var M=document.createEvent("HTMLEvents");M.initEvent("dataavailable",true,true)}else{var M=document.createEventObject();M.eventType="ondataavailable"}M.eventName=K;M.memo=J||{};if(document.createEvent){L.dispatchEvent(M)}else{L.fireEvent(M.eventType,M)}return M}}})());Object.extend(Event,Event.Methods);Element.addMethods({fire:Event.fire,observe:Event.observe,stopObserving:Event.stopObserving});Object.extend(document,{fire:Element.Methods.fire.methodize(),observe:Element.Methods.observe.methodize(),stopObserving:Element.Methods.stopObserving.methodize()});(function(){var C,B=false;function A(){if(B){return }if(C){window.clearInterval(C)}document.fire("dom:loaded");B=true}if(document.addEventListener){if(Prototype.Browser.WebKit){C=window.setInterval(function(){if(/loaded|complete/.test(document.readyState)){A()}},0);Event.observe(window,"load",A)}else{document.addEventListener("DOMContentLoaded",A,false)}}else{document.write("<script id=__onDOMContentLoaded defer src=//:><\/script>");$("__onDOMContentLoaded").onreadystatechange=function(){if(this.readyState=="complete"){this.onreadystatechange=null;A()}}}})();Hash.toQueryString=Object.toQueryString;var Toggle={display:Element.toggle};Element.Methods.childOf=Element.Methods.descendantOf;var Insertion={Before:function(A,B){return Element.insert(A,{before:B})},Top:function(A,B){return Element.insert(A,{top:B})},Bottom:function(A,B){return Element.insert(A,{bottom:B})},After:function(A,B){return Element.insert(A,{after:B})}};var $continue=new Error('"throw $continue" is deprecated, use "return" instead');var Position={includeScrollOffsets:false,prepare:function(){this.deltaX=window.pageXOffset||document.documentElement.scrollLeft||document.body.scrollLeft||0;this.deltaY=window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop||0},within:function(B,A,C){if(this.includeScrollOffsets){return this.withinIncludingScrolloffsets(B,A,C)}this.xcomp=A;this.ycomp=C;this.offset=Element.cumulativeOffset(B);return(C>=this.offset[1]&&C<this.offset[1]+B.offsetHeight&&A>=this.offset[0]&&A<this.offset[0]+B.offsetWidth)},withinIncludingScrolloffsets:function(B,A,D){var C=Element.cumulativeScrollOffset(B);this.xcomp=A+C[0]-this.deltaX;this.ycomp=D+C[1]-this.deltaY;this.offset=Element.cumulativeOffset(B);return(this.ycomp>=this.offset[1]&&this.ycomp<this.offset[1]+B.offsetHeight&&this.xcomp>=this.offset[0]&&this.xcomp<this.offset[0]+B.offsetWidth)},overlap:function(B,A){if(!B){return 0}if(B=="vertical"){return((this.offset[1]+A.offsetHeight)-this.ycomp)/A.offsetHeight}if(B=="horizontal"){return((this.offset[0]+A.offsetWidth)-this.xcomp)/A.offsetWidth}},cumulativeOffset:Element.Methods.cumulativeOffset,positionedOffset:Element.Methods.positionedOffset,absolutize:function(A){Position.prepare();return Element.absolutize(A)},relativize:function(A){Position.prepare();return Element.relativize(A)},realOffset:Element.Methods.cumulativeScrollOffset,offsetParent:Element.Methods.getOffsetParent,page:Element.Methods.viewportOffset,clone:function(B,C,A){A=A||{};return Element.clonePosition(C,B,A)}};if(!document.getElementsByClassName){document.getElementsByClassName=function(B){function A(C){return C.blank()?null:"[contains(concat(' ', @class, ' '), ' "+C+" ')]"}B.getElementsByClassName=Prototype.BrowserFeatures.XPath?function(C,E){E=E.toString().strip();var D=/\s/.test(E)?$w(E).map(A).join(""):A(E);return D?document._getElementsByXPath(".//*"+D,C):[]}:function(E,F){F=F.toString().strip();var G=[],H=(/\s/.test(F)?$w(F):null);if(!H&&!F){return G}var C=$(E).getElementsByTagName("*");F=" "+F+" ";for(var D=0,J,I;J=C[D];D++){if(J.className&&(I=" "+J.className+" ")&&(I.include(F)||(H&&H.all(function(K){return !K.toString().blank()&&I.include(" "+K+" ")})))){G.push(Element.extend(J))}}return G};return function(D,C){return $(C||document.body).getElementsByClassName(D)}}(Element.Methods)}Element.ClassNames=Class.create();Element.ClassNames.prototype={initialize:function(A){this.element=$(A)},_each:function(A){this.element.className.split(/\s+/).select(function(B){return B.length>0})._each(A)},set:function(A){this.element.className=A},add:function(A){if(this.include(A)){return }this.set($A(this).concat(A).join(" "))},remove:function(A){if(!this.include(A)){return }this.set($A(this).without(A).join(" "))},toString:function(){return $A(this).join(" ")}};Object.extend(Element.ClassNames.prototype,Enumerable);Element.addMethods();Object.Event={extend:function(A){A._objectEventSetup=function(B){this._observers=this._observers||{};this._observers[B]=this._observers[B]||[]};A.observe=function(D,B){if(typeof (D)=="string"&&typeof (B)!="undefined"){this._objectEventSetup(D);if(!this._observers[D].include(B)){this._observers[D].push(B)}}else{for(var C in D){this.observe(C,D[C])}}};A.stopObserving=function(C,B){this._objectEventSetup(C);if(C&&B){this._observers[C]=this._observers[C].without(B)}else{if(C){this._observers[C]=[]}else{this._observers={}}}};A.observeOnce=function(D,C){var B=function(){C.apply(this,arguments);this.stopObserving(D,B)}.bind(this);this._objectEventSetup(D);this._observers[D].push(B)};A.notify=function(F){this._objectEventSetup(F);var D=[];var B=$A(arguments).slice(1);try{for(var C=0;C<this._observers[F].length;++C){D.push(this._observers[F][C].apply(this._observers[F][C],B)||null)}}catch(E){if(E==$break){return false}else{throw E}}return D};if(A.prototype){A.prototype._objectEventSetup=A._objectEventSetup;A.prototype.observe=A.observe;A.prototype.stopObserving=A.stopObserving;A.prototype.observeOnce=A.observeOnce;A.prototype.notify=function(F){if(A.notify){var B=$A(arguments).slice(1);B.unshift(this);B.unshift(F);A.notify.apply(A,B)}this._objectEventSetup(F);var B=$A(arguments).slice(1);var D=[];try{if(this.options&&this.options[F]&&typeof (this.options[F])=="function"){D.push(this.options[F].apply(this,B)||null)}for(var C=0;C<this._observers[F].length;++C){D.push(this._observers[F][C].apply(this._observers[F][C],B)||null)}}catch(E){if(E==$break){return false}else{throw E}}return D}}}};Object.extend(Event,{wheel:function(A){var B=0;if(!A){A=window.event}if(A.wheelDelta){B=A.wheelDelta/120;if(window.opera){B=-B}}else{if(A.detail){B=-A.detail/3}}return Math.round(B)}});PBMenu=Class.create({initialize:function(A){var B={items:[]};Object.extend(B,A);this.options=B;this.items=new Array();this.create();this.enable();if(this.options.items){this.addItems(this.options.items)}this.onClickOpen=this.show.bind(this);this.onClickClose=this.off.bind(this);this.options.toggle.observe("click",this.onClickOpen)},toggle:function(A){if(A){A.stop();this.options.toggle.blur()}if(this.isOpen){this.hide()}else{this.show()}},create:function(){this.elm=new Element("div",{"class":"pbMenu"});this.listElm=new Element("ul");this.elm.appendChild(this.listElm);this.elm.appendChild(new Element("img",{src:"/layout/common/images/shadow.png",width:"100%"}));document.body.appendChild(this.elm)},disable:function(){this.isEnabled=false;this.elm.addClassName("disabled")},enable:function(){this.isEnabled=true;this.elm.removeClassName("disabled")},show:function(A){A.stop();A.element().blur();if(A.element().disabled){return }this.options.toggle.addClassName("active");if(this.isOpen||!this.isEnabled){return }var B=this.options.toggle.cumulativeOffset();if(Prototype.Browser.WebKit){B.left+=10;B.top+=40}B.top+=this.options.toggle.getHeight()-1;this.elm.setStyle({top:B.top+"px",left:(B.left-1)+"px",display:"block"});this.isOpen=true;this.notify("onOpen");this.options.toggle.stopObserving("click",this.onClickOpen).observe("click",this.onClickClose);document.observe("click",this.onClickClose)},off:function(A){A.stop();A.element().blur();this.hide()},hide:function(){this.timer=null;this.isOpen=false;this.elm.setStyle({display:"none"});this.notify("onClose");this.options.toggle.stopObserving("click",this.onClickClose).observe("click",this.onClickOpen).removeClassName("active");document.stopObserving("click",this.onClickClose)},addItems:function(A){A.each(function(B){this.add(new PBMenu.Item(this,B))}.bind(this))},add:function(A){this.items.push(A);this.listElm.appendChild(A.elm)},getItem:function(B){for(var A=0;A<this.items.length;A++){if(this.items[A].options.name==B){return this.items[A]}}},removeAll:function(){this.items.each(function(A){this.remove(A)}.bind(this))},remove:function(A){A.remove();this.items=this.items.without(A)}});Object.Event.extend(PBMenu);PBMenu.Item=Class.create({initialize:function(B,A){this.options=A;this.menu=B;this.elm=new Element("li").update(A.txt).observe("click",this.activate.bind(this)).addClassName(A.className);if(this.options.className){this.elm.className=this.options.className}(this.options.disabled)?this.disable():this.enable()},disable:function(){this.isDisabled=true;this.elm.addClassName("disabled")},enable:function(){this.isDisabled=false;this.elm.removeClassName("disabled")},activate:function(){if(!this.isDisabled){this.menu.hide();this.notify("onClick")}},remove:function(){this.elm.parentNode.removeChild(this.elm)}});Object.Event.extend(PBMenu.Item);Util={parseQueryString:function(B){var A={};$A(B.split("&")).each(function(D){var C=D.split("=");A[C[0]]=C[1]});return A},onFCKcomplete:function(A){document.fire("ui:fckeditor_oncomplete",{editorInstance:A})},strHasInvalidCharacters:function(C,B){for(var A=0;A<B.length;A++){if(C.indexOf(B.charAt(A))!==-1){return true}}return false},is_valid_page_name:function(A){if(A=="FrontPage"){return"Cannot create a page called 'FrontPage'"}if(A.strip().length==0){return"Empty page names are not allowed"}if(A.length>PBconst.kMaxPageNameLength){return"That name is too long (page names must be "+PBconfig.kMaxPageNameLength+" characters or less)"}if(Util.strHasInvalidCharacters(A,PBconst.kInvalidPageCharacters)){return"Page names can't contain any of the following characters: "+PBconst.kInvalidPageCharacters}return true},is_valid_folder_name:function(A){if(A.length>PBconst.kMaxFolderNameLength){return"Folder names must be less then "+PBconst.kMaxFolderNameLength+" characters"}if(A.strip().length==0){return"Empty folder names are not allowed"}if(Util.strHasInvalidCharacters(A,PBconst.kInvalidFolderCharacters)){return"Folder names can't contain any of the following characters: "+PBconst.kInvalidFolderCharacters}return true},is_valid_file_name:function(A){if(A.length>PBconst.kMaxFileNameLength){return"File names must be less then "+PBconst.kMaxFileNameLength+" characters"}if(A.strip().length==0){return"Empty file names are not allowed"}if(Util.strHasInvalidCharacters(A,PBconst.kInvalidFileCharacters)){return"File names can't contain any of the following characters: "+PBconst.kInvalidFileCharacters}return true},is_valid_email:function(v){if(!eval(PBconst.kPolicyValidEmailRegex).test(v)){return"The address "+v+" isn't a proper email address."}return true},is_valid_wiki_name:function(w){if(w.length<PBconst.kMinWikiNameLength){return"Wiki names must be at least "+PBconst.kMinWikiNameLength+" characters."}if(w.length>PBconst.kMaxWikiNameLength){return"Wiki names must be no more than "+PBconst.kMaxWikiNameLength+" characters."}if(!eval(PBconst.kPolicyValidWikiNameRegex).test(w)){return"Wiki names can only have letters, numbers, and internal dashes"}return true},dashified_link:function(A){if(A.indexOf("-")==-1){A=A.replace(/ /g,"-")}A=encodeURIComponent(A);A=A.replace(/%20/g,"+");return A},undashified_link:function(A){var B=A.indexOf("+")==-1;A=decodeURIComponent(A);A=A.replace(/\+/g," ");if(B&&A.indexOf("-")!=-1){A=A.replace(/-/g," ")}return A},getFileExtension:function(A){if(!A||typeof (A)!="string"){return }var B=A.lastIndexOf(".");if(B==-1){return }return A.substr(B+1).toLowerCase()},iconMap:{pdf:"ob_item_pdf",doc:"ob_item_doc",odt:"ob_item_doc",rtf:"ob_item_doc",docx:"ob_item_doc",xls:"ob_item_xls",ods:"ob_item_xls",xlsx:"ob_item_xls",ppt:"ob_item_ppt",odp:"ob_item_ppt",pptx:"ob_item_ppt",zip:"ob_item_zip",rar:"ob_item_zip",jpg:"ob_item_jpg",gif:"ob_item_jpg",png:"ob_item_jpg",psd:"ob_item_jpg",bmp:"ob_item_jpg",jpeg:"ob_item_jpg",txt:"ob_item_txt",css:"ob_item_txt",mp3:"ob_item_audio",htm:"ob_item_html",html:"ob_item_html"},addObjectTooltip:function(C,B){if(["png","gif","jpg"].indexOf(Util.getFileExtension(B.name))!=-1&&B.type!=="page"){var A="/f/"+B.mtime+"-180p/"+encodeURIComponent(B.name);new Tooltip(C,{txt:'<div style="width: 180px;"><img src="'+A+'" alt="Loading preview image..." width="180" /></div>'})}},tracking:function(C,A){C=Util.trackingPrefix+C+Util.trackingSuffix;if(A&&Util.trackingList.indexOf(C)!=-1){return }PBwiki.info("tracking "+C);if(C.length>50){return false}var B=Cookie.get(PBconst.kTrackingCookie);B=(B)?B.evalJSON():[];B.push(C);if(B.length>10){B=B.slice(-10)}Cookie.set(PBconst.kTrackingCookie,Object.toJSON(B));if(A){Util.trackingList.push(C)}},trackingList:[]};window.FCKeditor_OnComplete=Util.onFCKcomplete;
/*@cc_on
Util.IE6 = ( @_jscript_version == '5.6' );
@*/
Object.extend(Date.prototype,{strftime:function(F){var B=this.getDay(),E=this.getMonth();var A=this.getHours(),C=this.getMinutes();function D(G){return G.toPaddedString(2)}return F.gsub(/\%([aAbBcdHIimMpSwyY])/,function(G){switch(G[1]){case"a":return $w("Sun Mon Tue Wed Thu Fri Sat")[B];break;case"A":return $w("Sunday Monday Tuesday Wednesday Thursday Friday Saturday")[B];break;case"b":return $w("Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec")[E];break;case"B":return $w("January February March April May June July August September October November December")[E];break;case"c":return this.toString();break;case"d":return D(this.getDate());break;case"H":return D(A);break;case"I":var H=((A+12)%12);return(H==0?12:D(H));break;case"i":var H=((A+12)%12);return(H==0?12:H);break;case"m":return D(E+1);break;case"M":return D(C);break;case"p":return A>=12?"PM":"AM";break;case"S":return D(this.getSeconds());break;case"w":return B;break;case"y":return D(this.getFullYear()%100);break;case"Y":return this.getFullYear().toString();break}}.bind(this))}});MiniTabSwitcher=Class.create({linkPanelHash:null,initialize:function(A){this.linkPanelHash=new Hash();$H(A).each(function(C){if($(C.key)){var B=$(C.key);this.linkPanelHash.set(C.key,$(C.value));B.onmousedown=function(){return false};B.observe("click",this.handleTabOnclick.bindAsEventListener(this)).setAttribute("unselectable","on");if(B.hasClassName("active")){this.switchTab(B)}}}.bind(this))},handleTabOnclick:function(B){B.stop();var A=B.element();PBwiki.info(this.linkPanelHash);this.switchTab(A)},switchTab:function(A){this.linkPanelHash.each(function(B){$(B.key).removeClassName("active");B.value.hide()});A.addClassName("active");this.linkPanelHash.get(A.id).show();A.fire("ui:tabswitched")}});var Cookie={set:function(C,D,B){var A="";if(B!=undefined){var E=new Date();E.setTime(E.getTime()+(86400000*parseFloat(B)));A="; expires="+E.toGMTString()}return(document.cookie=escape(C)+"="+escape(D||"")+A+"; path=/")},get:function(A){var B=document.cookie.split(";").find(function(C){if(C.strip().indexOf(A+"=")==0){return true}});return(B)?unescape(B.split("=")[1]):""}};PBwiki={is_dev:function(){var A=(window.location.hostname.endsWith("pbwiki.cn")||window.location.search.indexOf("?debug=")==0);this.is_dev=function(){return A};return A},installFirebugLiteForIE:function(){if(this.is_dev()&&Prototype.Browser.IE&&false){document.write('<script src="/layout/js/firebug/firebug.js"><\/script>')}},getQueryParams:function(){this.queryParams=Util.parseQueryString(window.location.search.substr(1));this.loglevel=this.queryParams.loglevel},setLogLevel:function(){var A=PBwiki.queryParams.loglevel;PBwiki.logLevel=(PBwiki.loglevels.indexOf(A)>-1?PBwiki.loglevels.indexOf(A):PBwiki.loglevels.indexOf("info"))},canLog:function(A){return(PBwiki.logLevel<=PBwiki.loglevels.indexOf(A))},_initialize:function(){window.onerror=PBwiki.error;this.getQueryParams();PBwiki.setLogLevel();for(var A=0;A<this.initFunctions.length;A++){try{this.initFunctions[A]()}catch(B){PBwiki.error("error: "+B.message+" "+B.fileName+" line "+B.lineNumber)}}PBwiki.debug("PBwiki : init complete")},loglevels:["debug","info","warn"],addInitFunction:function(B,A){this.initFunctions.push(function(){B.apply(null,A)})},initFunctions:[function(){if(window.loadFirebugConsole){window.loadFirebugConsole()}if(window.console&&PBwiki.is_dev()&&!Prototype.Browser.WebKit){PBwiki.loglevels.each(function(A){PBwiki[A]=(PBwiki.canLog(A)?function(B){console[A](B)}:Prototype.emptyFunction)})}else{PBwiki.loglevels.each(function(A){PBwiki[A]=Prototype.emptyFunction})}}],init:function(){var A=Array.prototype.shift.call(arguments);if(A.initialize){this.addInitFunction(A.initialize,arguments)}else{if(A.prototype){this.addInitFunction(function(B){new A(B)},arguments)}else{if(Object.isFunction(A)){this.addInitFunction(A,arguments)}}}},getPageName:function(){return PBinfo.CurrentPage.page},getEditURI:function(B,A){if(PBwiki.feature("ajaxedit")){return"/"+Util.dashified_link(B.toString())+((A)?"?referer="+encodeURIComponent(window.location):"")+"#view=edit"}else{return"/"+encodeURIComponent(B.toString())+"?edit=1"+((A)?"&referer="+encodeURIComponent(window.location):"")}},getSessCookie:function(){var B=PBinfo.CurrentPage.sessCookie;var A={};A[B]=Cookie.get(B);return A},getUID:function(){var A=PBinfo.CheckPermissions.uid;return(!A||A=="public-browser-proxy-id")?false:A},feature:function(A){if(typeof (PBinfo)=="undefined"||!PBinfo.GetFeatures){return false}return(PBinfo.GetFeatures[A])?true:false},error:function(A){PBwiki.warn(A);PBwiki.jsDebug(A)},jsDebug:function(A,C,B){if(PBinfo.CurrentWiki&&PBinfo.CurrentWiki.debug&&!PBwiki.jsDebugSent){new Ajax.Request("/jsdebug.php?"+Object.toQueryString({msg:A,url:C,line:B,file:document.location.href}));PBwiki.jsDebugSent=true}return false},getCache:function(A){return PBinfo[A]},getTimestamp:function(){return Math.floor(new Date().getTime()/1000)},confirmDeletePage:function(){if(confirm("This will irretrievably delete this page and its revisions. Click OK to confirm this action.")){Page.EditPage.cancel=true;location.href=location.pathname+"&delete=1"}}};PBwiki.installFirebugLiteForIE();$(document).observe("dom:loaded",PBwiki._initialize.bind(PBwiki));PBwiki.UINotification=Class.create({initialize:function(){document.observe("ui:onNotifyUser",this.handleUserNotification.bind(this))},handleUserNotification:function(A){if(!this.errMsg){this.errMsg=new Element("div",{"class":"yellow-note"});$("main-content").insertBefore(this.errMsg,$$("h1.wikititle")[0].nextSibling)}this.errMsg.update(A.memo.message).show();if(this.timeout){window.clearTimeout(this.timeout);this.timeout=null}this.timeout=this.errMsg.hide.bind(this.errMsg).delay(10)}});var UIException=Class.create({element:null,message:"",parent:null,initialize:function(C,A,B){this.element=A;this.message=C;this.parent=B},toString:function(){var A=this.message+(this.element?"("+this.element+")":"");if(this.parent){A+=" > "+this.parent.toString()}return A}});PBwiki.init(function(){var B=navigator.userAgent.indexOf("Windows NT 6.0")!=-1;var C=Prototype.Browser.WebKit;var A=navigator.userAgent.indexOf("Mac")!=-1;if(!(B||C||A)){$(document.body).addClassName("nn")}});PBwiki.init(PBwiki.UINotification);PBHistory=Class.create({initialize:function(A){var B={checkTime:100};Object.extend(B,A);this.options=B;this.keyList={};for(itm in this.options.items){this.keyList[itm]=new PBHistory.Key(this.options.items[itm])}},start:function(){this.timer=setInterval(this.check.bind(this),this.options.checkTime);return this},stop:function(){if(this.timer){this.timer.stop();this.timer=null}},getItems:function(){var B=location.hash;if(B.charAt(0)=="#"){var A=B.substr(1).toQueryParams();for(itm in A){A[itm]=decodeURIComponent(A[itm])}return A}else{return{}}},setItems:function(A){for(itm in A){A[itm]=encodeURIComponent(A[itm])}location.hash=Object.toQueryString(A)},check:function(){var A=this.getItems();for(itm in this.keyList){this.getKey(itm).check(A[itm])}},getKey:function(B){if(!this.keyList[B]){var A=this.getItems();this.keyList[B]=new PBHistory.Key({item:B});this.keyList[B].lastVal=A[B]}return this.keyList[B]},removeKey:function(B){var A=this.getItems();if(A[B]){delete A[B];this.setItems(A)}},setValues:function(B){var A=this.getItems();var C=false;for(itm in B){if(A[itm]&&(B[itm]==undefined||B[itm]==null)){delete A[itm];this.getKey(itm).lastVal=null;continue}if(A[itm]==B[itm]){continue}C=true;this.getKey(itm).lastVal=B[itm];A[itm]=B[itm]}if(C){this.setItems(A)}},getValue:function(B){var A=this.getItems();return A[B]}});Object.Event.extend(PBHistory);PBHistory.Key=Class.create({initialize:function(A){this.options=A||{}},check:function(A){if(A!=this.lastVal){this.notify("onChange",A,this.options.item)}this.lastVal=A},getValue:function(){return this.lastVal}});Object.Event.extend(PBHistory.Key);PBwiki.init(function(){PBwiki.History=new PBHistory()});PBwiki=PBwiki||parent.PBwiki;PBwiki.Components=PBwiki.Components||{};PBwiki.Components.Dialog=Class.create({close:function(){this.onUnload();this.onClosed();this.remove()},IE6:
/*@cc_on @_jscript_version < 5.7 || @*/
false,displayIframe:function(A){this.resize(A.dimensions);this.renderMode=A.contentSource;this.originalSize=A.dimensions},display:function(A){document.body.appendChild(this);this.resize(A.dimensions);this.renderMode=A.contentSource;this.originalSize=A.dimensions},resize:function(C){var A={};A.width=(parseInt(C.width)?C.width+"px":"400px");A.height=(parseInt(C.height)?C.height+"px":"auto");var B=this.select(".modal_content").first();B.setStyle(A);this.setContainerSize(C)},setContainerSize:function(C){var B=(this.IE6?"absolute":"fixed");var A=(typeof C.height=="string"?"auto":(C.height+41)+"px");this.setStyle({width:(C.width+18)+"px",height:A,display:"block",position:B});this.recenter();this.setStyle({visibility:"visible"});if(this.IE6){window.onscroll=this.redisplay.bind(this);window.onresize=this.redisplay.bind(this)}},predisplay:function(){this.style.top=((document.documentElement.clientHeight/2)+document.documentElement.scrollTop);this.style.left=document.documentElement.clientWidth/2;this.style.position="absolute"},redisplay:function(){PBwiki.DialogFactory.background.style.height=document.body.clientHeight;PBwiki.DialogFactory.background.style.width=document.documentElement.clientWidth;if(!this.IE6){return }if(!this.timeOut){this.predisplay()}clearTimeout(this.timeOut);this.timeOut=setTimeout(function(){var A=((document.documentElement.clientHeight/2)+document.documentElement.scrollTop);this.style.position="absolute"}.bind(this),10)},setTitle:function(A){this.getElementsByTagName("h3")[0].innerHTML=A},recenter:function(){var A=this.getDimensions();var B=A.height/-2;var C=document.viewport.getHeight()/4+B;if(C<0){B-=C}this.setStyle({marginTop:B+"px",marginLeft:A.width/-2+"px",top:"25%",left:"50%",position:"absolute"})},onUnload:function(){if(this.contentSourceElement){target=this.select(".modal_content").first();this.select("form").invoke("reset");$A(target.childNodes).each(function(A){this.contentSourceElement.appendChild(A)}.bind(this))}}});PBwiki.DialogFactory=parent.PBwiki.DialogFactory||{activeDialog:null,cache:{},background:new Element("div",{"class":"modalbg"}),defaultDimensions:{width:400,height:"auto"},resize:function(A){if(this.activeDialog){this.activeDialog.resize(Object.extend(PBwiki.DialogFactory.defaultDimensions,A))}},close:function(A){if(this.activeDialog){this.activeDialog.close(A);if(this.activeDialog.closeable==true){document.stopObserving("keypress",PBwiki.DialogFactory.trapKeyEsc)}this.activeDialog=null}if(typeof (Effect)!="undefined"){Effect.Fade(PBwiki.DialogFactory.background,{duration:0.1})}else{PBwiki.DialogFactory.background.hide()}},setTitle:function(A){if(PBwiki.DialogFactory.activeDialog){PBwiki.DialogFactory.activeDialog.setTitle(A)}},recenter:function(){if(PBwiki.DialogFactory.activeDialog){PBwiki.DialogFactory.activeDialog.recenter()}},showBackground:function(){if(PBwiki.DialogFactory.background.parentNode!=document.body){PBwiki.DialogFactory.background.innerHTML='<!--[if lte IE 6.5]><iframe src="about:blank" class="iefix"></iframe><![endif]-->';document.body.appendChild(PBwiki.DialogFactory.background)}if(!document.evaluate){PBwiki.DialogFactory.background.style.height=document.body.clientHeight;PBwiki.DialogFactory.background.style.width=document.documentElement.clientWidth}PBwiki.DialogFactory.background.setStyle({display:"block"});PBwiki.DialogFactory.background.setOpacity(0.3)},open:function(B,D,C,A){C=Object.extend({renderAs:"div",contentSource:"ajax",expireCache:true,dimensions:PBwiki.DialogFactory.defaultDimensions,closeable:true,onClosed:Prototype.emptyFunction,onOpened:Prototype.emptyFunction},C);D=D||"No Title";if(C.renderAs=="iframe"){C.contentSource=C.renderAs}else{if(C.renderAs=="div"&&!C.contentSource){C.contentSource="ajax"}}A=Object.extend({evalScripts:true,parameters:"",method:"post"},A);if(this.activeDialog){C.contentSource=this.activeDialog.renderMode;C.dimensions=this.activeDialog.originalSize}this[("open-"+C.contentSource.toLowerCase()).camelize()](B,D,C,A);if(C.closeable==true){document.observe("keypress",PBwiki.DialogFactory.trapKeyEsc)}},trapKeyEsc:function(A){if(A.keyCode==Event.KEY_ESC){document.fire("dialog:close")}},openPage:function(C,G,F,A){var E;var D=this.activeDialog;var B=F.dimensions.width;C=$(C);if(!D){D=new Element("div",{className:"modal"});D.appendChild(new Element("div",{className:"modal_title"}));D.firstChild.innerHTML="<h3>"+G+"</h3>";D.firstChild.innerHTML+=(F.closeable?'<a href="javascript:PBwiki.DialogFactory.close()"></a>':"");E=new Element("div",{className:"modal_content"});D.appendChild(E);Object.extend(D,PBwiki.Components.Dialog.prototype);D.contentSourceElement=C;D.onClosed=F.onClosed;D.closeable=F.closeable;this.activeDialog=D}else{D.onUnload();E=D.getElementsByClassName("modal_content")[0]}this.showBackground();$A(C.childNodes).each(function(H){E.appendChild(H)});D.display(F)},openAjax:function(C,G,F,A){var E;var D=this.activeDialog;var B=F.dimensions.width;if(!D){D=new Element("div",{className:"modal"});D.appendChild(new Element("div",{className:"modal_title"}));D.firstChild.innerHTML="<h3>"+G+"</h3>";D.firstChild.innerHTML+=(F.closeable?'<a href="javascript:PBwiki.DialogFactory.close()"></a>':"");E=new Element("div",{className:"modal_content"});D.appendChild(E);Object.extend(D,PBwiki.Components.Dialog.prototype);D.onClosed=F.onClosed;this.activeDialog=D}else{E=D.getElementsByClassName("modal_content")[0]}this.showBackground();this.ajax=new Ajax.Updater(E,C,{onComplete:function(I){if(F.templateObject){var H=new Template(E.innerHTML);H.innerHTML=H.evaluate(F.templateObject)}D.display(F);F.onOpened()},method:"get"})},openIframe:function(A,G,C,B){var E;var H;var F;var I=this.activeDialog;if(typeof B.parameters=="object"){B.parameters=$H(B.parameters)}if(!I){I=new Element("div",{className:"modal"});I.appendChild(new Element("div",{className:"modal_title"}));I.firstChild.innerHTML="<h3>"+G+"</h3>";I.firstChild.innerHTML+=(C.closeable?'<a href="javascript:PBwiki.DialogFactory.close()"></a>':"");var D=new Element("div",{className:"modal_content"});E=new Element("iframe",{scrolling:"no",frameborder:"no",style:"width: 100%",allowTransparency:true,name:"__modal_iframe_target"});D.appendChild(E);I.style.display=Prototype.Browser.WebKit?"":"none";I.appendChild(D);Object.extend(I,PBwiki.Components.Dialog.prototype);I.onClosed=C.onClosed;this.activeDialog=I}else{E=this.activeDialog.childNodes[1].firstChild}switch(B.method){case"post":if(typeof B.parameters=="object"&&B.parameters.keys().length>0){H=this.buildIframeForm(A,B.parameters);F="javascript:void(0);";break}case"get":default:F=A+(typeof B.parameters=="object"?"?"+B.parameters.toQueryString():B.parameters)}document.body.appendChild(I);this.showBackground();E.src=F;Event.observe(E,"load",function(){I.displayIframe(C)});if(H){H.target="__modal_iframe_target";document.body.appendChild(H);H.id="_f1";H.submit();post.remove()}},buildIframeForm:function(B,C){var A=new Element("form",{action:B,method:"post"});$H(C).each(function(D){A.appendChild(new Element("input",{name:D.key,value:D.value}))});return A},cancelLoading:function(){this.ajax.transport.abort();this.activeDialog.remove();delete this.activeDialog;PBwiki.DialogFactory.background.hide()},initialize:function(){document.observe("dialog:close",PBwiki.DialogFactory.close.bind(PBwiki.DialogFactory))}};PBwiki.init(PBwiki.DialogFactory);var SWFUpload;if(SWFUpload==undefined){SWFUpload=function(A){this.initSWFUpload(A)}}SWFUpload.prototype.initSWFUpload=function(B){try{this.customSettings={};this.settings=B;this.eventQueue=[];this.movieName="SWFUpload_"+SWFUpload.movieCount++;this.movieElement=null;SWFUpload.instances[this.movieName]=this;this.initSettings();this.loadFlash();this.displayDebugInfo()}catch(A){delete SWFUpload.instances[this.movieName];throw A}};SWFUpload.instances={};SWFUpload.movieCount=0;SWFUpload.version="2.2.0 Beta 2";SWFUpload.QUEUE_ERROR={QUEUE_LIMIT_EXCEEDED:-100,FILE_EXCEEDS_SIZE_LIMIT:-110,ZERO_BYTE_FILE:-120,INVALID_FILETYPE:-130};SWFUpload.UPLOAD_ERROR={HTTP_ERROR:-200,MISSING_UPLOAD_URL:-210,IO_ERROR:-220,SECURITY_ERROR:-230,UPLOAD_LIMIT_EXCEEDED:-240,UPLOAD_FAILED:-250,SPECIFIED_FILE_ID_NOT_FOUND:-260,FILE_VALIDATION_FAILED:-270,FILE_CANCELLED:-280,UPLOAD_STOPPED:-290};SWFUpload.FILE_STATUS={QUEUED:-1,IN_PROGRESS:-2,ERROR:-3,COMPLETE:-4,CANCELLED:-5};SWFUpload.BUTTON_ACTION={SELECT_FILE:-100,SELECT_FILES:-110,START_UPLOAD:-120};SWFUpload.CURSOR={ARROW:-1,HAND:-2};SWFUpload.WINDOW_MODE={WINDOW:"window",TRANSPARENT:"transparent",OPAQUE:"opaque"};SWFUpload.prototype.initSettings=function(){this.ensureDefault=function(B,A){this.settings[B]=(this.settings[B]==undefined)?A:this.settings[B]};this.ensureDefault("upload_url","");this.ensureDefault("file_post_name","Filedata");this.ensureDefault("post_params",{});this.ensureDefault("use_query_string",false);this.ensureDefault("requeue_on_error",false);this.ensureDefault("http_success",[]);this.ensureDefault("file_types","*.*");this.ensureDefault("file_types_description","All Files");this.ensureDefault("file_size_limit",0);this.ensureDefault("file_upload_limit",0);this.ensureDefault("file_queue_limit",0);this.ensureDefault("flash_url","swfupload.swf");this.ensureDefault("prevent_swf_caching",true);this.ensureDefault("button_image_url","");this.ensureDefault("button_width",1);this.ensureDefault("button_height",1);this.ensureDefault("button_text","");this.ensureDefault("button_text_style","color: #000000; font-size: 16pt;");this.ensureDefault("button_text_top_padding",0);this.ensureDefault("button_text_left_padding",0);this.ensureDefault("button_action",SWFUpload.BUTTON_ACTION.SELECT_FILES);this.ensureDefault("button_disabled",false);this.ensureDefault("button_placeholder_id",null);this.ensureDefault("button_cursor",SWFUpload.CURSOR.ARROW);this.ensureDefault("button_window_mode",SWFUpload.WINDOW_MODE.WINDOW);this.ensureDefault("debug",false);this.settings.debug_enabled=this.settings.debug;this.settings.return_upload_start_handler=this.returnUploadStart;this.ensureDefault("swfupload_loaded_handler",null);this.ensureDefault("file_dialog_start_handler",null);this.ensureDefault("file_queued_handler",null);this.ensureDefault("file_queue_error_handler",null);this.ensureDefault("file_dialog_complete_handler",null);this.ensureDefault("upload_start_handler",null);this.ensureDefault("upload_progress_handler",null);this.ensureDefault("upload_error_handler",null);this.ensureDefault("upload_success_handler",null);this.ensureDefault("upload_complete_handler",null);this.ensureDefault("debug_handler",this.debugMessage);this.ensureDefault("custom_settings",{});this.customSettings=this.settings.custom_settings;if(this.settings.prevent_swf_caching){this.settings.flash_url=this.settings.flash_url+"?swfuploadrnd="+Math.floor(Math.random()*999999999)}delete this.ensureDefault};SWFUpload.prototype.loadFlash=function(){if(this.settings.button_placeholder_id!==""){this.replaceWithFlash()}else{this.appendFlash()}};SWFUpload.prototype.appendFlash=function(){var B,A;if(document.getElementById(this.movieName)!==null){throw"ID "+this.movieName+" is already in use. The Flash Object could not be added"}B=document.getElementsByTagName("body")[0];if(B==undefined){throw"Could not find the 'body' element."}A=document.createElement("div");A.style.width="1px";A.style.height="1px";A.style.overflow="hidden";B.appendChild(A);A.innerHTML=this.getFlashHTML()};SWFUpload.prototype.replaceWithFlash=function(){var A,B;if(document.getElementById(this.movieName)!==null){throw"ID "+this.movieName+" is already in use. The Flash Object could not be added"}A=document.getElementById(this.settings.button_placeholder_id);if(A==undefined){throw"Could not find the placeholder element."}B=document.createElement("div");B.innerHTML=this.getFlashHTML();A.parentNode.replaceChild(B.firstChild,A)};SWFUpload.prototype.getFlashHTML=function(){return['<object id="',this.movieName,'" type="application/x-shockwave-flash" data="',this.settings.flash_url,'" width="',this.settings.button_width,'" height="',this.settings.button_height,'" class="swfupload">','<param name="wmode" value="',this.settings.button_window_mode,'" />','<param name="movie" value="',this.settings.flash_url,'" />','<param name="quality" value="high" />','<param name="menu" value="false" />','<param name="allowScriptAccess" value="always" />','<param name="flashvars" value="'+this.getFlashVars()+'" />',"</object>"].join("")};SWFUpload.prototype.getFlashVars=function(){var B=this.buildParamString();var A=this.settings.http_success.join(",");return["movieName=",encodeURIComponent(this.movieName),"&amp;uploadURL=",encodeURIComponent(this.settings.upload_url),"&amp;useQueryString=",encodeURIComponent(this.settings.use_query_string),"&amp;requeueOnError=",encodeURIComponent(this.settings.requeue_on_error),"&amp;httpSuccess=",encodeURIComponent(A),"&amp;params=",encodeURIComponent(B),"&amp;filePostName=",encodeURIComponent(this.settings.file_post_name),"&amp;fileTypes=",encodeURIComponent(this.settings.file_types),"&amp;fileTypesDescription=",encodeURIComponent(this.settings.file_types_description),"&amp;fileSizeLimit=",encodeURIComponent(this.settings.file_size_limit),"&amp;fileUploadLimit=",encodeURIComponent(this.settings.file_upload_limit),"&amp;fileQueueLimit=",encodeURIComponent(this.settings.file_queue_limit),"&amp;debugEnabled=",encodeURIComponent(this.settings.debug_enabled),"&amp;buttonImageURL=",encodeURIComponent(this.settings.button_image_url),"&amp;buttonWidth=",encodeURIComponent(this.settings.button_width),"&amp;buttonHeight=",encodeURIComponent(this.settings.button_height),"&amp;buttonText=",encodeURIComponent(this.settings.button_text),"&amp;buttonTextTopPadding=",encodeURIComponent(this.settings.button_text_top_padding),"&amp;buttonTextLeftPadding=",encodeURIComponent(this.settings.button_text_left_padding),"&amp;buttonTextStyle=",encodeURIComponent(this.settings.button_text_style),"&amp;buttonAction=",encodeURIComponent(this.settings.button_action),"&amp;buttonDisabled=",encodeURIComponent(this.settings.button_disabled),"&amp;buttonCursor=",encodeURIComponent(this.settings.button_cursor)].join("")};SWFUpload.prototype.getMovieElement=function(){if(this.movieElement==undefined){this.movieElement=document.getElementById(this.movieName)}if(this.movieElement===null){throw"Could not find Flash element"}return this.movieElement};SWFUpload.prototype.buildParamString=function(){var C=this.settings.post_params;var B=[];if(typeof (C)==="object"){for(var A in C){if(C.hasOwnProperty(A)){B.push(encodeURIComponent(A.toString())+"="+encodeURIComponent(C[A].toString()))}}}return B.join("&amp;")};SWFUpload.prototype.destroy=function(){try{this.stopUpload();var B=null;try{B=this.getMovieElement()}catch(C){}if(B!=undefined&&B.parentNode!=undefined&&typeof B.parentNode.removeChild==="function"){var A=B.parentNode;if(A!=undefined){A.removeChild(B);if(A.parentNode!=undefined&&typeof A.parentNode.removeChild==="function"){A.parentNode.removeChild(A)}}}SWFUpload.instances[this.movieName]=null;delete SWFUpload.instances[this.movieName];delete this.movieElement;delete this.settings;delete this.customSettings;delete this.eventQueue;delete this.movieName;delete window[this.movieName];return true}catch(D){return false}};SWFUpload.prototype.displayDebugInfo=function(){this.debug(["---SWFUpload Instance Info---\n","Version: ",SWFUpload.version,"\n","Movie Name: ",this.movieName,"\n","Settings:\n","\t","upload_url:               ",this.settings.upload_url,"\n","\t","flash_url:                ",this.settings.flash_url,"\n","\t","use_query_string:         ",this.settings.use_query_string.toString(),"\n","\t","requeue_on_error:         ",this.settings.requeue_on_error.toString(),"\n","\t","http_success:             ",this.settings.http_success.join(", "),"\n","\t","file_post_name:           ",this.settings.file_post_name,"\n","\t","post_params:              ",this.settings.post_params.toString(),"\n","\t","file_types:               ",this.settings.file_types,"\n","\t","file_types_description:   ",this.settings.file_types_description,"\n","\t","file_size_limit:          ",this.settings.file_size_limit,"\n","\t","file_upload_limit:        ",this.settings.file_upload_limit,"\n","\t","file_queue_limit:         ",this.settings.file_queue_limit,"\n","\t","debug:                    ",this.settings.debug.toString(),"\n","\t","prevent_swf_caching:      ",this.settings.prevent_swf_caching.toString(),"\n","\t","button_placeholder_id:    ",this.settings.button_placeholder_id.toString(),"\n","\t","button_image_url:         ",this.settings.button_image_url.toString(),"\n","\t","button_width:             ",this.settings.button_width.toString(),"\n","\t","button_height:            ",this.settings.button_height.toString(),"\n","\t","button_text:              ",this.settings.button_text.toString(),"\n","\t","button_text_style:        ",this.settings.button_text_style.toString(),"\n","\t","button_text_top_padding:  ",this.settings.button_text_top_padding.toString(),"\n","\t","button_text_left_padding: ",this.settings.button_text_left_padding.toString(),"\n","\t","button_action:            ",this.settings.button_action.toString(),"\n","\t","button_disabled:          ",this.settings.button_disabled.toString(),"\n","\t","custom_settings:          ",this.settings.custom_settings.toString(),"\n","Event Handlers:\n","\t","swfupload_loaded_handler assigned:  ",(typeof this.settings.swfupload_loaded_handler==="function").toString(),"\n","\t","file_dialog_start_handler assigned: ",(typeof this.settings.file_dialog_start_handler==="function").toString(),"\n","\t","file_queued_handler assigned:       ",(typeof this.settings.file_queued_handler==="function").toString(),"\n","\t","file_queue_error_handler assigned:  ",(typeof this.settings.file_queue_error_handler==="function").toString(),"\n","\t","upload_start_handler assigned:      ",(typeof this.settings.upload_start_handler==="function").toString(),"\n","\t","upload_progress_handler assigned:   ",(typeof this.settings.upload_progress_handler==="function").toString(),"\n","\t","upload_error_handler assigned:      ",(typeof this.settings.upload_error_handler==="function").toString(),"\n","\t","upload_success_handler assigned:    ",(typeof this.settings.upload_success_handler==="function").toString(),"\n","\t","upload_complete_handler assigned:   ",(typeof this.settings.upload_complete_handler==="function").toString(),"\n","\t","debug_handler assigned:             ",(typeof this.settings.debug_handler==="function").toString(),"\n"].join(""))};SWFUpload.prototype.addSetting=function(B,C,A){if(C==undefined){return(this.settings[B]=A)}else{return(this.settings[B]=C)}};SWFUpload.prototype.getSetting=function(A){if(this.settings[A]!=undefined){return this.settings[A]}return""};SWFUpload.prototype.callFlash=function(C,D){D=D||[];var A=this.getMovieElement();var B;if(typeof A[C]==="function"){if(D.length===0){B=A[C]()}else{if(D.length===1){B=A[C](D[0])}else{if(D.length===2){B=A[C](D[0],D[1])}else{if(D.length===3){B=A[C](D[0],D[1],D[2])}else{throw"Too many arguments"}}}}if(B!=undefined&&typeof B.post==="object"){B=this.unescapeFilePostParams(B)}return B}else{throw"Invalid function name: "+C}};SWFUpload.prototype.selectFile=function(){this.callFlash("SelectFile")};SWFUpload.prototype.selectFiles=function(){this.callFlash("SelectFiles")};SWFUpload.prototype.startUpload=function(A){this.callFlash("StartUpload",[A])};SWFUpload.prototype.cancelUpload=function(A){this.callFlash("CancelUpload",[A])};SWFUpload.prototype.stopUpload=function(){this.callFlash("StopUpload")};SWFUpload.prototype.getStats=function(){return this.callFlash("GetStats")};SWFUpload.prototype.setStats=function(A){this.callFlash("SetStats",[A])};SWFUpload.prototype.getFile=function(A){if(typeof (A)==="number"){return this.callFlash("GetFileByIndex",[A])}else{return this.callFlash("GetFile",[A])}};SWFUpload.prototype.addFileParam=function(A,B,C){return this.callFlash("AddFileParam",[A,B,C])};SWFUpload.prototype.removeFileParam=function(A,B){this.callFlash("RemoveFileParam",[A,B])};SWFUpload.prototype.setUploadURL=function(A){this.settings.upload_url=A.toString();this.callFlash("SetUploadURL",[A])};SWFUpload.prototype.setPostParams=function(A){this.settings.post_params=A;this.callFlash("SetPostParams",[A])};SWFUpload.prototype.addPostParam=function(A,B){this.settings.post_params[A]=B;this.callFlash("SetPostParams",[this.settings.post_params])};SWFUpload.prototype.removePostParam=function(A){delete this.settings.post_params[A];this.callFlash("SetPostParams",[this.settings.post_params])};SWFUpload.prototype.setFileTypes=function(A,B){this.settings.file_types=A;this.settings.file_types_description=B;this.callFlash("SetFileTypes",[A,B])};SWFUpload.prototype.setFileSizeLimit=function(A){this.settings.file_size_limit=A;this.callFlash("SetFileSizeLimit",[A])};SWFUpload.prototype.setFileUploadLimit=function(A){this.settings.file_upload_limit=A;this.callFlash("SetFileUploadLimit",[A])};SWFUpload.prototype.setFileQueueLimit=function(A){this.settings.file_queue_limit=A;this.callFlash("SetFileQueueLimit",[A])};SWFUpload.prototype.setFilePostName=function(A){this.settings.file_post_name=A;this.callFlash("SetFilePostName",[A])};SWFUpload.prototype.setUseQueryString=function(A){this.settings.use_query_string=A;this.callFlash("SetUseQueryString",[A])};SWFUpload.prototype.setRequeueOnError=function(A){this.settings.requeue_on_error=A;this.callFlash("SetRequeueOnError",[A])};SWFUpload.prototype.setHTTPSuccess=function(A){if(typeof A==="string"){A=A.replace(" ","").split(",")}this.settings.http_success=A;this.callFlash("SetHTTPSuccess",[A])};SWFUpload.prototype.setDebugEnabled=function(A){this.settings.debug_enabled=A;this.callFlash("SetDebugEnabled",[A])};SWFUpload.prototype.setButtonImageURL=function(A){if(A==undefined){A=""}this.settings.button_image_url=A;this.callFlash("SetButtonImageURL",[A])};SWFUpload.prototype.setButtonDimensions=function(C,A){this.settings.button_width=C;this.settings.button_height=A;var B=this.getMovieElement();if(B!=undefined){B.style.width=C+"px";B.style.height=A+"px"}this.callFlash("SetButtonDimensions",[C,A])};SWFUpload.prototype.setButtonText=function(A){this.settings.button_text=A;this.callFlash("SetButtonText",[A])};SWFUpload.prototype.setButtonTextPadding=function(B,A){this.settings.button_text_top_padding=A;this.settings.button_text_left_padding=B;this.callFlash("SetButtonTextPadding",[B,A])};SWFUpload.prototype.setButtonTextStyle=function(A){this.settings.button_text_style=A;this.callFlash("SetButtonTextStyle",[A])};SWFUpload.prototype.setButtonDisabled=function(A){this.settings.button_disabled=A;this.callFlash("SetButtonDisabled",[A])};SWFUpload.prototype.setButtonAction=function(A){this.settings.button_action=A;this.callFlash("SetButtonAction",[A])};SWFUpload.prototype.setButtonCursor=function(A){this.settings.button_cursor=A;this.callFlash("SetButtonCursor",[A])};SWFUpload.prototype.queueEvent=function(B,C){if(C==undefined){C=[]}else{if(!(C instanceof Array)){C=[C]}}var A=this;if(typeof this.settings[B]==="function"){this.eventQueue.push(function(){this.settings[B].apply(this,C)});setTimeout(function(){A.executeNextEvent()},0)}else{if(this.settings[B]!==null){throw"Event handler "+B+" is unknown or is not a function"}}};SWFUpload.prototype.executeNextEvent=function(){var A=this.eventQueue?this.eventQueue.shift():null;if(typeof (A)==="function"){A.apply(this)}};SWFUpload.prototype.unescapeFilePostParams=function(C){var E=/[$]([0-9a-f]{4})/i;var F={};var D;if(C!=undefined){for(var A in C.post){if(C.post.hasOwnProperty(A)){D=A;var B;while((B=E.exec(D))!==null){D=D.replace(B[0],String.fromCharCode(parseInt("0x"+B[1],16)))}F[D]=C.post[A]}}C.post=F}return C};SWFUpload.prototype.flashReady=function(){var A=this.getMovieElement();if(typeof A.StartUpload!=="function"){throw"ExternalInterface methods failed to initialize."}if(window[this.movieName]==undefined){window[this.movieName]=A}this.queueEvent("swfupload_loaded_handler")};SWFUpload.prototype.fileDialogStart=function(){this.queueEvent("file_dialog_start_handler")};SWFUpload.prototype.fileQueued=function(A){A=this.unescapeFilePostParams(A);this.queueEvent("file_queued_handler",A)};SWFUpload.prototype.fileQueueError=function(A,C,B){A=this.unescapeFilePostParams(A);this.queueEvent("file_queue_error_handler",[A,C,B])};SWFUpload.prototype.fileDialogComplete=function(A,B){this.queueEvent("file_dialog_complete_handler",[A,B])};SWFUpload.prototype.uploadStart=function(A){A=this.unescapeFilePostParams(A);this.queueEvent("return_upload_start_handler",A)};SWFUpload.prototype.returnUploadStart=function(A){var B;if(typeof this.settings.upload_start_handler==="function"){A=this.unescapeFilePostParams(A);B=this.settings.upload_start_handler.call(this,A)}else{if(this.settings.upload_start_handler!=undefined){throw"upload_start_handler must be a function"}}if(B===undefined){B=true}B=!!B;this.callFlash("ReturnUploadStart",[B])};SWFUpload.prototype.uploadProgress=function(A,C,B){A=this.unescapeFilePostParams(A);this.queueEvent("upload_progress_handler",[A,C,B])};SWFUpload.prototype.uploadError=function(A,C,B){A=this.unescapeFilePostParams(A);this.queueEvent("upload_error_handler",[A,C,B])};SWFUpload.prototype.uploadSuccess=function(B,A){B=this.unescapeFilePostParams(B);this.queueEvent("upload_success_handler",[B,A])};SWFUpload.prototype.uploadComplete=function(A){A=this.unescapeFilePostParams(A);this.queueEvent("upload_complete_handler",A)};SWFUpload.prototype.debug=function(A){this.queueEvent("debug_handler",A)};SWFUpload.prototype.debugMessage=function(C){if(this.settings.debug){var A,D=[];if(typeof C==="object"&&typeof C.name==="string"&&typeof C.message==="string"){for(var B in C){if(C.hasOwnProperty(B)){D.push(B+": "+C[B])}}A=D.join("\n")||"";D=A.split("\n");A="EXCEPTION: "+D.join("\nEXCEPTION: ");SWFUpload.Console.writeLine(A)}else{SWFUpload.Console.writeLine(C)}}};SWFUpload.Console={};SWFUpload.Console.writeLine=function(D){var B,A;try{B=document.getElementById("SWFUpload_Console");if(!B){A=document.createElement("form");document.getElementsByTagName("body")[0].appendChild(A);B=document.createElement("textarea");B.id="SWFUpload_Console";B.style.fontFamily="monospace";B.setAttribute("wrap","off");B.wrap="off";B.style.overflow="auto";B.style.width="700px";B.style.height="350px";B.style.margin="5px";A.appendChild(B)}B.value+=D+"\n";B.scrollTop=B.scrollHeight-B.clientHeight}catch(C){alert("Exception: "+C.name+" Message: "+C.message)}};SWFUpload.GetSwfVer=function(){var G=-1;if(navigator.plugins!=null&&navigator.plugins.length>0){if(navigator.plugins["Shockwave Flash 2.0"]||navigator.plugins["Shockwave Flash"]){var F=navigator.plugins["Shockwave Flash 2.0"]?" 2.0":"";var A=navigator.plugins["Shockwave Flash"+F].description;var E=A.split(" ");var C=E[2].split(".");var H=C[0];var B=C[1];var D=E[3];if(D==""){D=E[4]}if(D[0]=="d"){D=D.substring(1)}else{if(D[0]=="r"){D=D.substring(1);if(D.indexOf("d")>0){D=D.substring(0,D.indexOf("d"))}}}var G=H+"."+B+"."+D}}else{if(Prototype.Browser.IE&&(navigator.appVersion.toLowerCase().indexOf("win")!=-1)&&!Prototype.Browser.Opera){G=SWFUpload.ControlVersion()}}return G};SWFUpload.DetectFlashVer=function(F,D,C){versionStr=SWFUpload.GetSwfVer();if(versionStr==-1){return false}else{if(versionStr!=0){if(Prototype.Browser.IE&&(navigator.appVersion.toLowerCase().indexOf("win")!=-1)&&!Prototype.Browser.Opera){tempArray=versionStr.split(" ");tempString=tempArray[1];versionArray=tempString.split(",")}else{versionArray=versionStr.split(".")}var E=versionArray[0];var A=versionArray[1];var B=versionArray[2];if(E>parseFloat(F)){return true}else{if(E==parseFloat(F)){if(A>parseFloat(D)){return true}else{if(A==parseFloat(D)){if(B>=parseFloat(C)){return true}}}}}return false}}};SWFUpload.ControlVersion=function(){var A=-1;var B;var C;try{B=new ActiveXObject("ShockwaveFlash.ShockwaveFlash.7");A=B.GetVariable("$version")}catch(C){}if(!A){try{B=new ActiveXObject("ShockwaveFlash.ShockwaveFlash.6");A="WIN 6,0,21,0";B.AllowScriptAccess="always";A=B.GetVariable("$version")}catch(C){}}return A};PBwiki.DialogCommands={};PBwiki.DialogCommands.TemplateDialog=Class.create({dialogOptions:{},initialize:function(A){this.options=A;this.dialogOptions={contentSource:"ajax",dimensions:Object.extend({width:400,height:"auto"},A.dimensions),onOpened:this.setupDialog.bind(this),templateObject:this.getTemplateObject()};PBwiki.DialogFactory.open("/layout/common/templates/dialog/"+this.templateName+".html",this.title,this.dialogOptions)},setupDialog:function(){this.active=PBwiki.DialogFactory.activeDialog;this.dialog=this.active.down(".modal_content")},getTemplateObject:function(){return false}});PBwiki.DialogCommands.CreateNewPage=Class.create(PBwiki.DialogCommands.TemplateDialog,{templateName:"newpage",title:"Create a new page",initialize:function($super,A){Object.extend(A,{dimensions:{width:700}});$super(A)},setupDialog:function($super){$super();this.saveButton=this.dialog.down("input.newpagesubmit");this.saveButton.observe("click",this.Execute.bindAsEventListener(this));this.dialog.down("form").observe("submit",this.Execute.bindAsEventListener(this));this.addFolderList();this.addTemplatesList();this.setupSecuritySelect();this.dialog.down("input.page_name").focus()},addFolderList:function(){this.folderSelect=this.dialog.down("select.newpagefolders");var A=PBwiki.getCache("GetFolders");if(!A){new PBwiki.APIRequest("GetFolders",{verbose:true},{onSuccess:this.updateFolderList.bind(this)})}else{this.updateFolderList(A)}},updateFolderList:function(A){A.folders.each(function(C){var B=new Element("option",{value:C.name}).update(C.name.escapeHTML());if(this.options.folder==C.name){B.selected=true}this.folderSelect.appendChild(B)}.bind(this))},addTemplatesList:function(){this.templateList=this.dialog.down("div.templates ul");var A=PBwiki.getCache("GetTemplates");if(A){this.updateTemplateList(A)}else{new PBwiki.APIRequest("GetTemplates",{},{onSuccess:this.updateTemplateList.bind(this)})}},setupSecuritySelect:function(){var A=this.dialog.down("select.newpagesecurity");if(!PBwiki.feature("page_security")||PBinfo.CheckPermissions.wikiperm!="admin"){this.dialog.down("div.newpagesecurityrow").hide()}else{A.appendChild(new Element("option",{value:"locked"}).update("locked"));if(!PBwiki.feature("public_only")){A.appendChild(new Element("option",{value:"hidden"}).update("hidden"))}}},updateTemplateList:function(A){if(!A.templates){return }A.templates.each(function(C){var B=new Element("label");var E=" "+C.replace("wiki.","");var D=new Element("input",{type:"radio",name:"template",value:C});B.appendChild(D);B.appendChild(document.createTextNode(E));this.templateList.appendChild(B.wrap("li"))}.bind(this))},Execute:function(G){if(G){G.stop()}var M=this.dialog.down("select.newpagesecurity");var J=(M)?M.options[M.selectedIndex].value:"";var E=this.folderSelect.options[this.folderSelect.selectedIndex].value;var L=this.dialog.select("input[type=radio]").find(function(N){return N.checked});var K=(L)?L.value:"";var I=this.dialog.down("input.page_name").value.strip();var B=Util.is_valid_page_name(I);if(B!==true){var C=this.dialog.down("span.newpageerror");C.innerHTML=B;setTimeout(function(){C.hide()},5000);return }var D={page:I};if(J!="default"){D.security=J}if(E){D.folder=E}if(K){D.template=K}var A=new Array();A.push(["CreatePage",D,{}]);if(!this.options.noPreloadView){A.push(["GetFolders",{verbose:true},{cacheability:["foldertime"],counted:false}]);var H=PBwiki.ObjectBrowser.view;var F=Object.clone(H.refreshOptions);F.sortby="mtime";F.reverse=true;A.push([H.apiMethod,F,{counted:false}])}this.saveButton.writeAttribute({disabled:true});new PBwiki.MultiAPIRequest(A,{incUsess:true,onAllComplete:function(O){if(O.successful==1){document.fire("dialog:close");this.notify("onCreate",I)}else{var N=this.dialog.down("span.newpageerror");N.update(O.lastError).show();setTimeout(function(){N.hide()},5000);this.saveButton.writeAttribute({disabled:false})}}.bind(this)})}});Object.Event.extend(PBwiki.DialogCommands.CreateNewPage);PBwiki.DialogCommands.FolderSelector=Class.create(PBwiki.DialogCommands.TemplateDialog,{templateName:"choosefolder",title:"Choose a Folder",initialize:function($super,A){Object.extend(A,{dimensions:{width:260}});$super(A)},setupDialog:function($super){$super();this.folderList=this.dialog.down(".dialog_folder_selector");if(this.options.buttonTitle){$("dialog_folder_move_btn").value=this.options.buttonTitle}var A=PBwiki.getCache("GetFolders");if(!A){new PBwiki.APIRequest("GetFolders",{},{onSuccess:this.setupFolderList.bind(this)})}else{this.setupFolderList(A)}$("dialog_folder_move_btn").observe("click",this.submitMoveCommand.bind(this))},setupFolderList:function(C){if(PBwiki.ObjectBrowser.view instanceof PBwiki.ObjectBrowser.ViewFolder){var B=PBwiki.ObjectBrowser.view.options.parameter;if(PBwiki.ObjectBrowser.view.name!="ViewUnfiled"){var A=new Element("a",{href:"",className:"iconbutton unfiled"}).observe("click",this.selectFolder.bindAsEventListener(this,"")).update("Remove from '"+B.escapeHTML()+"'").wrap("li");this.folderList.appendChild(A)}}C.folders.each(function(E){if(E.name==this.options.folder||!E.perms.w){return }var D=new Element("a",{href:"",className:"iconbutton folder"}).observe("click",this.selectFolder.bindAsEventListener(this,E.name)).update(E.name.escapeHTML()).wrap("li");this.folderList.appendChild(D)}.bind(this))},submitMoveCommand:function(A){if(this.selectedFolder||this.selectedFolder==""){document.fire("dialog:close");this.notify("onSelect",this.selectedFolder)}},selectFolder:function(C,B){C.stop();C.element().blur();var A=C.element().up();A.adjacent("li").invoke("removeClassName","active");A.addClassName("active");this.selectedFolder=B}});Object.Event.extend(PBwiki.DialogCommands.FolderSelector);PBwiki.DialogCommands.FolderSecurity=Class.create(PBwiki.DialogCommands.TemplateDialog,{cellTemplates:["#{name}",'<input type="hidden" class="securityuids" name="uid[]" value="#{uid}"/><select class="roleselect" name="role[]"><option value="read">Reader</option><option value="write">Writer</option><option value="edit">Editor</option></select>','<a class="securitydeletelink iconbutton deleteicon" href="#">&nbsp;</a>'],templateName:"foldersecurity",removedRows:{},initialize:function($super,A){this.title="Folder Security for "+A.folder.escapeHTML();Object.extend(A,{dimensions:{width:700}});$super(A)},setupDialog:function($super){$super();var A=new Array();A.push(["GetUsersInfos",{},{onSuccess:this.loadUserList.bind(this),onFailure:function(B){document.fire("dialog:close");document.fire("objectbrowser:onNotifyUser",{message:"Failed to load folder security user list. "+B,mode:"error"})}}]);A.push(["GetFolderSecurity",{folder:this.options.folder},{onSuccess:this.loadSecurityState.bind(this),onFailure:function(B){document.fire("dialog:close");document.fire("objectbrowser:onNotifyUser",{message:"Failed to load folder security. "+B,mode:"error"})}}]);this.active.hide();new PBwiki.MultiAPIRequest(A,{incUsess:true});$("securityadduserbutton").observe("click",this.addUser.bind(this));$("foldersecuritysubmit").observe("click",this.saveSecurity.bindAsEventListener(this))},addUser:function(){var D=$("foldersecurityusers");if(D.selectedIndex==-1){return }var C=D.options[D.selectedIndex];var A=this.dialog.select("input.securityuids").find(function(E){return(E.value==C.value)});if(A){alert("User '"+C.text+"' is already in the custom security list");return }var B={uid:C.value,name:C.text};this.addSecurityRow(B)},loadUserList:function(D){var F=D.uids;var C=$("foldersecurityusers");var A=PBwiki.getCache("CheckPermissions");for(var B=0;B<F.length;B++){if(F[B].id==A.uid||F[B].perm=="admin"||F[B].perm=="deny"){continue}var E=new Element("option",{value:F[B].uid}).update(PBwiki.ObjectBrowser.getAuthorNameFromObject(F[B]).escapeHTML());C.appendChild(E)}},saveSecurity:function(C){if(C){C.stop()}var B=new Array();if(this.hasCustomSecurity){var A=$("securitytable").select("input.securityuids");if(A){var B=A.collect(function(E){var D=E.next().options[E.next().selectedIndex].value;return["SetFolderUserPermission",{folder:this.options.folder,uid:E.value,perm:D},{}]}.bind(this))}$H(this.removedRows).each(function(D){B.push(["SetFolderUserPermission",{folder:this.options.folder,uid:D[0],perm:""},{}])}.bind(this))}B.unshift(["SetFolderHasCustomSecurity",{folder:this.options.folder,enabled:this.hasCustomSecurity},{}]);B.unshift(["SetFolderPublic",{folder:this.options.folder,"public":$("foldersecuritypublished").checked},{}]);B.push(["GetFolders",{verbose:true},{cacheability:["foldertime","permtime"],counted:false}]);new PBwiki.MultiAPIRequest(B,{incUsess:true,onAllComplete:function(D){this.notify("onSecurityChange");document.fire("dialog:close")}.bind(this)})},addSecurityRow:function(A){if(this.removedRows[A.uid]){delete this.removedRows[A.uid]}var B=$($("foldersecurityusersettings").insertRow(-1));this.cellTemplates.each(function(C){A.name=PBwiki.ObjectBrowser.getAuthorNameFromObject(A).escapeHTML();B.insertCell(-1).innerHTML=C.interpolate(A);var D=B.down("select.roleselect");if(D){for(var F=0;F<D.options.length;F++){if(D.options[F].value==A.perm){D.options[F].selected=true}}}var E=B.down("a.securitydeletelink");if(E){E.observe("click",function(G){if(G){G.stop()}this.removeSecurityRow(B)}.bindAsEventListener(this))}}.bind(this))},removeSecurityRow:function(A){this.removedRows[A.down("input.securityuids").value]=true;A.parentNode.removeChild(A)},loadSecurityState:function(C){try{this.hasCustomSecurity=!!C.perms;this.isPublished=C["public"];if(this.hasCustomSecurity){$("customsecurityradio").checked=true;for(var A=0;A<C.perms.length;A++){this.addSecurityRow(C.perms[A])}}else{$("defaultsecurityradio").checked=true}this.setVisibleSecurity();this.setPublicSecurity();$("customsecurityradio").observe("click",this.securityUserToggle.bind(this,true));$("defaultsecurityradio").observe("click",this.securityUserToggle.bind(this,false))}catch(B){alert(B.message)}this.active.show()},securityUserToggle:function(A){this.hasCustomSecurity=A;this.setVisibleSecurity()},setVisibleSecurity:function(){$("customsecurity").setStyle({display:((this.hasCustomSecurity)?"block":"none")});$("custom_security_button").setStyle({display:((this.hasCustomSecurity)?"inline-block":"none")})},setPublicSecurity:function(){this.dialog.down("div.foldersecurityprivate").setStyle({display:(!PBinfo.CurrentWiki.isPublic)?"block":"none"});$("foldersecuritypublished").checked=this.isPublished}});Object.Event.extend(PBwiki.DialogCommands.FolderSecurity);PBwiki.DialogCommands.FlashUploader=Class.create(PBwiki.DialogCommands.TemplateDialog,{templateName:"uploadfiles",title:"Upload Files",initialize:function($super,A){Object.extend(A,{dimensions:{width:400}});this.swfUpload=A.swf;$super(A)},setupDialog:function($super){try{$super();this.cancelButton=this.dialog.down("input.cancelupload");this.cancelButton.observe("click",this.cancelQueue.bind(this));if(PBinfo.GetStorageInfo&&PBinfo.GetStorageInfo.ratelimit_percent>=75){this.dialog.down("div.ratelimitwarning").show()}var D={file_queue_error_handler:this.fileQueueError.bind(this),upload_start_handler:this.uploadStart.bind(this),upload_progress_handler:this.uploadProgress.bind(this),upload_error_handler:this.uploadError.bind(this),upload_success_handler:this.uploadSuccess.bind(this),upload_complete_handler:this.uploadComplete.bind(this),file_queued_handler:this.fileQueued.bind(this),debug_handler:this.debugHandler.bind(this)};Object.extend(this.swfUpload.settings,D);var C=this.swfUpload.getStats();for(var B=0;B<C.files_queued;B++){var A=this.swfUpload.getFile(B);if(A.filestatus!=SWFUpload.FILE_STATUS.COMPLETE){this.fileQueued(A)}}this.swfUpload.startUpload()}catch(E){alert(E.message)}},cancelQueue:function(){var B=this.swfUpload.getStats();for(var A=0;A<B.files_queued;A++){this.swfUpload.cancelUpload()}},fileQueued:function(C){try{var A=new FileProgress(C,this.swfUpload.customSettings.progressTarget);A.SetStatus("Pending...");A.ToggleCancel(true,this.swfUpload)}catch(B){this.debug(B)}},fileQueueError:function(E,A,D){try{if(A===SWFUpload.QUEUE_ERROR.QUEUE_LIMIT_EXCEEDED){alert("You have attempted to queue too many files.\n"+(D===0?"You have reached the upload limit.":"You may select "+(D>1?"up to "+D+" files.":"one file.")));return }var B=new FileProgress(E,this.swfUpload.customSettings.progressTarget);B.SetError();B.ToggleCancel(false);switch(A){case SWFUpload.QUEUE_ERROR.FILE_EXCEEDS_SIZE_LIMIT:B.SetStatus("File is too big.");this.debug("Error Code: File too big, File name: "+E.name+", File size: "+E.size+", Message: "+D);break;case SWFUpload.QUEUE_ERROR.ZERO_BYTE_FILE:B.SetStatus("Cannot upload Zero Byte files.");this.debug("Error Code: Zero byte file, File name: "+E.name+", File size: "+E.size+", Message: "+D);break;case SWFUpload.QUEUE_ERROR.INVALID_FILETYPE:B.SetStatus("Invalid File Type.");this.debug("Error Code: Invalid File Type, File name: "+E.name+", File size: "+E.size+", Message: "+D);break;case SWFUpload.QUEUE_ERROR.QUEUE_LIMIT_EXCEEDED:alert("You have selected too many files.  "+(D>1?"You may only add "+D+" more files":"You cannot add any more files."));break;default:if(E!==null){B.SetStatus("Unhandled Error")}this.debug("Error Code: "+A+", File name: "+E.name+", File size: "+E.size+", Message: "+D);break}}catch(C){this.debug(C)}},fileDialogComplete:function(B){this.active.show();try{if(this.swfUpload.getStats().files_queued>0){this.cancelButton.disabled=false}else{this.uploadAllComplete()}this.swfUpload.startUpload()}catch(A){this.debug(A)}},uploadStart:function(C){try{var A=new FileProgress(C,this.swfUpload.customSettings.progressTarget);A.SetStatus("Uploading...");A.ToggleCancel(true,this.swfUpload)}catch(B){}return true},uploadProgress:function(F,E,D){try{var C=Math.ceil((E/D)*100);var A=new FileProgress(F,this.swfUpload.customSettings.progressTarget);A.SetProgress(C);A.SetStatus("Uploading...")}catch(B){this.debug(B)}},uploadSuccess:function(D,C){try{var A=new FileProgress(D,this.swfUpload.customSettings.progressTarget);A.SetComplete();A.SetStatus("Complete.");A.ToggleCancel(false)}catch(B){this.debug(B)}},uploadComplete:function(B){try{if(this.swfUpload.getStats().files_queued===0){this.cancelButton.disabled=true;if(this.swfUpload.getStats().files_queued===0){this.uploadAllComplete()}}else{setTimeout(function(){this.swfUpload.startUpload()}.bind(this),1000)}}catch(A){this.debug(A)}},uploadAllComplete:function(){$("fsUploadProgress1").update("");document.fire("dialog:close");this.notify("onUploaded",this.swfUpload.getStats().successful_uploads,this.lastErrorMsg);this.swfUpload.setStats({successful_uploads:0})},uploadError:function(D,A,C){var B=new FileProgress(D,this.swfUpload.customSettings.progressTarget);B.SetError();B.ToggleCancel(false);switch(A){case SWFUpload.UPLOAD_ERROR.HTTP_ERROR:B.SetStatus("Upload Error: "+C);this.debug("Error Code: HTTP Error, File name: "+D.name+", Message: "+C);break;case SWFUpload.UPLOAD_ERROR.MISSING_UPLOAD_URL:B.SetStatus("Configuration Error");this.debug("Error Code: No backend file, File name: "+D.name+", Message: "+C);break;case SWFUpload.UPLOAD_ERROR.UPLOAD_FAILED:B.SetStatus("Upload Failed.");this.debug("Error Code: Upload Failed, File name: "+D.name+", File size: "+D.size+", Message: "+C);break;case SWFUpload.UPLOAD_ERROR.IO_ERROR:B.SetStatus("Server (IO) Error");this.debug("Error Code: IO Error, File name: "+D.name+", Message: "+C);break;case SWFUpload.UPLOAD_ERROR.SECURITY_ERROR:B.SetStatus("Security Error");this.debug("Error Code: Security Error, File name: "+D.name+", Message: "+C);break;case SWFUpload.UPLOAD_ERROR.UPLOAD_LIMIT_EXCEEDED:B.SetStatus("Upload limit exceeded.");this.debug("Error Code: Upload Limit Exceeded, File name: "+D.name+", File size: "+D.size+", Message: "+C);break;case SWFUpload.UPLOAD_ERROR.SPECIFIED_FILE_ID_NOT_FOUND:B.SetStatus("File not found.");this.debug("Error Code: The file was not found, File name: "+D.name+", File size: "+D.size+", Message: "+C);break;case SWFUpload.UPLOAD_ERROR.FILE_VALIDATION_FAILED:B.SetStatus("Failed Validation.  Upload skipped.");this.debug("Error Code: File Validation Failed, File name: "+D.name+", File size: "+D.size+", Message: "+C);break;case SWFUpload.UPLOAD_ERROR.FILE_CANCELLED:if(this.swfUpload.getStats().files_queued===0){this.cancelButton.disabled=true}B.SetStatus("Cancelled");B.SetCancelled();break;case SWFUpload.UPLOAD_ERROR.UPLOAD_STOPPED:B.SetStatus("Stopped");break;default:B.SetStatus("Unhandled Error: "+A);this.debug("Error Code: "+A+", File name: "+D.name+", File size: "+D.size+", Message: "+C);break}},debug:function(A){PBwiki.info(A)},debugHandler:function(D){var F=(typeof (D)==="object"&&typeof (D.name)==="string"&&typeof (D.message)==="string");if(F||D.indexOf("Exception: Error:")!=-1){this.setupLegacy();this.active.show()}if(this.swfUpload.settings&&this.swfUpload.settings.debug){var A,E=[];if(F){for(var B in D){if(D.hasOwnProperty(B)){E.push(B+": "+D[B])}}A=E.join("\n")||"";E=A.split("\n");A="EXCEPTION: "+E.join("\nEXCEPTION: ");PBwiki.info(A)}else{var C=D.match(/<error_string>(.*?)<\/error_string>/);if(C){this.lastErrorMsg=C[1]}PBwiki.info(D)}}}});Object.Event.extend(PBwiki.DialogCommands.FlashUploader);PBwiki.DialogCommands.LegacyUploader=Class.create(PBwiki.DialogCommands.TemplateDialog,{templateName:"legacyupload",title:"Upload a File",setupDialog:function($super){$super();this.legacyUpload=this.dialog.down("div.formupload");this.legacyForm=this.legacyUpload.down("form");this.legacyInput=this.legacyUpload.down("input.dialog_formupload_filename");this.legacyFrame=this.legacyUpload.down("iframe.dialog_formupload_frame");if(this.options.uploadUrl){this.legacyForm.setAttribute("action",this.options.uploadUrl)}this.legacyInput.observe("change",function(){try{this.legacyForm.submit();this.legacyUpload.down("div.dialog_formupload_status").update("Uploading...");this.legacyUploadCheck()}catch(A){}}.bind(this))},legacyUploadCheck:function(){if(this.legacyFrame.contentWindow.document.body.innerHTML!=""){setTimeout(function(){document.fire("dialog:close");this.notify("onUploaded",1)}.bind(this),1000)}else{this.legacyUploadCheck.bind(this).delay(1)}}});Object.Event.extend(PBwiki.DialogCommands.LegacyUploader);function FileProgress(D,B){this.file_progress_id=D.id;this.opacity=100;this.height=0;this.fileProgressWrapper=document.getElementById(this.file_progress_id);if(!this.fileProgressWrapper){this.fileProgressWrapper=document.createElement("div");this.fileProgressWrapper.className="progressWrapper";this.fileProgressWrapper.id=this.file_progress_id;this.fileProgressElement=document.createElement("div");this.fileProgressElement.className="progressContainer";var F=document.createElement("a");F.className="progressCancel";F.href="#";F.style.visibility="hidden";F.appendChild(document.createTextNode(" "));var A=document.createElement("div");A.className="progressName";A.appendChild(document.createTextNode(D.name));var E=document.createElement("div");E.className="progressBarInProgress";var C=document.createElement("div");C.className="progressBarStatus";C.innerHTML="&nbsp;";this.fileProgressElement.appendChild(F);this.fileProgressElement.appendChild(A);this.fileProgressElement.appendChild(C);this.fileProgressElement.appendChild(E);this.fileProgressWrapper.appendChild(this.fileProgressElement);document.getElementById(B).appendChild(this.fileProgressWrapper)}else{this.fileProgressElement=this.fileProgressWrapper.firstChild}this.height=this.fileProgressWrapper.offsetHeight}FileProgress.prototype.SetProgress=function(A){this.fileProgressElement.className="progressContainer green";this.fileProgressElement.childNodes[3].className="progressBarInProgress";this.fileProgressElement.childNodes[3].style.width=A+"%"};FileProgress.prototype.SetComplete=function(){this.fileProgressElement.className="progressContainer blue";this.fileProgressElement.childNodes[3].className="progressBarComplete";this.fileProgressElement.childNodes[3].style.width="";var A=this;setTimeout(function(){A.Disappear()},3000)};FileProgress.prototype.SetError=function(){this.fileProgressElement.className="progressContainer red";this.fileProgressElement.childNodes[3].className="progressBarError";this.fileProgressElement.childNodes[3].style.width="";var A=this;setTimeout(function(){A.Disappear()},5000)};FileProgress.prototype.SetCancelled=function(){this.fileProgressElement.className="progressContainer";this.fileProgressElement.childNodes[3].className="progressBarError";this.fileProgressElement.childNodes[3].style.width="";var A=this;setTimeout(function(){A.Disappear()},2000)};FileProgress.prototype.SetStatus=function(A){this.fileProgressElement.childNodes[2].innerHTML=A};FileProgress.prototype.ToggleCancel=function(A,B){this.fileProgressElement.childNodes[0].style.visibility=A?"visible":"hidden";if(B){var C=this.file_progress_id;this.fileProgressElement.childNodes[0].onclick=function(){B.cancelUpload(C);return false}}};FileProgress.prototype.Disappear=function(){try{Effect.Fade(this.fileProgressWrapper,{duration:1})}catch(A){}};PBwiki.DialogCommands.RateLimited=Class.create(PBwiki.DialogCommands.TemplateDialog,{templateName:"ratelimited",title:"Sorry, uploading is currently disabled",setupDialog:function($super){$super();var A=PBwiki.getCache("GetStorageInfo");$("ratelimit").hide();$("ratelimit_storage").hide();$("ratelimit_quota").innerHTML=A.total_readable;(A.ratelimited)?$("ratelimit").show():$("ratelimit_storage").show()}});PBButton=Class.create({initialize:function(A){var B={};Object.extend(B,A);this.options=B;this.create();this.enable();this.elm.observe("click",this.clicked.bindAsEventListener(this));return this},clicked:function(){if(this.isEnabled){this.notify("onClick")}},create:function(){this.elm=new Element("a",{id:this.options.id}).addClassName("button");this.span=new Element("span").update(this.options.txt);if(this.options.icon){this.span.addClassName(this.options.icon).addClassName("iconbutton")}if(this.options.className){this.span.className=this.options.className}this.elm.appendChild(this.span);if(this.options.addTo){this.addTo(this.options.addTo)}},disable:function(){this.isEnabled=false;this.elm.addClassName("disabled")},enable:function(){this.isEnabled=true;this.elm.removeClassName("disabled")},addTo:function(A){A.appendChild(this.elm)}});Object.Event.extend(PBButton);PBwiki.Components=PBwiki.Components||{};PBwiki.Components.Button=PBButton;PBwiki.Components.FolderSecurityButton=Class.create(PBwiki.Components.Button,{create:function($super){$super();PBwiki.info(this);this.elm.addClassName("folder_sec");if(this.options.has_custom_perms){this.span.appendChild(new Element("sub").update("&nbsp;"))}}});PBwiki.Components.FileUploadButton=Class.create(PBwiki.Components.Button,{create:function($super){$super();this.placeholder=new Element("div",{id:this.options.id+"_placeholder"});this.elm.insertBefore(this.placeholder,this.elm.firstChild);if(SWFUpload.DetectFlashVer(9,0,0)){this.createSwf()}this.obj=this.elm.down("object");if(this.obj){this.obj.setStyle({position:"absolute",zIndex:1000});if(Prototype.Browser.Gecko){this.obj.observe("mousedown",function(A){A.stop()})}}},setUploadFolder:function(A){this.options.folder=A;if(this.flashLoaded&&A){this.swf.setUploadURL(this.getUploadUrl());this.swf.addPostParam("folder",this.options.folder)}},getUploadUrl:function(){var A={op:"PutFile",verbose:"true",_type:"xml"};Object.extend(A,PBwiki.getSessCookie());if(this.options.folder){A.folder=this.options.folder}return"/api_v2/?"+Object.toQueryString(A)},clicked:function(A){A.stop();if(this.isEnabled){setTimeout(this.openLegacyUpload.bind(this),100)}},disable:function(){if(this.obj){this.obj.hide()}this.isEnabled=false;this.elm.addClassName("disabled")},enable:function(){if(this.obj){this.obj.show()}this.isEnabled=true;this.elm.removeClassName("disabled")},openLegacyUpload:function(){if(this.isEnabled&&!this.flashLoaded){if(this.isRateLimited()){new PBwiki.DialogCommands.RateLimited({})}else{new PBwiki.DialogCommands.LegacyUploader({uploadUrl:this.getUploadUrl(),onUploaded:this.uploadFinshed.bind(this),folder:this.folder})}}},filesSelected:function(A){if(!this.flashLoaded){return false}try{this.obj.blur()}catch(B){}if(A==0){this.notify("onUploaded",0,"No files selected")}else{if(this.isRateLimited()){new PBwiki.DialogCommands.RateLimited({})}else{this.flashUploader=new PBwiki.DialogCommands.FlashUploader({swf:this.swf,onUploaded:this.uploadFinshed.bind(this)})}}},flashLoad:function(){this.flashLoaded=true;this.setUploadFolder(this.options.folder)},isRateLimited:function(){var A=PBwiki.getCache("GetStorageInfo");return A&&(A.ratelimited||((A.total>0)&&(A.used>A.total)))},uploadFinshed:function(A,B){this.notify("onUploaded",A,B)},createSwf:function(){var A={upload_url:this.getUploadUrl(),file_size_limit:"1073741824",file_types:"*.*",file_types_description:"All Files",file_upload_limit:"10",file_queue_limit:"10",button_width:this.elm.getWidth(),button_height:this.elm.getHeight(),button_placeholder_id:this.options.id+"_placeholder",button_window_mode:SWFUpload.WINDOW_MODE.TRANSPARENT,button_text_top_padding:4,button_text_left_padding:8,file_dialog_start_handler:this.flashLoad.bind(this),file_dialog_complete_handler:this.filesSelected.bind(this),debug_handler:this.debug.bind(this),flash_url:"/swf/swfupload.swf?v=101",custom_settings:{progressTarget:"fsUploadProgress1"},debug:true};this.swf=new SWFUpload(A)},debug:function(A){PBwiki.info(A)}});var Tooltip=Class.create();Tooltip.setup=function(){document.observe("mousemove",function(A){this.xCord=Event.pointerX(A);this.yCord=Event.pointerY(A)}.bind(Tooltip))};Tooltip.prototype={initialize:function(B,A){this.el=$(B);this.initialized=false;this.setOptions(A);this.showEvent=this.show.bindAsEventListener(this);this.hideEvent=this.hide.bindAsEventListener(this);this.updateEvent=this.update.bindAsEventListener(this);Event.observe(this.el,"mouseover",this.showEvent);Event.observe(this.el,"mouseout",this.hideEvent);this.content=this.options.txt;this.el.title="";this.el.descendants().each(function(C){if(Element.readAttribute(C,"alt")){C.alt=""}});Tooltip.setup()},setOptions:function(A){this.options={backgroundColor:"#fff",borderColor:"#ccc",textColor:"",textShadowColor:"",maxWidth:450,align:"left",delay:200,mouseFollow:true,opacity:0.95,appearDuration:0,hideDuration:0};Object.extend(this.options,A||{})},show:function(A){this.xCord=Event.pointerX(A);this.yCord=Event.pointerY(A);if(!this.initialized){this.timeout=window.setTimeout(this.appear.bind(this),this.options.delay)}},hide:function(A){if(this.initialized){if(this.appearingFX){this.appearingFX.cancel()}if(this.options.mouseFollow){Event.stopObserving(this.el,"mousemove",this.updateEvent)}if(typeof (Effect)!="undefined"){new Effect.Fade(this.tooltip,{duration:this.options.hideDuration,afterFinish:function(){Element.remove(this.tooltip)}.bind(this)})}else{this.tooltip.remove()}}this._clearTimeout(this.timeout);this.initialized=false},update:function(A){this.xCord=Event.pointerX(A);this.yCord=Event.pointerY(A);this.setup()},updateCoords:function(){this.xCord=Tooltip.xCord;this.yCord=Tooltip.yCord},checkNode:function(){if(!this.el){this.hide()}else{if(this.initialized){setTimeout(this.checkNode.bind(this),1000)}}},appear:function(){this.tooltip=new Element("div",{className:"tooltip",style:"display: none;"});var A=new Element("div",{className:"xtop"});A.appendChild(new Element("div",{className:"xb2",style:"background-color:"+this.options.backgroundColor+"; border-color:"+this.options.borderColor+";"}));A.appendChild(new Element("div",{className:"xb3",style:"background-color:"+this.options.backgroundColor+"; border-color:"+this.options.borderColor+";"}));A.appendChild(new Element("div",{className:"xb4",style:"background-color:"+this.options.backgroundColor+"; border-color:"+this.options.borderColor+";"}));var B=new Element("div",{className:"xboxcontent",style:"background-color:"+this.options.backgroundColor+"; border-color:"+this.options.borderColor+((this.options.textColor!="")?"; color:"+this.options.textColor:"")+((this.options.textShadowColor!="")?"; text-shadow:2px 2px 0"+this.options.textShadowColor+";":"")});var C=new Element("div",{className:"xbottom"});C.appendChild(new Element("div",{className:"xb4",style:"background-color:"+this.options.backgroundColor+"; border-color:"+this.options.borderColor+";"}));C.appendChild(new Element("div",{className:"xb3",style:"background-color:"+this.options.backgroundColor+"; border-color:"+this.options.borderColor+";"}));C.appendChild(new Element("div",{className:"xb2",style:"background-color:"+this.options.backgroundColor+"; border-color:"+this.options.borderColor+";"}));C.appendChild(new Element("div",{className:"xb1",style:"background-color:"+this.options.borderColor+";"}));this.tooltip.appendChild(A);this.tooltip.appendChild(B);this.tooltip.appendChild(C);this.tooltip.childNodes[1].innerHTML=this.content;document.body.insertBefore(this.tooltip,document.body.childNodes[0]);Element.extend(this.tooltip);this.options.width=this.tooltip.getWidth();this.tooltip.style.width=this.options.width+"px";this.setup();if(this.options.mouseFollow){Event.observe(this.el,"mousemove",this.updateEvent)}this.initialized=true;this.updateCoords();this.setup();if(typeof (Effect)!="undefined"){this.appearingFX=new Effect.Appear(this.tooltip,{duration:this.options.appearDuration,to:this.options.opacity})}else{this.tooltip.show()}this.checkNode()},setup:function(){if(this.options.width>this.options.maxWidth){this.options.width=this.options.maxWidth;this.tooltip.style.width=this.options.width+"px"}if(this.xCord+this.options.width>=Element.getWidth(document.body)){this.options.align="right";this.xCord=this.xCord-this.options.width+20}this.tooltip.style.left=this.xCord-7+"px";this.tooltip.style.top=this.yCord+22+"px"},_clearTimeout:function(A){clearTimeout(A);clearInterval(A);return null}};PBMenu=Class.create({initialize:function(A){var B={items:[]};Object.extend(B,A);this.options=B;this.items=new Array();this.create();this.enable();if(this.options.items){this.addItems(this.options.items)}this.onClickOpen=this.show.bind(this);this.onClickClose=this.off.bind(this);this.options.toggle.observe("click",this.onClickOpen)},toggle:function(A){if(A){A.stop();this.options.toggle.blur()}if(this.isOpen){this.hide()}else{this.show()}},create:function(){this.elm=new Element("div",{"class":"pbMenu"});this.listElm=new Element("ul");this.elm.appendChild(this.listElm);this.elm.appendChild(new Element("img",{src:"/layout/common/images/shadow.png",width:"100%"}));document.body.appendChild(this.elm)},disable:function(){this.isEnabled=false;this.elm.addClassName("disabled")},enable:function(){this.isEnabled=true;this.elm.removeClassName("disabled")},show:function(A){A.stop();A.element().blur();if(A.element().disabled){return }this.options.toggle.addClassName("active");if(this.isOpen||!this.isEnabled){return }var B=this.options.toggle.cumulativeOffset();if(Prototype.Browser.WebKit){B.left+=10;B.top+=40}B.top+=this.options.toggle.getHeight()-1;this.elm.setStyle({top:B.top+"px",left:(B.left-1)+"px",display:"block"});this.isOpen=true;this.notify("onOpen");this.options.toggle.stopObserving("click",this.onClickOpen).observe("click",this.onClickClose);document.observe("click",this.onClickClose)},off:function(A){A.stop();A.element().blur();this.hide()},hide:function(){this.timer=null;this.isOpen=false;this.elm.setStyle({display:"none"});this.notify("onClose");this.options.toggle.stopObserving("click",this.onClickClose).observe("click",this.onClickOpen).removeClassName("active");document.stopObserving("click",this.onClickClose)},addItems:function(A){A.each(function(B){this.add(new PBMenu.Item(this,B))}.bind(this))},add:function(A){this.items.push(A);this.listElm.appendChild(A.elm)},getItem:function(B){for(var A=0;A<this.items.length;A++){if(this.items[A].options.name==B){return this.items[A]}}},removeAll:function(){this.items.each(function(A){this.remove(A)}.bind(this))},remove:function(A){A.remove();this.items=this.items.without(A)}});Object.Event.extend(PBMenu);PBMenu.Item=Class.create({initialize:function(B,A){this.options=A;this.menu=B;this.elm=new Element("li").update(A.txt).observe("click",this.activate.bind(this)).addClassName(A.className);if(this.options.className){this.elm.className=this.options.className}(this.options.disabled)?this.disable():this.enable()},disable:function(){this.isDisabled=true;this.elm.addClassName("disabled")},enable:function(){this.isDisabled=false;this.elm.removeClassName("disabled")},activate:function(){if(!this.isDisabled){this.menu.hide();this.notify("onClick")}},remove:function(){this.elm.parentNode.removeChild(this.elm)}});Object.Event.extend(PBMenu.Item);PBwiki.UserPrefs={set:function(C,B){var A=PBwiki.UserPrefs.get(C);if(A){Object.extend(A,B)}(function(){new PBwiki.APIRequest("SetUserPref",{key:C,value:Object.toJSON(B)})}).delay(2)},get:function(A){return null}};UserPrefs={initialize:function(A){if(A&&A.hide&&$("expand-collapse-page-link")){$(document.body).addClassName("fullwidth");Page.absolutizeUserContextSection()}if(A.modules){$H(A.modules).each(function(B){document.fire("ui:setmodulestate",{id:B.key,customstate:B.value==1})})}}};UserPrefs.Manager={url:"/userprefs.php",initialize:function(){document.observe("ui:toggleframesize",UserPrefs.Manager.toggleFrameSize);document.observe("ui:togglemodule",UserPrefs.Manager.toggleModule);if(ecpl=$("expand-collapse-page-link")){ecpl.observe("click",UserPrefs.Manager.toggleFullWidth)}},toggleFrameSize:function(A){new Ajax.Request(UserPrefs.Manager.url,{parameters:{togglesidebar:$(document.body).hasClassName("fullwidth")},method:"post"})},toggleModule:function(A){new Ajax.Request(UserPrefs.Manager.url,{parameters:{togglemodule:A.memo.minimized==true,id:A.memo.id}})},toggleFullWidth:function(A){if(!$("expand-collapse-page-link")){return }if(A){Event.stop(A);Event.element(A).blur()}$(document.body).toggleClassName("fullwidth").appendChild($("top-content").addClassName("abs"));if(PBwiki.getUID()){document.fire("ui:toggleframesize",$(document.body).hasClassName("fullwidth"))}},goFullWidth:function(){if(!$("expand-collapse-page-link")){return }$(document.body).addClassName("fullwidth").appendChild($("top-content").addClassName("abs"))},saveWidth:function(){this.savedWidth=$(document.body).hasClassName("fullwidth")},restoreWidth:function(){if($(document.body).hasClassName("fullwidth")!=this.savedWidth){$(document.body).toggleClassName("fullwidth").appendChild($("top-content").addClassName("abs"))}}};PBwiki.init(UserPrefs.Manager.initialize);var Page={};Page.AccessKeys=Class.create({functions:{searchfocus:function(A){$("input-search").focus();$("input-search").fire("focus");PBwiki.debug("focus on search");Event.stop(A)},edit:function(B){if(!Page.AjaxEdit.modeEnabled){var A=$$("#edit-tab a");if(A[0]){Event.stop(B);window.location=A[0].href;PBwiki.debug("editing")}}else{document.fire("ui:editview")}}},map:{},initialize:function(){this.addShortCut("",this.functions.searchfocus);this.addShortCut("e",this.functions.edit)},addShortCut:function(A,B){if(A.length==1){this.map[A]=B}}});Page.absolutizeUserContextSection=function(){document.body.appendChild($("top-content").addClassName("abs"))};Page.EditPage={cancel:false,FCKeditor:null,isLoaded:false,onFCKComplete:function(B){var A=B.memo.editorInstance;Page.EditPage.startEdit(A)},getEditor:function(){if(typeof (FCKeditorAPI)!="undefined"){return FCKeditorAPI.GetInstance("content")}},startEdit:function(A){PBwiki.debug("Page.EditPage: fck complete");$$("#edit-toolbar input, #edit-toolbar button, #edit-toolbar a").each(function(B){B.disabled=false;B.removeClassName("disabled")});Page.EditPage.handleTagEdit();$("edit-toolbar-outer").show();Event.observe(window,"resize",Page.EditPage.resizeContentPanel2);Page.EditPage.resizeContentPanel2()},resizeContentPanel2:function(){var C=$("content___Frame");var D=$("page-footer");var B=D?D.offsetTop+D.scrollHeight+parseInt(D.getStyle("marginBottom")):0;var A=C.clientHeight+document.documentElement.clientHeight-B;A=(A<310?310:A);C.style.height=A+"px";$("edit-toolbar").down(".iconbutton").style.position="relative";if(C.contentWindow.onresize){C.contentWindow.onresize()}},resizeContentPanel:function(){try{var E=$("page-col-2");var D=$("page-side-toolbar");var A=D.clientHeight+D.offsetTop-$("inner-page").offsetTop;var B=$$(".inlinepage.")[0];B.style.minHeight=A+"px"}catch(C){}},handleTagEdit:function(){if(window.location.hash=="#tags"&&$("tagfield")){$("tagfield").focus();var A=$("tag-settings").cumulativeOffset().top;window.scrollTo(0,A)}},initialize:function(){if(PBwiki.feature("ajaxedit")&&window.location.search.toString().indexOf("edit=")==-1){return }if($("content___Frame")){Page.EditPage.isLoaded=true;PBwiki.info("initializing EditPage code");Event.observe(window,"resize",Page.EditPage.resizeContentPanel);document.observe("ui:fckeditor_oncomplete",Page.EditPage.onFCKComplete);Page.EditPage.resizeContentPanel();Page.EditPage.handleTagEdit();Page.setDefaultInputFocus();Page.EditPage.Tags.initialize();Page.Thingbar.doLoad();Page.EditPage.AutoSave.start();if(!Page.AjaxEdit.modeEnabled){window.onbeforeunload=Page.EditPage.beforeUnload;UserPrefs.Manager.goFullWidth()}}else{}},beforeUnload:function(A){A=A||window.event;try{if(!Page.EditPage.cancel){var C="You have unsaved changes. Continue and discard those changes?";A.returnValue=C;return C}}catch(B){}}};Page.EditPage.AutoSave={saveInterval:30,maxSaveInterval:150,pbSpelling:false,numWords:0,stop:function(){if(this.apiRequest){this.apiRequest.abortRequest()}if(this.timer){clearTimeout(this.timer);delete this.timer}if(this.reportTimer){clearTimeout(this.reportTimer);delete this.reportTimer}this.enabled=false},start:function(){if(this.reportTimer){clearTimeout(this.reportTimer)}this.reportTimer=setInterval(this.report.bind(this),this.saveInterval*1000);this.enabled=true;this.enableEdit();if(this.timer){clearTimeout(this.timer)}this.timer=setTimeout(this.autoSaveTrigger.bind(this),this.saveInterval*1000)},autoSaveTrigger:function(){if(!Page.EditPage.AutoSave.enabled||(Page.AjaxEdit.modeEnabled&&!Page.AjaxEdit.editMode)){return }PBwiki.debug("AutoSave: autosaving...");var B=Page.EditPage.getEditor().GetHTML();if(this.lastHTML&&this.saveTime&&this.lastHTML==B&&PBwiki.getTimestamp()-(this.saveTime.getTime()/1000)<this.maxSaveInterval&&!this.pbSpelling){PBwiki.info("NO CHANGES TO SAVE");this.start();return }var C={onSuccess:this.onSuccess.bind(this,B),onFailure:this.autosaveFailure.bind(this)};var A={page:PBwiki.getPageName()};if(this.lastHTML&&this.lastHTML==B&&!this.pbSpelling){this.apiRequest=new PBwiki.APIRequest("GetPageLock",A,C)}else{C.parameters={html:B};A.spellcheck=this.pbSpelling;this.apiRequest=new PBwiki.APIRequest("PutAutosave",A,C)}},pageChanged:function(){return Page.EditPage.getEditor().IsDirty()},onSuccess:function(A,B){this.lastHTML=A;if(B.spellcheck){this.spellcheck=B.spellcheck;Page.EditPage.AutoSave.pbSpelling=false;document.fire("spellcheck:update",this.spellcheck)}if(!B.lockinfo.hasLock){alert(((B.lockinfo.editname)?B.lockinfo.editname:"Somebody")+" has stolen your lock on this page.  You will no longer be able to save changes.");this.disableEdit();this.enabled=false}else{PBwiki.info("has lock");this.saveTime=new Date();if(B.wordcount){this.numWords=B.wordcount}this.report();document.fire("ui:autosaveSuccess");this.start()}},autosaveFailure:function(A){if(!this.enabled){return }if(!PBwiki.feature("ajaxsave")){var B="You have been logged out in this window ("+A+"). You will no longer be able to save changes.";alert(B);this.disableEdit()}else{document.fire("ui:autosaveFailure",A)}this.start();this.report()},disableEdit:function(){var A=$$("#edit-toolbar a.button")[0];A.addClassName("disabled");A.onclick=null;A.setAttribute("href","javascript:void(0);");$("cancelButton").onclick=null;$("cancelButton").addClassName("disabled");Page.EditPage.cancel=true},enableEdit:function(){var A=$$("#edit-toolbar a.button")[0];if(A.hasClassName("disabled")){A.removeClassName("disabled");$("cancelButton").removeClassName("disabled");Page.EditPage.cancel=false}},report:function(){if(!this.saveTime){return }var A=((new Date()-this.saveTime)/1000/60).toFixed();if(this.numWords){var B="Saved "+this.numWords+" word"+((this.numWords>1)?"s":"")+" at "}else{var B="Draft saved "}B+=new Date(this.saveTime).strftime("%i:%M%p");B+=" ("+((A==0)?"less than a ":A);B+=" minute"+((A>1)?"s":"")+" ago)";$("autosave_msg").innerHTML=B;PBwiki.info(B)}};Page.WikiPage=Class.create({initialize:function(){this.initAccessKeys();this.initStar();this.accessKeyFunctions=new Page.AccessKeys()},initAccessKeys:function(){document.observe("keydown",function(B){var A=String.fromCharCode(B.charCode?B.charCode:B.keyCode).toLowerCase();if(B.ctrlKey&&this.accessKeyFunctions.map[A]){this.accessKeyFunctions.map[A](B);B.stop()}}.bind(this),true)},initStar:function(){if(!$("pb-page-star")){return }this.starred=$("pb-page-star").hasClassName("starred");Event.observe("pb-page-star","click",function(A){A.stop();this.toggleStarState();$("pb-page-star").addClassName("working");new PBwiki.APIRequest("SetObjectStarred",{name:PBinfo.CurrentPage.page,starred:this.starred},{onFailure:this.starPageError.bind(this),onSuccess:this.didStarPage.bind(this)})}.bind(this))},didStarPage:function(A){$("pb-page-star").removeClassName("working")},starPageError:function(A){this.toggleStarState()},toggleStarState:function(B){var A=!this.starred;this.starred=A;if(A){$("pb-page-star").addClassName("starred")}else{$("pb-page-star").removeClassName("starred")}Page.StarBubble.hide()}});Page.setDefaultInputFocus=function(){$$("input[type=text]").each(function(A){if(A.getAttribute("ui:defaultfocus")){A.focus()}})};Page.EditPage.Tags={tagCloud:null,tagField:null,getTagObject:function(A){if(!Page.EditPage.Tags.tagObj||A){var B=Page.EditPage.Tags.tagField.value.strip().gsub(/(\s*,\s*)+/,",");B=B.gsub(/,\s*$|^,\s*/,"");Page.EditPage.Tags.tagObj=(B.blank()?[]:B.split(","))}return Page.EditPage.Tags.tagObj},writeTagObject:function(){Page.EditPage.Tags.tagField.value=Page.EditPage.Tags.getTagObject().join(", ")},initialize:function(){this.tagCloud=$("tagcloud");if(!this.tagCloud){return }this.tagField=$("tagfield");this.editTags=$("edit_tags");Page.EditPage.Tags.initialValue=$("tagfield").value;this.editTags.observe("click",function(A){A.stop();this.editTags.hide();$("tag-settings").show();this.loadAllTags()}.bind(this))},IsDirty:function(){return(Page.EditPage.Tags.initialValue!=$("tagfield").value)},loadAllTags:function(){new PBwiki.APIRequest("GetTags",{},{cacheability:["tagtime"],onSuccess:this.onLoaded.bind(this)})},onLoaded:function(A){this.tagCloud.update("");if(A.tags&&!Object.isArray(A.tags)){$H(A.tags).each(function(B){this.tagCloud.appendChild(new Element("a",{href:"#"}).update(B.key.escapeHTML()));this.tagCloud.appendChild(document.createTextNode(",  "))}.bind(this));Page.AjaxEdit.resizeContentPanel()}this.start()},start:function(){Page.EditPage.Tags.writeTagObject();Page.EditPage.Tags.unselectedLinks=$A(Page.EditPage.Tags.tagCloud.getElementsByTagName("a"));Page.EditPage.Tags.unselectedLinks.each(function(A){A=$(A);A.observe("click",Page.EditPage.Tags.handleTagClick);A.addClassName("unselected")});Page.EditPage.Tags.tagField.observe("keyup",Page.EditPage.Tags.handleFieldChange);Page.EditPage.Tags.tagField.observe("keydown",function(A){if(A.keyCode==13){Event.stop(A)}});Page.EditPage.Tags.handleFieldChange()},handleFieldChange:function(C){var D="#"+Page.EditPage.Tags.tagCloud.id+" a";var A=$$(D);var B=Page.EditPage.Tags.getTagObject(true);A.each(function(E){E.className="unselected";B.each(function(F){linkText=E.innerHTML;if(linkText==F){E.className="selected"}})})},addTag:function(A){Page.EditPage.Tags.tagObj.push(A)},removeTag:function(A){Page.EditPage.Tags.tagObj=Page.EditPage.Tags.tagObj.without(A)},handleTagClick:function(D){var C=Event.element(D);var A=C.firstChild.textContent||C.innerText;var B=Page.EditPage.Tags.getTagObject();(B.include(A)?Page.EditPage.Tags.removeTag(A):Page.EditPage.Tags.addTag(A));C.toggleClassName("selected").toggleClassName("unselected").blur();Page.EditPage.Tags.writeTagObject();Event.stop(D)}};Page.EditBubble={initialize:function(){var A=$("edit-tab");Page.EditBubble.bubble=editBubble=$("edit-button-bubble");if(!A||!editBubble||!A.hasClassName("logintoedit")){return false}editBubble.getElementsBySelector("a.close")[0].observe("click",function(B){editBubble.hide();B.stop()});A.down().observe("click",Page.EditBubble.show);document.observe("click",function(){Page.EditBubble.bubble.hide()})},reposition:function(){var D=$("edit-tab");var B=D.cumulativeOffset();var C=D.getWidth();var A=(Page.EditBubble.bubble.getHeight()/2)-(D.getHeight()/2);B.left+=C;B.top-=A;Page.EditBubble.bubble.setStyle({top:B.top+"px",left:B.left+"px"})},show:function(A){Page.EditBubble.reposition();Page.EditBubble.bubble.show();Event.stop(A)}};Page.StarBubble={initialize:function(){PBwiki.History.removeKey("saved");Page.StarBubble.anchor=anchor=$("pb-page-star");Page.StarBubble.bubble=bubble=$("star-bubble");if(PBwiki.History.getKey("saved").getValue()!=1||!anchor||!bubble){return false}bubble.getElementsBySelector("a.close")[0].observe("click",function(A){A.stop();bubble.hide()});$("dont_prompt_to_save_pages").observe("change",function(A){A.stop();Page.StarBubble.hide();PBwiki.UserPrefs.set("prompt_to_star_on_save",false)});Page.StarBubble.show();document.observe("click",function(){Page.StarBubble.bubble.hide()})},hide:function(){if(!this.bubble){return }window.setTimeout(function(){this.bubble.hide()},250)},reposition:function(){var B=Page.StarBubble.anchor.cumulativeOffset();var C=Page.StarBubble.anchor.getWidth();var A=(Page.StarBubble.bubble.getHeight()/2)-(Page.StarBubble.anchor.getHeight()/2);B.left+=C;B.top-=A;Page.StarBubble.bubble.setStyle({top:B.top+"px",left:B.left+"px"})},show:function(A){if(A){Event.stop(A)}Page.StarBubble.reposition();Page.StarBubble.bubble.show()}};PBwiki.init(Page.WikiPage);PBwiki.init(Page.EditPage);PBwiki.init(Page.setDefaultInputFocus);PBwiki.init(Page.EditBubble);PBwiki.init(Page.StarBubble);var SidebarModule=Class.create({initialize:function(A){this.element=$(A);try{this.toggleIcon=this.element.down(".togglemodule");this.target=this.element.down(".content");this.header=this.element.down(".header");this.header.observe("dblclick",this.toggleIconCommand.bind(this));this.toggleIcon.observe("click",this.toggleIconCommand.bind(this));document.observe("ui:setmodulestate",this.setModuleState.bind(this))}catch(B){throw new UIException("ToggleModuleIcon: "+B)}},setModuleState:function(A){if($(A.memo.id)==this.element&&A.memo.customstate==true){this.toggleContent()}},toggleIconCommand:function(A){Event.stop(A);this.toggleIcon.blur();this.toggleContent();if(PBwiki.getUID()){document.fire("ui:togglemodule",{id:this.element.id,minimized:this.element.hasClassName("minimized")})}},toggleContent:function(A){this.element.toggleClassName("minimized")}});SidebarModule.initialize=function(){SidebarModule.selector=".wikicontext-module";$$(SidebarModule.selector).each(function(A){new SidebarModule(A)})};PBwiki.init(SidebarModule.initialize);PBwiki.APIRequest=Class.create({initialize:function(A,B,D){this.m=A;this.args=B;this.options={_type:"jsontext",method:"post",incUsess:true};Object.extend(this.options,D);if(this.options.incUsess){Object.extend(this.args,PBwiki.getSessCookie())}if(this.options.cacheability){this.options.method="get";var E={};this.options.cacheability.each(function(F){if(PBinfo.GetTimes[F]){E[F]=PBinfo.GetTimes[F]}});Object.extend(B,E)}var C=PBwiki.APIRequest.callPreOp(A,this.args,this.options,this);if(C){return this.dispatchSuccess(C)}this.apiUrl=this.buildUri(A,this.args);this.reqOpts=Object.clone(this.options);Object.extend(this.reqOpts,{onSuccess:this.apiResponse.bind(this),onFailure:this.dispatchError.bind(this,"Sorry, your request has failed to reach PBwiki servers. Please reconnect and try again.",509),onException:this.dispatchError.bind(this,"Your internet connection is disconnected. Please reconnect and try again",510)});this.doRequest()},unicodeConvert:function(B){var A={0:"",1:"000",2:"00",3:"0",4:""};return B.replace(/[\u0080-\uFFFF]/g,function(D){var E=D[0]||D;var C=Math.floor(E.charCodeAt()/16).toString(16)+(E.charCodeAt()%16).toString(16);return"\\u"+A[C.length].concat(C)})},doRequest:function(){this.apiRequest=new Ajax.Request(this.apiUrl,this.reqOpts)},buildUri:function(A,B){B.op=A;return"/api_v2/?"+Object.toQueryString(B)},abortRequest:function(){try{this.apiRequest.transport.abort()}catch(A){}this.isAborted=true},dispatchError:function(B,A){if(this.options.onFailure){this.options.onFailure(B,A)}},apiResponse:function(A){var B=this.parseResponse(A.responseText);this.dispatchSuccess(B)},dispatchSuccess:function(B){if(B){this.handleResponse(this.m,B,this.args);try{if(this.options.onSuccess){this.options.onSuccess(B)}}catch(A){PBwiki.info("Error in "+this.m+" request handler");PBwiki.error(A)}}},parseResponse:function(A){var D=A.split("\n");if(D.length>2&&A.indexOf("/*-secure-")!=-1){try{var C=D[1].evalJSON(true)}catch(B){this.dispatchError("Sorry, we encountered an error while processing your request. Please try again or email support if the problem persists ("+this.m+" 511 "+t.status+" "+B.message+")",511)}if(C.error_status){return this.dispatchError(C.error_string,C.error_status)}else{if(C.success===false){return this.dispatchError("Sorry, we encountered an error.",512)}}return C}else{this.dispatchError("Sorry, we encountered an error while processing your request. Please try again or email support if the problem persists ("+this.m+" 511 "+t.status+" "+A.substr(0,30)+")",511)}},handleResponse:function(A,D,B){var C=PBwiki.APIRequest.lastClientTime=PBwiki.getTimestamp();D._args=Object.clone(B);D._args.op=A;D._client_time=C;PBinfo[A]=D;if(D._perm_cache_times){Object.extend(PBinfo.GetTimes,D._perm_cache_times||{});if(PBinfo[A]._args){Object.extend(PBinfo[A]._args,D._perm_cache_times||{})}PBinfo.GetTimes._client_time=C;if(!this.options.times){PBwiki.APIRequest.callPostOp("GetTimes",PBinfo.GetTimes)}}PBwiki.APIRequest.callPostOp(A,D)}});PBwiki.APIRequest.postOpCallbacks=new Array();PBwiki.APIRequest.observePostOp=function(B,A){if(!this.postOpCallbacks[B]){this.postOpCallbacks[B]=new Array()}this.postOpCallbacks[B].push(A)};PBwiki.APIRequest.callPostOp=function(B,A){if(!PBwiki.APIRequest.postOpCallbacks[B]){return }PBwiki.APIRequest.postOpCallbacks[B].each(function(C){C(A)})};PBwiki.APIRequest.preOpCallbacks=[];PBwiki.APIRequest.observePreOp=function(B,A){if(!this.preOpCallbacks[B]){this.preOpCallbacks[B]=new Array()}this.preOpCallbacks[B].push(A)};PBwiki.APIRequest.callPreOp=function(E,A,D,C){preOps=PBwiki.APIRequest.preOpCallbacks["*"].concat(PBwiki.APIRequest.preOpCallbacks[E]||[]);if(!preOps||preOps.length==0){return }var B=false;preOps.each(function(F){B=F(E,A,D,C);if(B){throw $break}});return B};PBwiki.MultiAPIRequest=Class.create(PBwiki.APIRequest,{initialize:function(D,C){this.reqOptions=new Array();this.options={method:"post",times:true};Object.extend(this.options,C);var A={};if(this.options.incUsess){Object.extend(A,PBwiki.getSessCookie())}if(this.options.times){D.push(["GetTimes",{},{onSuccess:function(E){PBinfo.GetTimes=E},counted:false}])}for(var B=0;B<D.length;B++){if(D[B].length==3){this.reqOptions[B]=D[B].pop()}}this.r=D;this.apiUrl=this.buildUri("Multi",A);this.reqOpts=Object.clone(this.options);Object.extend(this.reqOpts,{parameters:{calls:this.unicodeConvert(Object.toJSON(D))},onSuccess:this.onMulti.bind(this),onFailure:this.dispatchError.bind(this,"Sorry, your request has failed to reach PBwiki servers. Please reconnect and try again.",509),onException:this.dispatchError.bind(this,"Your internet connection is disconnected. Please reconnect and try again",510)});this.apiRequest=new Ajax.Request(this.apiUrl,this.reqOpts)},onMulti:function(E){var H=false;var F=0;var D=0;var G=this.parseResponse(E.responseText);if(!G){return }var A=G.response;if(A&&A.length==this.reqOptions.length){for(var C=0;C<A.length;C++){H=!A[C].error_status&&A[C].success!==false;this.handleResponse(this.r[C][0],G.response[C],this.r[C][1]);if(this.reqOptions[C].counted!==false){D++;if(H){F++}}if(!H){if(A[C].error_string){this.lastError=A[C].error_string}else{this.lastError=this.r[C][0]+" failed unexpectedly."}}if(H&&this.reqOptions[C].onSuccess){if(this.reqOptions[C].onSuccess){this.reqOptions[C].onSuccess(A[C])}}else{if(!H&&this.reqOptions[C].onFailure){if(this.reqOptions[C].onFailure){this.reqOptions[C].onFailure(this.lastError,A[C].error_status)}}}}}if(this.options.onAllComplete){var B={responses:G.response,successful:F,total:D,lastError:(this.lastError||"")};this.options.onAllComplete(B)}}});PBwiki.Data={enabledLayers:["LocalCache","DOMObjectListNonVerbose"],initialize:function(){PBwiki.Data.Instances=[];if(PBwiki.feature("localcache")){PBwiki.Data.enabledLayers.push("DOMObjectListVerbose")}PBwiki.Data.enabledLayers.each(function(A){PBwiki.Data.Instances.push(new PBwiki.Data.Layers[A])});PBwiki.info(PBwiki.Data.Instances)},check:function(A,B,D,C){var E=false;if(!PBwiki.Data.Instances){return }PBwiki.Data.Instances.each(function(F){E=F.check(A,B,D,C);if(E){throw $break}});return E},getInstance:function(B){var A=PBwiki.Data.enabledLayers.indexOf(B);return(A)?PBwiki.Data.Instances[A]:{}}};PBwiki.Data.HIGH_PRIORITY=1;PBwiki.Data.MED_PRIORITY=2;PBwiki.Data.LOW_PRIORITY=3;PBwiki.Data.NO_CACHE=4;PBwiki.APIRequest.observePreOp("*",PBwiki.Data.check);PBwiki.init(PBwiki.Data);PBwiki.Data.Layers={};PBwiki.Data.Layers.DOMStorageCache=Class.create({hasData:function(){if(!this.hasDOMStorage()&&!this.data){return }return !!this.getData()},storeData:function(A){this.data=Object.toJSON(A);if(!this.hasDOMStorage()){return }try{if(typeof (localStorage)!="undefined"){localStorage.setItem(this.storageKey,this.data)}}catch(B){}try{if(typeof (globalStorage)!="undefined"){globalStorage[window.location.host][this.storageKey]=this.data}}catch(B){}},getData:function(){if(this.data){return this.data}if(!this.hasDOMStorage()){return }try{if(typeof (localStorage)!="undefined"){return localStorage.getItem(this.storageKey)}}catch(A){}try{if(typeof (globalStorage)!="undefined"){return globalStorage[location.host].getItem(this.storageKey).value}}catch(A){}return false},hasDOMStorage:function(){return typeof (localStorage)!="undefined"||typeof (globalStorage)!="undefined"},check:function(A,B,D,C){if(!this.hasData()){return false}if(this.methods.indexOf(A)==-1){return false}var E=this.getData().evalJSON();if(!this.checkTimes(E)){return false}PBwiki.info("TIMES PASSED");return E},filter:function(G,A,B,F,E){G=G.objects;var D=G.length;if(A!="GetObjects"){B.type=(A=="GetPages")?"page":"file"}if(B.type||A!="GetObjects"||B.filter||typeof (B.folder)!="undefined"){var H=[];for(var C=0;C<G.length;C++){if(B.type&&G[C].type!=B.type){continue}if(B.filter&&G[C].name.toLowerCase().indexOf(B.filter.toLowerCase())===-1){continue}if(typeof (B.folder)!="undefined"&&B.folder!=G[C].folder&&!(B.folder==""&&!G[C].folder)){continue}if(A!="GetObjects"){delete G[C].type}H.push(G[C])}G=H;D=H.length}if(B.sortby){G=G.sort(function(J,I){return(J[B.sortby]<I[B.sortby])?-1:(J[B.sortby]>I[B.sortby])})}if(B.reverse){G=G.reverse()}if(B.count||B.offset){G=G.slice(B.offset,B.count)}var H={_total_count:D,_args:B,_used_dom_storage:true};if(A=="GetObjects"){H.objects=G}else{if(A=="GetPages"){H.pages=G}else{if(A=="GetFiles"){H.files=G}}}return H},checkTimes:function(A){var B=true;if(!A._perm_cache_times){return }this.cacheTimes.each(function(C){if(A._perm_cache_times[C]!=PBinfo.GetTimes[C]){B=false;throw $break}});if(A._uid!=PBwiki.getUID()){return }return B}});PBwiki.Data.Layers.DOMObjectListNonVerbose=Class.create(PBwiki.Data.Layers.DOMStorageCache,{fetchMethod:"GetObjects",methods:["GetObjects","GetPages","GetFiles"],cacheTimes:["pagetime","filetime","permtime","foldertime"],storageKey:"objectListNonVerbose",check:function($super,A,B,D,C){if(B.verbose==false||B.detail!="partial"||D.priority==PBwiki.Data.NO_CACHE){return }var E=$super(A,B,D,C);if(E){E=this.filter(E,A,B,D,C)}if(!E){this.checkFetch(A,B,D)}return E},checkFetch:function(A,C,E){if(this.isFetching){return }var D=E.priority||PBwiki.Data.MED_PRIORITY;var B=PBinfo.CurrentWiki.pagecount+PBinfo.CurrentWiki.filecount>1000;if(!this.hasDOMStorage()){if(!D==PBwiki.Data.HIGH_PRIORITY&&!B){return }}if(D==PBwiki.Data.LOW_PRIORITY||B&&D<PBwiki.Data.HIGH_PRIORITY){return }if(this.timeout){clearTimeout(this.timeout)}this.timeout=setTimeout(this.doRequest.bind(this),300)},doRequest:function(){if(this.isFetching){return }PBwiki.info("DO DATA REQUEST!");this.isFetching=true;new PBwiki.APIRequest(this.fetchMethod,{verbose:true,detail:"partial"},{onSuccess:function(A){A._perm_cache_times=Object.clone(PBinfo.GetTimes);A._uid=PBwiki.getUID();this.storeData(A);PBwiki.info("STORE DATA REQUEST");document.fire("data:nonVerboseListLoaded");this.isFetching=false}.bind(this),method:"get",priority:PBwiki.Data.NO_CACHE,cacheability:this.cacheTimes})}});PBwiki.Data.Layers.DOMObjectListVerbose=Class.create(PBwiki.Data.Layers.DOMStorageCache,{methods:["GetObjects","GetPages","GetFiles"],cacheTimes:["pagetime","filetime","permtime","foldertime"],storageKey:"objectListVerbose",check:function($super,A,B,D,C){if(B.verbose===false||B.detail=="partial"||B.priority==PBwiki.Data.NO_CACHE){return }var E=$super(A,B,D,C);if(E){E=this.filter(E,A,B,D,C)}if(!E&&this.methods.indexOf(A)!=-1){this.checkFetch()}return E},checkFetch:function(){PBwiki.info("VERBOSE CHECK FETCH");if(this.isFetching){return }if(!this.hasDOMStorage()){return }if(this.timeout){clearTimeout(this.timeout)}this.timeout=setTimeout(function(){this.doRequest()}.bind(this),500)},doRequest:function(){if(this.isFetching){return }PBwiki.info("DO VERBOSE REQUEST!");this.isFetching=true;new PBwiki.APIRequest("GetObjects",{},{method:"get",onSuccess:function(A){A._perm_cache_times=Object.clone(PBinfo.GetTimes);A._uid=PBwiki.getUID();PBwiki.info("GET VERBOSE OBJECT LIST");this.storeData(A);this.isFetching=false}.bind(this),method:"get",cacheability:this.cacheTimes,priority:PBwiki.Data.NO_CACHE})}});PBwiki.Data.Layers.LocalCache=Class.create({check:function(D,B,C){PBwiki.info("checking local cache");if(C.cacheability){PBwiki.info("local cacheablity");if(!PBinfo[D]){return }var A=Object.clone(B);C.cacheability.each(function(E){A[E]=parseInt(PBinfo.GetTimes[E])});A.op=D;if(Object.toJSON($H(A).keys().sort())!=Object.toJSON($H(PBinfo[D]._args).keys().sort())){PBwiki.info("local cache key mismatch");PBwiki.info(Object.toJSON(A));PBwiki.info(Object.toJSON(PBinfo[D]._args));return false}PBwiki.info("local cache keys match");if(Object.toJSON($H(A).values().sort())!=Object.toJSON($H(PBinfo[D]._args).values().sort())){PBwiki.info("local cache values mismatch");PBwiki.info(Object.toJSON($H(A).values().sort()));PBwiki.info(Object.toJSON($H(PBinfo[D]._args).values().sort()));return false}return PBinfo[D]}return false}});SecurityInteraction={cellTemplates:["#{username}",'<input type="hidden" name="uid[]" value="#{uid}"/><select name="role[]"><option value="read">Reader</option><option value="write">Writer</option><option value="edit">Editor</option></select>','<a class="iconbutton deleteicon" href="#" onclick="SecurityInteraction.removeRow(this); return false;">&nbsp;</a>'],addUser:function(A){if(A){A.role=A.role||"read";window.obj=A;var B=SecurityInteraction.table.tBodies.item(0).insertRow(-1);SecurityInteraction.cellTemplates.each(function(C){B.insertCell(-1).innerHTML=C.interpolate(A)});$A(B.getElementsByTagName("select")[0].options).find(function(C){return C.value==A.role}).selected=true;SecurityInteraction.updateRows()}else{}},addUserEvent:function(D){var A=SecurityInteraction.userSelector;var B={uid:A.getValue(),username:A.options[A.selectedIndex].text,role:"read"};var C=SecurityInteraction.table.getElementsBySelector("input[value="+B.uid+"]");if(C.size()!=0){if(C[0].next("select").value=="remove"){C[0].up("tr").remove()}else{alert(B.username+" is already in the table");return }}SecurityInteraction.addUser(B)},addTheseUsers:function(A){A.each(SecurityInteraction.addUser)},removeRow:function(C){SecurityInteraction.table.tBodies.item(1).appendChild(C.parentNode.parentNode);var B=$(C.parentNode.parentNode);var A=B.getElementsBySelector("select")[0];A.innerHTML='<option value="remove" selected="selected">remove</option>';SecurityInteraction.updateRows()},updateRows:function(){var A=$A(SecurityInteraction.table.tBodies.item(0).rows);A.each(function(C,B){C.className=(B%2?"even":"odd")})},hideCustomSecurity:function(){SecurityInteraction.customTable.style.display="none"},showCustomSecurity:function(){SecurityInteraction.customTable.style.display=""}};PBwiki.Settings={initialize:function(){this.Panels.each(function(A){A.value.initialize.bind(this.Panels.get(A.key))()}.bind(this))},Panels:new Hash({Security:{initialize:function(){if(!$("securitysettings_publicrow")||$("welcome_wiki_viewers_anyone")){return }this.selections={};try{$w("viewers editors").each(function(C){this[C]={anyone:{},invitees:{}};this[C].anyone.radio=$("wiki_"+C+"_anyone");this[C].invitees.radio=$("wiki_"+C+"_invitees");try{this[C].anyone.label=$$("label[for="+this[C].anyone.radio.id+"]").first();this[C].invitees.label=$$("label[for="+this[C].invitees.radio.id+"]").first()}catch(B){}this[C].radioGroup=$$("input[name=whocan"+C.substr(0,4)+"]");this[C].getValue=function(){return this.radioGroup.find(function(D){return D.checked}).value}.bind(this[C])}.bind(this.selections))}catch(A){PBwiki.info("PBwiki.Settings.Security: error settings up radio buttons and labels: "+A);return }this.selections.requestAccessCheckbox=$("requestaccess_enabled");this.selections.requestAccessLabel=this.selections.requestAccessCheckbox.up().down("label");this.selections.inviteesLabelText=["Only people I invite","or approve"];if(this.requestAccessCheckbox=$("requestaccess_enabled")){(onRequestAccessChange=function(){var B=(this.requestAccessCheckbox.checked?this.selections.inviteesLabelText.join(" "):this.selections.inviteesLabelText.first());try{this.selections.viewers.invitees.label.innerHTML=B;this.selections.editors.invitees.label.innerHTML=B}catch(C){}}.bind(this))();$("requestaccess_enabled").observe("click",onRequestAccessChange)}[this.selections.viewers.radioGroup,this.selections.editors.radioGroup].flatten().each(function(B){B.observe("click",function(){document.fire("viewersecurity:changed")}.bind(this))}.bind(this.selections));(this.selections.editors.onViewSettingChanged=function(C){var B=this.editors.anyone;if(parseInt(this.viewers.getValue())){B.radio.enable();B.label.removeClassName("aux");if(this.editors.getValue()==1){this.requestAccessCheckbox.disabled=true;this.requestAccessLabel.addClassName("aux")}else{this.requestAccessLabel.removeClassName("aux");this.requestAccessCheckbox.disabled=false}}else{B.radio.disable();B.label.addClassName("aux");this.editors.invitees.radio.checked=true;this.requestAccessCheckbox.disabled=false;this.requestAccessLabel.removeClassName("aux")}}.bind(this.selections))();document.observe("viewersecurity:changed",this.selections.editors.onViewSettingChanged)}}})};PBwiki.init(PBwiki.Settings.initialize.bind(PBwiki.Settings));FolderSelector=Class.create({bannedCharacters:".!@%&$#+\"'|",maxFolderNameLength:127,initialize:function(A){this.element=$(A);if(!this.element){return }this.link=this.element.down("a");this.selector=this.element.down("select");this.selector.hide();this.options={linkText:{nofolder:"Put this page in a folder:",folder:"Change this page's folder:",active:"Choose a folder:"}};PBwiki.debug(this.link);this.link.observe("click",this.linkOnclick.bind(this));this.selector.observe("click",function(){this.selector.oldIndex=this.selector.selectedIndex}.bind(this));this.selector.observe("change",this.selectChanged.bind(this));this.element.observe("ui:folderchanged",this.folderChanged.bind(this))},linkOnclick:function(A){Event.stop(A);this.link.update(this.options.linkText.active);this.link.blur();this.selector.show()},selectChanged:function(B){var A=$F(this.selector);PBwiki.debug(A);if(A.startsWith("Create")){this.handleCreateFolder()}else{this.selector.fire("ui:folderchanged",A)}},handleCreateFolder:function(){var B="Folder name";var A="Please name your folder";while(folderName=prompt(A,B)){if(!folderName){continue}if(folderName.length>this.maxFolderNameLength){A="Folder name must be less than "+this.maxFolderNameLength+" characters long.\n"+A;continue}if(folderName==B){PBwiki.debug(folderName.inspect()+" is the same as the default.");A="Please name your folder";continue}if($A(this.selector.options).find(function(C){return C.value.toLowerCase()==folderName.toLowerCase()})){if(confirm("A folder named "+folderName.inspect(true)+" already exists. Use it?")){return }A="Please choose a different name for your folder.";continue}if(this.bannedCharacters.toArray().find(function(C){return folderName.include(C)})){A="Folder names should not contain the following characters: "+this.bannedCharacters;A+="\nPlease choose a different name for your folder.";continue}break}if(folderName){PBwiki.debug("FolderSelector: folder name entered: "+folderName.inspect(true));this.selector.fire("ui:folderchanged",folderName)}else{this.selector.selectedIndex=this.selector.oldIndex}},folderChanged:function(A){if(typeof A.memo!="string"){A.memo=""}PBwiki.debug("FolderSelector: folder added:"+A.memo+", page added: "+PBwiki.getPageName());FormPost.post({page:PBwiki.getPageName(),folder:A.memo,command:"addtofolder"},{action:"folder.php"})}});FolderSelector.createFolderDialog=function(){var B="Folder name";var A="Please name your folder";while(folderName=prompt(A,B)){if(!folderName){continue}if(folderName.length>this.maxFolderNameLength){A="Folder name must be less than "+FolderSelector.maxFolderNameLength+" characters long.\n"+A;continue}if(folderName==B){PBwiki.debug(folderName.inspect()+" is the same as the default.");A="Please name your folder";continue}if(FolderSelector.bannedCharacters.toArray().find(function(C){return folderName.include(C)})){A="Folder names should not contain the following characters: "+FolderSelector.bannedCharacters;A+="\nPlease choose a different name for your folder.";continue}break}return folderName};FolderSelector.bannedCharacters=".!@%&$#+\"'|";FolderSelector.maxFolderNameLength=127;FolderSelector.createFolder=function(){var A;if(A=FolderSelector.createFolderDialog()){FormPost.post({page:PBwiki.getPageName(),folder:A,command:"createfolder"},{action:"folder.php"})}};PBwiki.init(FolderSelector,"folderselector");Page.Tags={editorActive:false,placeHolderTxt:"e.g. report, new release",initialize:function(){if($("edittags")){$("edittags").observe("click",Page.Tags.toggleEditor.bind(Page.Tags));Page.Tags.tagMsg=$("ajaxtags").down(".tagsmsg");Page.Tags.tagError=$("ajaxtags").down(".validation-error")}},toggleEditor:function(B){if(B){Event.stop(B)}var D=$("tagList");if(!this.editorActive){this.tagInput=new Element("input");this.tagInput.setAttribute("type","text");this.tagInput.setAttribute("ui:placeholder",Page.Tags.placeHolderTxt);this.tagInput.className="text";this.tagInput.style.width="165px";this.tagInput.observe("blur",this.toggleEditor.bind(this));this.tagInput.observe("keypress",this.keyDown.bind(this));var F=D.getElementsByTagName("A");this.savedTagStr=D.innerHTML;var I=this.getTagStr();this.tagInput.value=I;this.tagButton=new Element("input");this.tagButton.setAttribute("type","button");this.tagButton.setAttribute("value","OK");this.tagButton.style.marginLeft="2px";this.tagButton.observe("click",this.toggleEditor.bind(this));D.innerHTML="";D.appendChild(this.tagInput);D.appendChild(this.tagButton);new InputText(this.tagInput);this.editorActive=true}else{var J=this.tagInput.value;if(J==Page.Tags.placeHolderTxt){J=""}var E=J.split(",");var G=false;D.innerHTML="";for(var A=0;A<E.length;A++){var H=E[A].strip();if(H==""){continue}if(G){D.appendChild(document.createTextNode(", "))}var C=new Element("a");C.setAttribute("href","tags.php?ptag="+H);C.appendChild(document.createTextNode(H));D.appendChild(C);G=true}if(G){$("edittags").innerHTML="Edit Tags:"}else{$("edittags").innerHTML="Add Tags"}this.updateTags();this.editorActive=false}},getTagStr:function(){var A=$("tagList").getElementsByTagName("A");var C="";for(var B=0;B<A.length;B++){if(B!=0){C+=","}C+=A[B].firstChild.nodeValue}return C},keyDown:function(A){if(!A){A=window.event}if(A.keyCode==13){this.toggleEditor()}},updateTags:function(){var A=this.getTagStr();new PBwiki.APIRequest("SetPageTags",{page:PBwiki.getPageName(),tags:A},{incUsess:true,onSuccess:this.tagSuccess.bind(this),onFailure:this.tagFail.bind(this)});if($("tagfield")){$("tagfield").value=A}},tagFail:function(A){$("tagList").innerHTML=this.savedTagStr;this.tagError.innerHTML=A;this.tagError.style.display="block";setTimeout(function(){this.tagError.style.display="none"}.bind(this),30000)},tagSuccess:function(){this.tagMsg.style.display="block";setTimeout(function(){this.tagMsg.style.display="none"}.bind(this),5000)}};PBwiki.init(Page.Tags.initialize);FormPost={post:function(D,A){var B=Object.extend({action:"",validate:function(){return true},method:"post"},A);if(B.validate()){var C=FormPost.constructForm(D);C.method=B.method;C.action=B.action;document.body.appendChild(C);C.submit()}},constructForm:function(B){var A=new Element("form");$H(B).each(function(D){PBwiki.debug("creating hidden input for %s:%s",D.key,D.value);var C=new Element("input",{type:"hidden",name:D.key,value:D.value,style:"display:none"});A.appendChild(C)});return A}};var PostCommand=Class.create({initialize:function(A){this.element=$(A);this.element.observe("click",this.onclick.bind(this))},onclick:function(F){var G=this.element.getAttribute("ui:validation");var E=this.element.getAttribute("ui:action")||this.element.href;var C=this.element.getAttribute("ui:query");var B=this.element.getAttribute("ui:confirm");var D=Util.parseQueryString(C);var A={action:E};if(G){A.validate=window[G]}PBwiki.debug(A);Event.stop(F);if(B==""||confirm(B)){FormPost.post(D,A)}}});PostCommand.initialize=function(){PostCommand.selector=".postcommand";try{$$(PostCommand.selector).each(function(B){new PostCommand(B)})}catch(A){PBwiki.warn("PostCommand: error: "+A)}};PBwiki.AddUserBehavior=Class.create({initialize:function(A){this.module=$(A);if(!this.module){return }try{this.emailInput=this.module.getElementsBySelector("input[name=add_user]")[0];this.submitBtn=this.module.getElementsBySelector("input[type=submit]")[0];this.permInput=this.module.getElementsBySelector("input[name=add_perm]")[0];this.errMsg=this.module.getElementsBySelector("p.validation-error")[0]}catch(B){return }this.submitBtn.observe("click",this.sendAddRequest.bind(this));this.emailInput.observe("keypress",this.handleEnterOnEmailField.bind(this))},handleEnterOnEmailField:function(A){if(A.keyCode==Event.KEY_RETURN){this.sendAddRequest();Event.stop(A)}},sendAddRequest:function(){var A=$F(this.emailInput);var D=this.emailInput.getAttribute("ui:placeholder");if(A!=D){var E=this.emailInput.name;var C=this.permInput.name;var B=Util.is_valid_email(A);if(B!==true){this.doErrorMessage(B);return }new PBwiki.APIRequest("AddUser",{email:A,perm:this.permInput.value,invite:true,demote:false},{onSuccess:this.addUserSuccess.bind(this),incUsess:true,onFailure:this.doErrorMessage.bind(this)});this.errMsg.hide()}},addUserSuccess:function(A){if(A.info=="added"||A.info=="created"||A.info=="accepted"){this.appendToAddList("Added "+A.email)}else{this.appendToAddList(A.email+" already exists")}this.emailInput.value="";this.emailInput.focus();this.errMsg.hide()},doErrorMessage:function(A){this.emailInput.focus();this.emailInput.select();this.errMsg.innerHTML=A;this.errMsg.style.display="block";setTimeout(function(){this.errMsg.hide()}.bind(this),5000)},appendToAddList:function(B){if(!this.emailList){this.emailList=new Element("ul",{className:"added-emails"});this.errMsg.insert({after:this.emailList})}var A=new Element("li",{className:"iconbutton accepticon"});A.innerHTML=B;this.emailList.appendChild(A);setTimeout(function(){A.style.display="none"},4000)}});var InputText=Class.create({initialize:function(B){this.element=$(B);try{this.placeholder=this.element.getAttribute("ui:placeholder");if(this.placeholder){this.placeholder=this.placeholder.strip()}if(this.placeholder&&!this.placeholder.empty()){this.element.observe("focus",this.onFocus.bind(this));this.element.observe("blur",this.onBlur.bind(this));this.element.observe("keypress",function(C){if(C.keyCode==Event.KEY_ESC){this.element.blur()}}.bind(this))}if(this.element.value.empty()||this.element.value==this.placeholder){this.setElementToEmptyStyle()}this.element.observe("ui:clearfield",this.onBlur.bind(this))}catch(A){throw new UIException("InputText: error",this.element,A)}},setElementToEmptyStyle:function(){this.element.setStyle({color:"#999"});this.element.value=this.placeholder;this.isEmpty=true},onFocus:function(A){this.element.setStyle({color:"#000"});if(this.isEmpty){this.element.value=""}},onBlur:function(){if(this.element.value.empty()){this.setElementToEmptyStyle()}else{this.isEmpty=false}}});InputText.initialize=function(){InputText.selector=".inputtext";try{$$(InputText.selector).each(function(B){new InputText(B)})}catch(A){PBwiki.warn(A)}};RadioButtonSelector=Class.create({initialize:function(B){this.element=$(B);this.selectrows=this.element.getElementsBySelector(".selectrow");this.selectors=this.element.getElementsBySelector("label, input[type=radio]");this.selectrows.invoke("observe","ui:select",this.selectEvent);var A=this.selectors.invoke("observe","click",this.fireSelectEvent.bind(this)).find(function(C){return C.checked});this.fireSelectEvent(A)},selectEvent:function(A){if(A.memo.descendantOf(this)){this.addClassName("selected");this.down("input").checked=true}else{this.removeClassName("selected")}},fireSelectEvent:function(A){this.selectrows.invoke("fire","ui:select",(A.element?A.element():A))}});CommentValidator={initialize:function(){if(!$("comment-form")){return }$("comment-form").onsubmit=CommentValidator.validate},validate:function(){if(Page.HTMLComments&&Page.HTMLComments.started){return }maxlength=2000;var A=$("comment-form-value");val=A.value;if(val.length>=maxlength){alert("Your comments must be "+maxlength+" characters or less. This comment is "+val.length+" characters.");A.focus();return false}else{if(val.length==0){alert("Your comment cannot be empty.");A.focus();return false}else{return true}}}};EllipsesManager={selector:".ellipses",initialize:function(){if(Prototype.Browser.Gecko||Util.IE6){EllipsesManager.redrawLines();Event.observe(window,"resize",EllipsesManager.redrawLines)}},redrawLines:function(){var A=$$(EllipsesManager.selector);function B(){A.each(EllipsesManager.singleLine)}B()},singleLine:function(A){var E=A.getAttribute("ui:text")||A.innerHTML;A.setAttribute("ui:text",E);A.innerHTML=E;var D={initialText:E,maxwidth:A.clientWidth,scrollWidth:A.scrollWidth,element:A};if(Util.IE6){D.maxwidth=A.offsetWidth}A.title=D.initialText;if(D.scrollWidth>D.maxwidth){var C=D.initialText.length;D.estimatedLength=Math.floor(C*0.95*(D.maxwidth/D.scrollWidth));var B=D.initialText.substr(0,D.estimatedLength)+"&hellip;";A.innerHTML=B;D.scrollWidth=A.scrollWidth;if(D.scrollWidth>D.maxwidth){EllipsesManager.parseBackward(D)}else{EllipsesManager.parseForward(D)}}},parseForward:function(D){var C=D.initialText.length;for(var A=D.estimatedLength+1;A<C;A++){var B=D.initialText.substr(0,A)+"&hellip;";D.element.innerHTML=B;if(D.element.scrollWidth>D.maxwidth){if(D.initialText[A-2]==" "){A--}D.element.innerHTML=D.initialText.substr(0,A-1)+"&hellip;";return }}},parseBackward:function(D){var C=D.initialText.length;for(var A=D.estimatedLength-1;A>0;A--){var B=D.initialText.substr(0,A)+"&hellip;";D.element.innerHTML=B;if(D.element.scrollWidth<=D.maxwidth){if(D.initialText[A-1]==" "){A--}D.element.innerHTML=D.initialText.substr(0,A)+"&hellip;";return }}}};PBwiki.init(EllipsesManager);PBwiki.init(InputText);PBwiki.init(PostCommand);PBwiki.init(CommentValidator);PBwiki.init(PBwiki.AddUserBehavior,"module:addusers");function insert_sig(){var A=FCKeditorAPI.GetInstance("content");var D=new Date();var E=D.getMonth()+1;var B=D.getDate();var C=D.getYear()-100;A.InsertHtml("-- Brian Kirchoff "+E+"/"+B+"/"+C)}function insert_file_into_editor(D,C,B){var A=FCKeditorAPI.GetInstance("content");var E=insert_get_selection();if(E==""){E='<img border="0" src="'+C+'" /></a>&nbsp;<a href="'+D+'">'+B}A.InsertHtml('<a href="'+D+'">'+E+"</a>");return false}function insert_newlink_into_editor(){var A=FCKeditorAPI.GetInstance("content");A.OpenDialog("PBWikiLink","Insert Link","plugins/pbwikilink/fck_pbwikilink.php",412,290)}function insert_newimage_into_editor(){var A=prompt("Enter the URL of the image to insert into the editor");if(A){insert_image_into_editor(A)}}function insert_image_into_editor(B){var A=FCKeditorAPI.GetInstance("content");A.InsertHtml('<img src="'+B+'" />');return false}function tagCloudToggle(B){var A=$("tagcloud");if(A.getStyle("display")=="none"){A.setStyle({display:"block"});B.innerHTML="Hide all tags"}else{A.setStyle({display:"none"});B.innerHTML="Show all tags"}}var g_pb_Enable_focus_changes=true;function insert_pagelink_into_editor(E,D){if(typeof D=="undefined"){D=E}var A=FCKeditorAPI.GetInstance("content");var C=insert_get_selection();if(C==""){C=D}var B=g_pb_Enable_focus_changes;g_pb_Enable_focus_changes=false;A.InsertHtml('<a href="/'+E+'" >'+C+"</a>");g_pb_Enable_focus_changes=B}function insert_get_selection(){var B=FCKeditorAPI.GetInstance("content");var A=B.Selection;if(A.GetType()=="Text"){if(document.all){return B.EditorDocument.selection.createRange().text}else{return B.EditorWindow.getSelection()}}return""}function load_real_thumbnail(B,A){var C=B.getAttribute("realsrc");if(C){B.setAttribute("src",C)}A.onmouseover=null}function load_all_files(){new Ajax.Updater("thingbarfiles","/api_v2/op/GetFileListAsHtml/_type/html")}function load_all_pages(){new Ajax.Updater("thingbarpages","/api_v2/op/GetPageListAsHtml/_type/html")}document.observe("ui:fckeditor_oncomplete",function(B){var A=B.memo.editorInstance;if(g_pb_Enable_focus_changes){A.Events.AttachEvent("OnSelectionChange",CheckFocusForNbsp)}});function CheckFocusForNbsp(C){if(!g_pb_Enable_focus_changes){return }var D=C.Selection.GetBoundaryParentElement();var E=C.Selection.GetSelection();if(!D||!E){return }var A=(E.createRange)?E.createRange().text:E.toString();if((!A||A=="")&&(D.innerHTML.length>0&&D.innerHTML.replace("&nbsp;","")==""||encodeURIComponent(D.innerHTML)=="%C2%A0")){if(C.EditorWindow.getSelection){E.collapse(D,false)}else{var B=E.createRange();B.moveToElementText(D);B.collapse(true);B.select()}}}Page.Notifications={cookieName:"pbNotifications",notificationList:[],initialize:function(){if(!$("notifications")||!$("notifications").hasClassName("ipm")){return }var C=$("notifications").select("li");var A=C.id;this.notificationList=new Array();for(var B=0;B<C.length;B++){this.notificationList.push(new Notification(C[B]))}this.updateDisplay()},addNotification:function(A){var B=this.findNotification($("notification-"+A.id));if(!B){this.notificationList.push(new Notification(null,A))}this.updateDisplay()},addError:function(B){var A={icon:"interstitial"};Object.extend(A,B);this.addNotification(A)},removeNotification:function(A){this.notificationList=$A(this.notificationList).without(A);this.updateDisplay()},findNotification:function(B){for(var A=0;A<this.notificationList.length;A++){if(this.notificationList[A].elm==B){return this.notificationList[A]}}},updateDisplay:function(){if(this.notificationList.length==0){$("notifications").style.display="none"}var B=$("notifications").select("li");for(var A=0;A<B.length;A++){if(A==B.length-1){B[A].addClassName("last")}else{B[A].removeClassName("last")}}}};var Notification=Class.create({initialize:function(B,A){if(B){if(B.hasClassName("dismiss")){this.dismissControl=B.down(".dismisscontrol");this.dismissControl.observe("click",this.dismiss.bind(this))}this.elm=B;this.contentElm=$(this.elm.childNodes[2]);this.id=B.id.replace("notification-","")}else{this.elm=new Element("li").addClassName("notification");if(A.dismiss){this.dismissControl=new Element("div").addClassName("dismisscontrol");this.elm.addClassName("dismiss");this.elm.appendChild(this.dismissControl)}if(A.icon){this.elm.addClassName("page-"+A.icon)}this.contentElm=new Element("p");if(A.html){this.contentElm.innerHTML=A.html}this.elm.appendChild(this.contentElm);$("notifications").appendChild(this.elm)}},setMessage:function(A){this.contentElm.innerHTML=A},remove:function(){this.elm.remove();Page.Notifications.removeNotification(this)},dismiss:function(){Messaging.Link({id:this.id,dismiss:1});this.remove()}});var Messaging={url:"/messaging.php?",Link:function(D){var C={mId:D.id};if(D.dismiss&&D.dismiss!="no"){C.dismiss=1;var B=Messaging.url+Object.toQueryString(C);new Ajax.Request(B);var A=$("notification-"+D.id);var E=Page.Notifications.findNotification(A);Page.Notifications.removeNotification(E)}if(D.url){C.url=D.url;var B=Messaging.url+Object.toQueryString(C);if(D.target=="_blank"){window.open(B)}else{window.location.href=B}}}};PBwiki.init(Page.Notifications.initialize.bind(Page.Notifications));Page.AjaxEdit={editMode:false,partialLoadEditor:false,initialize:function(){if(!PBwiki.feature("ajaxedit")){return }if(window.location.search.toString().indexOf("edit=")!=-1){return }if($("edit-tab")&&$("edit-toolbar")&&$("view-tab")&&!$("edit-tab").hasClassName("logintoedit")){Page.AjaxEdit.start.bind(Page.AjaxEdit)()}},start:function(){this.partialLoadEditor=true;this.modeEnabled=true;if(window.location.hash=="#pbedit"){window.location.hash="#view=edit"}this.historyManager=PBwiki.History;this.historyManager.getKey("view").observe("onChange",function(D){this.onViewChanged((D=="edit"))}.bind(this));if(this.historyManager.getKey("view").getValue()=="edit"){if($("edit-tab").hasClassName("steal")){this.historyManager.setValues({view:"page"})}else{if($("wikicontent")){$("wikicontent").hide()}this.onViewChanged(true)}}this.frameTimer=setTimeout(this.loadFirstStage.bind(this),(window.location.hash=="#view=edit")?0:1000);document.observe("ui:fckeditor_oncomplete",function(){PBwiki.info("Loaded second stage complete");this.secondStage=true;this.resizeContentPanel()}.bind(this));document.observe("ui:editview",function(){this.onViewChanged(true)}.bind(this));$("edit-tab").observe("mouseover",this.loadSecondStage.bind(this));$("view-tab").observe("click",this.tabClick.bindAsEventListener(this,false));$("edit-tab").observe("click",this.tabClick.bindAsEventListener(this,true));var A=$("edit-tab").down("a");if(A){A.onclick=null}var C=$("edit-toolbar").down(".button");$("cancelButton").observe("click",this.cancelEdit.bind(this));if(this.ajaxSave){C.observe("click",this.saveContent.bind(this));C.setAttribute("onclick","")}if(PBwiki.feature("ajaxcreate")){var B=$("main-tools").down("a.createpage");if(B&&!B.hasClassName("disabled")){B.observe("click",this.createPage.bind(this))}}Page.EditPage.Tags.initialize();this.historyManager.start()},tabClick:function(B,A){if(B){B.stop();try{B.element().blur()}catch(B){}}this.onViewChanged(A)},onViewChanged:function(A){if(this.editMode==A){return }if(!A&&this.IsDirty()){if(!confirm("You have unsaved changes. Continue and discard those changes?")){this.historyManager.setValues({view:(this.editMode)?"edit":"page"});return }}if(A&&$("edit-tab").hasClassName("steal")){if(!confirm("This page is being edited by "+$("lockinfo").down("a").innerHTML+". Are you sure you wish to steal the lock?")){this.setMode(false);return }}this.setMode(A)},setMode:function(B){if(this.editMode==B){return }this.editMode=B;this.historyManager.setValues({view:(B)?"edit":"page"});try{if(B){this.loadSecondStage();Page.Thingbar.doLoad();var A=[];A.push(["SetPageLock",{page:PBwiki.getPageName(),steal:$("edit-tab").hasClassName("steal")},{onSuccess:function(E){this.handleLockinfo(E.lockinfo)}.bind(this)}]);if($("notification-autosave")){var D=Page.Notifications.findNotification($("notification-autosave"));if(!D){D=$("notification-autosave")}D.remove();A.push(["GetAutosave",{page:PBwiki.getPageName()},{onSuccess:this.handleAutosave.bind(this)}])}else{A.push(["GetPage",{page:PBwiki.getPageName(),raw:true},{onSuccess:this.handleGetPage.bind(this)}])}new PBwiki.MultiAPIRequest(A,{incUsess:true,onAllComplete:function(E){if(E.lastError){document.fire("ui:onNotifyUser",{message:E.lastError});this.setMode(false)}}.bind(this)})}else{new PBwiki.APIRequest("UnlockPage",{page:PBwiki.getPageName()},{})}this.setChromeVisibility(B);this.setModeEvents(B)}catch(C){document.fire("ui:onNotifyUser",{message:"Failed to enter edit mode: "+C.message});return }if(!B&&this.secondStage&&this.IsDirty()){this.setContent(this.initialContent)}},IsDirty:function(){var A=this.getEditor();return((A)?A.IsDirty():false)||Page.EditPage.Tags.IsDirty()},handleGetPage:function(A){PBwiki.info("Got raw page contents");this.initialContent=A.html;this.setContent(A.html)},handleAutosave:function(A){PBwiki.info("Restored autosave data");if(A.autosave){this.setContent(A.autosave.DATA)}},handleLockinfo:function(B){if(!B.hasLock){PBwiki.info("Lost the lock on this page");var A='<div class="edit-warning"><div class="content">';A+='This page is being edited by <a href="/user/'+B.owner+'">'+B.editname.escapeHTML()+"</a>.";A+='<a class="edit-warning" href="#view=edit">Steal lock</a></div></div>';$("lockinfo").update(A);$("edit-tab").addClassName("steal");this.onViewChanged("view");return }else{PBwiki.info("Gained the lock on this page");$("edit-tab").removeClassName("steal");$("lockinfo").update("")}},setChromeVisibility:function(A){(!A)?$("view-tab").addClassName("active"):$("view-tab").removeClassName("active");(A)?$("edit-tab").addClassName("active"):$("edit-tab").removeClassName("active");(!A)?$("wikicontent").show():$("wikicontent").hide();$("wikiedit").style.display=(A)?"block":"none";if($("comments")){$("comments").style.display=(!A)?"block":"none"}$("page-bottom-toolbar").style.display=(!A)?"block":"none";$("expand-collapse-page").style.display=(!A)?"block":"none";if($("page-footer")&&$("page-footer").down(".content")){$("page-footer").down(".content").style.display=(!A)?"block":"none"}$("edit-toolbar").down(".iconbutton").style.position="relative";if(A){UserPrefs.Manager.saveWidth();UserPrefs.Manager.goFullWidth()}else{UserPrefs.Manager.restoreWidth()}if(A){this.resizeContentPanel()}},setModeEvents:function(A){window.onresize=(A)?this.resizeContentPanel.bind(this):null;window.onbeforeunload=(A)?this.beforeUnload.bind(this):null;if(A){Page.EditPage.AutoSave.start.bind(Page.EditPage.AutoSave)()}else{Page.EditPage.AutoSave.stop.bind(Page.EditPage.AutoSave)()}},cancelEdit:function(A){A.stop();this.setMode(false)},resetDirty:function(){if(this.secondStage){var A=this.getEditor();if(A&&A.ResetIsDirty){A.ResetIsDirty()}}},doDeleteAutosave:function(){new PBwiki.APIRequest("DeleteAutosave",{page:PBwiki.getPageName()},{onSuccess:function(){Page.Notifications.findNotification($("notification-autosave")).remove()}})},setEditorFocus:function(){$("autosave_msg").update($("autosave_msg").innerHTML);var A=this.getEditor();if(A&&this.secondStage){A.Focus()}},setContent:function(B){var A=this.getEditor();if(A){A.SetHTML(B,true);A.Focus()}$("content").value=B},getEditor:function(){if(typeof (FCKeditorAPI)!="undefined"){return FCKeditorAPI.GetInstance("content")}},loadSecondStage:function(){if(this.secondStage||this.secondLoading){return }PBwiki.info("Load second stage");this.secondLoading=true;this.partialLoadEditor=false;this.loadFirstStage();if(!PBinfo.CurrentPage.hasPlugins&&$$(".searchhilitepage").length==0){this.editContent=$("wikipage-inner")?$("wikipage-inner").innerHTML:""}var A=$("content___Frame");if(A&&A.contentWindow&&A.contentWindow.SecondStage){PBwiki.info("Partially loaded, loading second stage now");A.contentWindow.SecondStage()}},loadFirstStage:function(){if(this.firstStage||this.firstLoading){return }this.firstLoading=true;if($("content")){return }PBwiki.info("Load first stage");var B=$("wikiedit");var C=(Prototype.Browser.IE)?"ie":"gecko";var A='<iframe id="content___Frame" src="/FCKeditor/build-fck/editor/'+C+"-"+PBinfo.CurrentPage.editorVersion+(PBinfo.CurrentWiki.debug?"/debug":"");A+='" width="100%" height="'+this.getResizeHeight()+'" frameborder="0" scrolling="no"></iframe>';A+='<input type="hidden" id="content___Config" value="ToolbarStartExpanded=true&amp;SkinPath=/FCKeditor/build-fck/editor/skins/silver/" style="display:none" />';var E=new Element("textarea");E.setAttribute("id","content");E.setAttribute("name","content");E.style.display="none";E.value="";var D=this.getContentFromPage();if(D){E.value=this.initialContent=D}$("editframe").innerHTML=A;$("editframe").appendChild(E);if(PBinfo.CurrentWiki.debug){$("content___Frame").contentWindow.onerror=PBwiki.jsDebug}},firstStageLoaded:function(){this.firstStage=true;this.firstLoading=false;document.fire("ui:fckeditor_preloaded")},getResizeHeight:function(){var C=$("content___Frame");var B=(C&&C.cumulativeOffset)?C.cumulativeOffset()[1]:$("editwikipage").cumulativeOffset()[1];if($("page-footer")){B+=$("page-footer").getHeight()+parseInt($("page-footer").getStyle("marginBottom"))}B+=$("edit-toolbar-outer").getHeight()+parseInt($("edit-toolbar-outer").getStyle("marginBottom"));var A=document.documentElement.clientHeight-(B+2);A=(A<310?310:A);return A},resizeContentPanel:function(){var A=$("content___Frame");if(!A){return }A.style.height=this.getResizeHeight()+"px";if(A.contentWindow.onresize){A.contentWindow.onresize()}if(this.editMode){this.setEditorFocus()}},beforeUnload:function(A){A=A||window.event;try{if(this.IsDirty()&&!Page.EditPage.cancel){var C="You have unsaved changes. Continue and discard those changes?";A.returnValue=C;return C}}catch(B){}},getContentFromPage:function(){if(!$("wikipage-inner")||PBinfo.CurrentPage.hasPlugins||$$(".searchhilitepage").length>0||$$("table.pbSortable").length>0){return }return $("wikipage-inner").innerHTML},createPage:function(A){A.stop();new PBwiki.DialogCommands.CreateNewPage({noPreloadView:true,onCreate:function(B){window.location.href=PBwiki.getEditURI(B)}})}};Page.Thingbar={pageOpts:{verbose:true,detail:"partial",count:10,offset:0,sortby:"mtime",reverse:true},fileOpts:{verbose:true,detail:"partial",count:10,offset:0,sortby:"mtime",reverse:true},doLoad:function(){if(!$("thingbarLoadIcon")){return true}this.loadPages();$("linkselectab-images").observe("ui:tabswitched",this.filesTab.bind(this))},showPageLoadIcon:function(){this.pageList.update('<img src="/images/spin_bw.gif" /> Loading '+((!this.pageOpts.count)?"All ":"")+"Pages...")},showFileLoadIcon:function(){this.fileList.update('<img src="/images/spin_bw.gif" /> Loading '+((!this.fileOpts.count)?"All ":"")+"Files...")},loadPages:function(){this.pageList=$("thingbarpages");this.showPageLoadIcon();new PBwiki.APIRequest("GetPages",this.pageOpts,{cacheability:["pagetime","foldertime","permtime"],onSuccess:function(A){this.pageList.update("");A.pages.each(function(C){var B=new Element("li").addClassName("tbpage");B.appendChild(new Element("span"));B.appendChild(new Element("a",{unselectable:"on"}).update(C.name.toString().escapeHTML()).observe("mousedown",function(D){D.stop();this.pageLink(Util.dashified_link(C.name.toString()),C.name.toString());return false}.bind(this)));this.pageList.appendChild(B)}.bind(this));if(this.pageOpts.count&&A._total_count>A.pages.length){this.pageList.appendChild(new Element("a",{href:"javascript:void(0);"}).update("Show all "+A._total_count+" pages").observe("mousedown",function(B){B.stop();delete this.pageOpts.count;delete this.pageOpts.offset;this.loadPages()}.bind(this)))}}.bind(this),priority:PBwiki.Data.LOW_PRIORITY})},filesTab:function(){if(!$("file_upload_button")){$("thingbar-images").down().update("");new PBwiki.Components.FileUploadButton({txt:"Upload files",id:"file_upload_button",addTo:$("thingbar-images").down(),onUploaded:function(){new PBwiki.APIRequest("GetTimes",{},{onSuccess:function(){this.loadFiles()}.bind(this)})}.bind(this)});$("file_upload_button").down("span").setStyle({textDecoration:"underline",cursor:"pointer"})}this.loadFiles()},loadFiles:function(){this.fileList=$("thingbarfiles");this.showFileLoadIcon();new PBwiki.APIRequest("GetFiles",this.fileOpts,{cacheability:["filetime","foldertime","permtime"],onSuccess:function(A){this.fileList.update("");A.files.each(function(C){var B=new Element("li").addClassName("tbfile");var D=Util.iconMap[Util.getFileExtension(C.name.toString())];B.appendChild(new Element("span").addClassName("fileicon").addClassName(D));B.appendChild(new Element("a",{unselectable:"on"}).update(C.name.toString().escapeHTML()).observe("mousedown",function(E){E.stop();this.fileLink(C.name.toString(),(D=="ob_item_jpg"));return false}.bind(this)));this.fileList.appendChild(B);Util.addObjectTooltip(B,C)}.bind(this));if(this.fileOpts.count&&A._total_count>A.files.length){this.fileList.appendChild(new Element("a",{href:"javascript:void(0);"}).update("Show all "+A._total_count+" files").observe("mousedown",function(B){B.stop();delete this.fileOpts.count;delete this.fileOpts.offset;this.loadFiles()}.bind(this)))}else{if(A._total_count==0){this.fileList.update("No recent files")}}}.bind(this),priority:PBwiki.Data.LOW_PRIORITY})},getSelectedText:function(){var A=Page.AjaxEdit.getEditor().Selection.GetSelection();return(A.createRange)?A.createRange().text:A.toString()},pageLink:function(B,C){var A=Page.AjaxEdit.getEditor();var D=A.EditorDocument.createElement("a");D.setAttribute("href",B);D.innerHTML=this.getSelectedText()||C.escapeHTML();A.InsertElement(D);A.Focus()},fileLink:function(A,D){var B=Page.AjaxEdit.getEditor();D=D&&this.getSelectedText()=="";var C=B.EditorDocument.createElement(D?"img":"a");C.setAttribute((D)?"src":"href","/f/"+encodeURIComponent(A));if(!D){C.innerHTML=this.getSelectedText()||A}B.InsertElement(C)}};PBwiki.init(Page.AjaxEdit);Page.NewPage={initialize:function(){if(!$("createpageform")){return false}Event.observe("createpagemore","click",Page.NewPage.toggleMoreOptions.bind(this));Event.observe("tipmoreoptions","click",Page.NewPage.toggleMoreOptions.bind(this));Event.observe("page_name","keydown",Page.NewPage.isCharacterValid.bind(this));Page.NewPage.toggleElements=$$($("createpagemore").getAttribute("ui:elements"));Page.NewPage.link=$("createpagemore")},isCharacterValid:function(A){},toggleMoreOptions:function(D){var B=Page.NewPage.link;var C=B.innerHTML;var A=B.getAttribute("ui:alternate");if(A){B.setAttribute("ui:alternate",B.innerHTML);B.innerHTML=A}$(B.parentNode.parentNode).toggleClassName("expanded");B.blur();D.stop();Page.NewPage.toggleElements.invoke("toggle");$("createpageoptions_visible").setAttribute("value",$(B.parentNode.parentNode).hasClassName("expanded")?"true":"false");$("page_name").focus()}};var Validator=Class.create();Validator.prototype={initialize:function(C,B,D,A){if(typeof D=="function"){this.options=$H(A);this._test=D}else{this.options=$H(D);this._test=function(){return true}}this.error=B||"Validation failed.";this.className=C},test:function(A,B){return(this._test(A,B)&&this.options.all(function(C){return Validator.methods[C.key]?Validator.methods[C.key](A,B,C.value):true}))}};Validator.methods={pattern:function(A,C,B){return Validation.get("IsEmpty").test(A)||B.test(A)},minLength:function(A,C,B){return A.length>=B},maxLength:function(A,C,B){return A.length<=B},min:function(A,C,B){return A>=parseFloat(B)},max:function(A,C,B){return A<=parseFloat(B)},notOneOf:function(A,C,B){return $A(B).all(function(D){return A!=D})},oneOf:function(A,C,B){return $A(B).any(function(D){return A==D})},is:function(A,C,B){return A==B},isNot:function(A,C,B){return A!=B},equalToField:function(A,C,B){return A==$F(B)},notEqualToField:function(A,C,B){return A!=$F(B)},include:function(A,C,B){return $A(B).all(function(D){return Validation.get(D).test(A,C)})}};var Validation=Class.create();Validation.prototype={initialize:function(C,A){this.options=Object.extend({onSubmit:true,stopOnFirst:false,immediate:false,focusOnError:true,useTitles:false,onFormValidate:function(E,F){},onElementValidate:function(E,F){}},A||{});this.form=$(C);if(this.options.onSubmit){Event.observe(this.form,"submit",this.onSubmit.bind(this),false)}if(this.options.immediate){var B=this.options.useTitles;var D=this.options.onElementValidate;Form.getElements(this.form).each(function(E){Event.observe(E,"blur",function(F){Validation.validate(Event.element(F),{useTitle:B,onElementValidate:D})})})}},onSubmit:function(A){if(!this.validate()){Event.stop(A)}},validate:function(){var A=false;var B=this.options.useTitles;var C=this.options.onElementValidate;if(this.options.stopOnFirst){A=Form.getElements(this.form).all(function(D){return Validation.validate(D,{useTitle:B,onElementValidate:C})})}else{A=Form.getElements(this.form).collect(function(D){return Validation.validate(D,{useTitle:B,onElementValidate:C})}).all()}if(!A&&this.options.focusOnError){Form.getElements(this.form).findAll(function(D){return $(D).hasClassName("validation-failed")}).first().focus()}this.options.onFormValidate(A,this.form);return A},reset:function(){Form.getElements(this.form).each(Validation.reset)}};Object.extend(Validation,{validate:function(C,A){A=Object.extend({useTitle:false,onElementValidate:function(D,E){}},A||{});C=$(C);var B=C.classNames();return result=B.all(function(D){var E=Validation.test(D,C,A.useTitle);A.onElementValidate(E,C);return E})},test:function(B,G,H){var I=Validation.get(B);var A="__advice"+B.camelize();try{if(Validation.isVisible(G)&&!I.test($F(G),G)){if(!G[A]){var D=Validation.getAdvice(B,G);if(D==null){var E=H?((G&&G.title)?G.title:I.error):I.error;D='<div class="validation-advice" id="advice-'+B+"-"+Validation.getElmID(G)+'" style="display:none">'+E+"</div>";switch(G.type.toLowerCase()){case"checkbox":case"radio":var C=G.parentNode;if(C){new Insertion.Bottom(C,D)}else{new Insertion.After(G,D)}break;default:new Insertion.After(G,D)}D=Validation.getAdvice(B,G)}if(typeof Effect=="undefined"){D.style.display="block"}else{new Effect.Appear(D,{duration:1})}}G[A]=true;G.removeClassName("validation-passed");G.addClassName("validation-failed");return false}else{var D=Validation.getAdvice(B,G);if(D!=null){D.hide()}G[A]="";G.removeClassName("validation-failed");G.addClassName("validation-passed");return true}}catch(F){throw (F)}},isVisible:function(A){while(A.tagName!="BODY"){if(!$(A).visible()){return false}A=A.parentNode}return true},getAdvice:function(A,B){return $("advice-"+A+"-"+Validation.getElmID(B))||$("advice-"+Validation.getElmID(B))},getElmID:function(A){return A.id?A.id:A.name},reset:function(B){B=$(B);var A=B.classNames();A.each(function(D){var E="__advice"+D.camelize();if(B[E]){var C=Validation.getAdvice(D,B);C.hide();B[E]=""}B.removeClassName("validation-failed");B.removeClassName("validation-passed")})},add:function(D,C,E,B){var A={};A[D]=new Validator(D,C,E,B);Object.extend(Validation.methods,A)},addAllThese:function(A){var B={};$A(A).each(function(C){B[C[0]]=new Validator(C[0],C[1],C[2],(C.length>3?C[3]:{}))});Object.extend(Validation.methods,B)},get:function(A){return Validation.methods[A]?Validation.methods[A]:Validation.methods._LikeNoIDIEverSaw_},methods:{_LikeNoIDIEverSaw_:new Validator("_LikeNoIDIEverSaw_","",{})}});Validation.add("IsEmpty","",function(A){return((A==null)||(A.length==0))});Validation.addAllThese([["required","This is a required field.",function(A){return !Validation.get("IsEmpty").test(A)}],["validate-number","Please enter a valid number in this field.",function(A){return Validation.get("IsEmpty").test(A)||(!isNaN(A)&&!/^\s+$/.test(A))}],["validate-digits","Please use numbers only in this field. please avoid spaces or other characters such as dots or commas.",function(A){return Validation.get("IsEmpty").test(A)||!/[^\d]/.test(A)}],["validate-alpha","Please use letters only (a-z) in this field.",function(A){return Validation.get("IsEmpty").test(A)||/^[a-zA-Z]+$/.test(A)}],["validate-alphanum","Please use only letters (a-z) or numbers (0-9) only in this field. No spaces or other characters are allowed.",function(A){return Validation.get("IsEmpty").test(A)||!/\W/.test(A)}],["validate-date","Please enter a valid date.",function(A){var B=new Date(A);return Validation.get("IsEmpty").test(A)||!isNaN(B)}],["validate-email","Please enter a valid email address. For example fred@domain.com .",function(A){return Validation.get("IsEmpty").test(A)||/\w{1,}[@][\w\-]{1,}([.]([\w\-]{1,})){1,3}$/.test(A)}],["validate-url","Please enter a valid URL.",function(A){return Validation.get("IsEmpty").test(A)||/^(http|https|ftp):\/\/(([A-Z0-9][A-Z0-9_-]*)(\.[A-Z0-9][A-Z0-9_-]*)+)(:(\d+))?\/?/i.test(A)}],["validate-date-au","Please use this date format: dd/mm/yyyy. For example 17/03/2006 for the 17th of March, 2006.",function(A){if(Validation.get("IsEmpty").test(A)){return true}var B=/^(\d{2})\/(\d{2})\/(\d{4})$/;if(!B.test(A)){return false}var C=new Date(A.replace(B,"$2/$1/$3"));return(parseInt(RegExp.$2,10)==(1+C.getMonth()))&&(parseInt(RegExp.$1,10)==C.getDate())&&(parseInt(RegExp.$3,10)==C.getFullYear())}],["validate-currency-dollar","Please enter a valid $ amount. For example $100.00 .",function(A){return Validation.get("IsEmpty").test(A)||/^\$?\-?([1-9]{1}[0-9]{0,2}(\,[0-9]{3})*(\.[0-9]{0,2})?|[1-9]{1}\d*(\.[0-9]{0,2})?|0(\.[0-9]{0,2})?|(\.[0-9]{1,2})?)$/.test(A)}],["validate-selection","Please make a selection",function(A,B){return B.options?B.selectedIndex>0:!Validation.get("IsEmpty").test(A)}],["validate-one-required","Please select one of the above options.",function(A,D){var C=D.parentNode;var B=C.getElementsByTagName("INPUT");return $A(B).any(function(E){return $F(E)})}]]);var stIsIE=
/*@cc_on!@*/
false;sorttable={init:function(){if(arguments.callee.done){return }arguments.callee.done=true;if(_timer){clearInterval(_timer)}if(!document.createElement||!document.getElementsByTagName){return }sorttable.DATE_RE=/^(\d\d?)[\/\.-](\d\d?)[\/\.-]((\d\d)?\d\d)$/;forEach(document.getElementsByTagName("table"),function(A){if(A.className.search(/\bpbSortable\b/)!=-1){sorttable.makeSortable(A)}})},makeSortable:function(B){if(B.getElementsByTagName("thead").length==0){the=document.createElement("thead");the.appendChild(B.rows[0]);B.insertBefore(the,B.firstChild)}if(B.tHead==null){B.tHead=B.getElementsByTagName("thead")[0]}if(B.tHead.rows.length!=1){return }sortbottomrows=[];for(var A=0;A<B.rows.length;A++){if(B.rows[A].className.search(/\bsortbottom\b/)!=-1){sortbottomrows[sortbottomrows.length]=B.rows[A]}}if(sortbottomrows){if(B.tFoot==null){tfo=document.createElement("tfoot");B.appendChild(tfo)}for(var A=0;A<sortbottomrows.length;A++){tfo.appendChild(sortbottomrows[A])}delete sortbottomrows}headrow=B.tHead.rows[0].cells;for(var A=0;A<headrow.length;A++){if(!headrow[A].className.match(/\bsorttable_nosort\b/)){mtch=headrow[A].className.match(/\bsorttable_([a-z0-9]+)\b/);if(mtch){override=mtch[1]}if(mtch&&typeof sorttable["sort_"+override]=="function"){headrow[A].sorttable_sortfunction=sorttable["sort_"+override]}else{headrow[A].sorttable_sortfunction=sorttable.guessType(B,A)}headrow[A].sorttable_columnindex=A;headrow[A].sorttable_tbody=B.tBodies[0];dean_addEvent(headrow[A],"click",function(D){if(this.className.search(/\bsorttable_sorted\b/)!=-1){sorttable.reverse(this.sorttable_tbody);this.className=this.className.replace("sorttable_sorted","sorttable_sorted_reverse");this.removeChild(document.getElementById("sorttable_sortfwdind"));sortrevind=document.createElement("span");sortrevind.id="sorttable_sortrevind";sortrevind.setAttribute("style","float: left;");sortrevind.innerHTML=stIsIE?'&nbsp<font face="webdings">5</font>&nbsp;':"&nbsp;&#x25B4;&nbsp;";this.insertBefore(sortrevind,this.firstChild);return }if(this.className.search(/\bsorttable_sorted_reverse\b/)!=-1){sorttable.reverse(this.sorttable_tbody);this.className=this.className.replace("sorttable_sorted_reverse","sorttable_sorted");this.removeChild(document.getElementById("sorttable_sortrevind"));sortfwdind=document.createElement("span");sortfwdind.id="sorttable_sortfwdind";sortfwdind.setAttribute("style","float: left;");sortfwdind.innerHTML=stIsIE?'&nbsp<font face="webdings">6</font>&nbsp;':"&nbsp;&#x25BE;&nbsp;";this.insertBefore(sortfwdind,this.firstChild);return }theadrow=this.parentNode;forEach(theadrow.childNodes,function(E){if(E.nodeType==1){E.className=E.className.replace("sorttable_sorted_reverse","");E.className=E.className.replace("sorttable_sorted","")}});sortfwdind=document.getElementById("sorttable_sortfwdind");if(sortfwdind){sortfwdind.parentNode.removeChild(sortfwdind)}sortrevind=document.getElementById("sorttable_sortrevind");if(sortrevind){sortrevind.parentNode.removeChild(sortrevind)}this.className+=" sorttable_sorted";sortfwdind=document.createElement("span");sortfwdind.id="sorttable_sortfwdind";sortfwdind.setAttribute("style","float: left;");sortfwdind.innerHTML=stIsIE?'&nbsp<font face="webdings">6</font>&nbsp;':"&nbsp;&#x25BE;&nbsp;";this.insertBefore(sortfwdind,this.firstChild);row_array=[];col=this.sorttable_columnindex;rows=this.sorttable_tbody.rows;for(var C=0;C<rows.length;C++){row_array[row_array.length]=[sorttable.getInnerText(rows[C].cells[col]),rows[C]]}row_array.sort(this.sorttable_sortfunction);tb=this.sorttable_tbody;for(var C=0;C<row_array.length;C++){tb.appendChild(row_array[C][1])}delete row_array})}}},guessType:function(C,B){sortfn=sorttable.sort_alpha;for(var A=0;A<C.tBodies[0].rows.length;A++){text=sorttable.getInnerText(C.tBodies[0].rows[A].cells[B]);if(text!=""){if(text.match(/^-?[$]?[\d,.]+%?$/)){return sorttable.sort_numeric}possdate=text.match(sorttable.DATE_RE);if(possdate){first=parseInt(possdate[1]);second=parseInt(possdate[2]);if(first>12){return sorttable.sort_ddmm}else{if(second>12){return sorttable.sort_mmdd}else{sortfn=sorttable.sort_ddmm}}}}}return sortfn},getInnerText:function(B){hasInputs=(typeof B.getElementsByTagName=="function")&&B.getElementsByTagName("input").length;if(B.getAttribute("sorttable_customkey")!=null){return B.getAttribute("sorttable_customkey")}else{if(typeof B.textContent!="undefined"&&!hasInputs){return B.textContent.replace(/^\s+|\s+$/g,"")}else{if(typeof B.innerText!="undefined"&&!hasInputs){return B.innerText.replace(/^\s+|\s+$/g,"")}else{if(typeof B.text!="undefined"&&!hasInputs){return B.text.replace(/^\s+|\s+$/g,"")}else{switch(B.nodeType){case 3:if(B.nodeName.toLowerCase()=="input"){return B.value.replace(/^\s+|\s+$/g,"")}case 4:return B.nodeValue.replace(/^\s+|\s+$/g,"");break;case 1:case 11:var C="";for(var A=0;A<B.childNodes.length;A++){C+=sorttable.getInnerText(B.childNodes[A])}return C.replace(/^\s+|\s+$/g,"");break;default:return""}}}}}},reverse:function(A){newrows=[];for(var B=0;B<A.rows.length;B++){newrows[newrows.length]=A.rows[B]}for(var B=newrows.length-1;B>=0;B--){A.appendChild(newrows[B])}delete newrows},sort_numeric:function(B,A){aa=parseFloat(B[0].replace(/[^0-9.-]/g,""));if(isNaN(aa)){aa=0}bb=parseFloat(A[0].replace(/[^0-9.-]/g,""));if(isNaN(bb)){bb=0}return aa-bb},sort_alpha:function(B,A){if(B[0]==A[0]){return 0}if(B[0]<A[0]){return -1}return 1},sort_ddmm:function(B,A){mtch=B[0].match(sorttable.DATE_RE);y=mtch[3];m=mtch[2];d=mtch[1];if(m.length==1){m="0"+m}if(d.length==1){d="0"+d}dt1=y+m+d;mtch=A[0].match(sorttable.DATE_RE);y=mtch[3];m=mtch[2];d=mtch[1];if(m.length==1){m="0"+m}if(d.length==1){d="0"+d}dt2=y+m+d;if(dt1==dt2){return 0}if(dt1<dt2){return -1}return 1},sort_mmdd:function(B,A){mtch=B[0].match(sorttable.DATE_RE);y=mtch[3];d=mtch[2];m=mtch[1];if(m.length==1){m="0"+m}if(d.length==1){d="0"+d}dt1=y+m+d;mtch=A[0].match(sorttable.DATE_RE);y=mtch[3];d=mtch[2];m=mtch[1];if(m.length==1){m="0"+m}if(d.length==1){d="0"+d}dt2=y+m+d;if(dt1==dt2){return 0}if(dt1<dt2){return -1}return 1},shaker_sort:function(F,D){var A=0;var C=F.length-1;var G=true;while(G){G=false;for(var B=A;B<C;++B){if(D(F[B],F[B+1])>0){var E=F[B];F[B]=F[B+1];F[B+1]=E;G=true}}C--;if(!G){break}for(var B=C;B>A;--B){if(D(F[B],F[B-1])<0){var E=F[B];F[B]=F[B-1];F[B-1]=E;G=true}}A++}}};if(document.addEventListener){document.addEventListener("DOMContentLoaded",sorttable.init,false);
/*@cc_on @*/
/*@if (@_win32)
    document.write("<script id=__ie_onload defer src=javascript:void(0)><\/script>");
    var script = document.getElementById("__ie_onload");
    script.onreadystatechange = function() {
        if (this.readyState == "complete") {
            sorttable.init(); // call the onload handler
        }
    };
/*@end @*/
}if(/WebKit/i.test(navigator.userAgent)){var _timer=setInterval(function(){if(/loaded|complete/.test(document.readyState)){sorttable.init()}},10)}window.onload=sorttable.init;function dean_addEvent(B,D,C){if(B.addEventListener){B.addEventListener(D,C,false)}else{if(!C.$$guid){C.$$guid=dean_addEvent.guid++}if(!B.events){B.events={}}var A=B.events[D];if(!A){A=B.events[D]={};if(B["on"+D]){A[0]=B["on"+D]}}A[C.$$guid]=C;B["on"+D]=handleEvent}}dean_addEvent.guid=1;function removeEvent(A,C,B){if(A.removeEventListener){A.removeEventListener(C,B,false)}else{if(A.events&&A.events[C]){delete A.events[C][B.$$guid]}}}function handleEvent(D){var C=true;D=D||fixEvent(((this.ownerDocument||this.document||this).parentWindow||window).event);var A=this.events[D.type];for(var B in A){this.$$handleEvent=A[B];if(this.$$handleEvent(D)===false){C=false}}return C}function fixEvent(A){A.preventDefault=fixEvent.preventDefault;A.stopPropagation=fixEvent.stopPropagation;return A}fixEvent.preventDefault=function(){this.returnValue=false};fixEvent.stopPropagation=function(){this.cancelBubble=true};if(!Array.forEach){Array.forEach=function(D,C,B){for(var A=0;A<D.length;A++){C.call(B,D[A],A,D)}}}Function.prototype.forEach=function(A,D,C){for(var B in A){if(typeof this.prototype[B]=="undefined"){D.call(C,A[B],B,A)}}};String.forEach=function(A,C,B){Array.forEach(A.split(""),function(E,D){C.call(B,E,D,A)})};var forEach=function(A,D,B){if(A){var C=Object;if(A instanceof Function){C=Function}else{if(A.forEach instanceof Function){A.forEach(D,B);return }else{if(typeof A=="string"){C=String}else{if(typeof A.length=="number"){C=Array}}}}C.forEach(A,D,B)}};var gIndicesOfMatches=new Array();var gIndicesOfMatchesPrevious=new Array();var gSelected=null;var gSelectionIndex=-1;var gAcPreviousInputValue="";var kMatchShowMax=8;var gAcOutId=null;var gAcInId=null;var gAcCaseInsensitive=true;var gAcDressMatches=false;var gBundleCompletelyLoaded=false;var gStartedVisible=false;var gMatchedUsingLower=true;var gDidIeBump=false;var gAcEventType="keyup";var is_ie=/MSIE/.test(navigator.userAgent);var is_fx=/Firefox/.test(navigator.userAgent);var is_gecko=/gecko/i.test(navigator.userAgent);var is_safari=/safari/i.test(navigator.userAgent);var gAcShouldObserveKeypress="keypress";if(is_ie){gAcShouldObserveKeypress="keydown"}if(is_safari){gAcShouldObserveKeypress="keydown"}function setup_autocomplete_field(A,B,C){gAcInId=A;gAcOutId=B;gStartedVisible=true;if(!gDidIeBump&&(is_ie)&&false){if(smr=document.getElementById("sub-menu-right")){smr.display="block"}document.getElementById(gAcOutId).style.display="block";document.getElementById(gAcOutId).style.top+=25;gDidIeBump=true}if(!gBundleCompletelyLoaded){Event.observe(gAcInId,"focus",autocomplete_fetch_bundle,false)}else{enable_autocomplete_field()}}function autocomplete_fetch_bundle(){enable_autocomplete_field();Event.stopObserving(gAcInId,"focus",autocomplete_fetch_bundle,false);new Ajax.Request(gBundleUrl,{method:"get",onSuccess:function(transport){var response=transport.responseText;if(!response){return }gBundle=eval("("+response+")");for(i=0;i<gBundle.length;i++){gBundle[i].name=gBundle[i].name+""}var inp=document.getElementById(gAcInId);gBundleCompletelyLoaded=true},onException:function(req,exception){PBwiki.error("The request had a fatal exception thrown.\n\n"+exception+"\n\nin "+req);return true},onFailure:function(req){document.getElementById(gAcOutId).innerHTML="..."}})}function enable_autocomplete_field(A){Event.observe(gAcInId,gAcEventType,autocomplete_keyhandler,true);if(gAcShouldObserveKeypress){Event.observe(gAcInId,gAcShouldObserveKeypress,autocomplete_keyhandler,true)}if(gStartedVisible){document.getElementById(gAcInId).setAttribute("autocomplete","off");if(!A){document.getElementById(gAcInId).setAttribute("value","")}document.getElementById(gAcInId).setAttribute("onfocus",null)}else{setTimeout("document.getElementById(gAcInId).style.display = 'block';",10)}setTimeout("document.getElementById(gAcInId).focus();",20);Event.observe(document,"click",autocomplete_reset,true)}function disable_autocomplete_field(){}function autocomplete_reset(A){$(gAcOutId).innerHTML="";if(A==1){$(gAcInId).value=""}gIndicesOfMatches=new Array();gSelected=null;gSelectionIndex=-1;if(gStartedVisible){}else{$(gAcInId).style.display="none"}}function autocomplete_keyhandler(H){var C=H.keyCode||H.charCode;var K=String.fromCharCode(C);var I=H.srcElement?H.srcElement:H.target;if(!H.shiftKey){K=K.toLowerCase()}if(H.keyCode==16){return }if(H.ctrlKey){var M=String.fromCharCode(C);if(M=="e"){Event.stop(H);return }if(M=="/"){Event.stop(H);return }if(M=="a"){return }}if(C&&((H.type=="keydown")||(is_fx&&H.type=="keypress"))){if(C==Event.KEY_BACKSPACE){gSelectionIndex=-1;gSelected=null}else{if(C==Event.KEY_DOWN){if((gSelectionIndex<=(kMatchShowMax))&&(gSelectionIndex<(gIndicesOfMatches.length-1))){gSelectionIndex++}autocomplete_redraw();Event.stop(H);return }else{if(C==Event.KEY_UP){if(gSelectionIndex>=0){gSelectionIndex--}else{if((gSelectionIndex==-1)&&(gIndicesOfMatches.length)){gSelectionIndex=gIndicesOfMatches.length-1}}autocomplete_redraw();Event.stop(H);return }else{if(C==Event.KEY_RIGHT){gSelectionIndex=-1;gSelected=null;return }else{if(C==Event.KEY_LEFT){gSelectionIndex=-1;gSelected=null;return }else{if(C==Event.KEY_RETURN){if(gSelected){var B=true;var D="You selected the "+gSelected.type+" called "+gSelected.name;if(gSelected.members){document.getElementById(gAcInId).value="tag:"+gSelected.name;gSelected=null;gSelectionIndex=-1;B=false;Event.stop(H)}else{if(H.target.value.match(/^tag:/)){document.location.href="/FindPage?SearchFor="+encodeURI(H.target.value)}else{if(url=gSelected.url){var N=null;var O=false;if(O&&gSelected.type&&gSelected.type=="file"){if(is_ie){N=open(url,"meow")}else{N=window.open(url,gSelected.name)}}if(!N){document.location.href=url}Event.stop(H);return }}}if(B){Event.stop(H);return }}}else{if(C==Event.KEY_ESC){Event.stopObserving(gAcInId,gAcEventType,autocomplete_keyhandler,true);if(gAcShouldObserveKeypress){Event.stopObserving(gAcInId,gAcShouldObserveKeypress,autocomplete_keyhandler,true)}Event.stop(H);autocomplete_reset(1);setup_autocomplete_field(gAcInId,gAcOutId,gStartedVisible);return }else{if(C==Event.KEY_TAB){if(gIndicesOfMatches.length){gSelectionIndex=0;gSelected=gBundle[gIndicesOfMatches[gSelectionIndex]];I.value=gSelected.name;setSelectionRange(I,I.value.length,I.value.length);autocomplete_repaint()}if(I.value.length){Event.stop(H)}return }}}}}}}}return }var J=I.value;var F=J;if(H.type=="keypress"){if(is_fx){return }if(C!=Event.KEY_BACKSPACE){var A=getSelectionStart(I);var E=getSelectionEnd(I);var L=J.substr(0,A);var G=J.substr(E,J.length-E);F=L+K+G}else{F=F.substr(0,F.length-1)}}I.value=F;gIndicesOfMatchesPrevious=gIndicesOfMatches;autocomplete_repaint()}function autocomplete_repaint(){if(!gBundleCompletelyLoaded){return }if(!window.painting){window.painting=true;setTimeout("autocomplete_redraw();",100)}}function autocomplete_redraw(){window.painting=false;var A=document.getElementById(gAcInId).value;var C={type:"search",name:"Search",thumb:"/images/magnifier.png"};C.name="or look in page content for: "+A;C.url="/FindPage?SearchFor="+encodeURI(A);if(m=A.match(/^tag:(.*)/)){Util.tracking("autocomplete-tag-search",true);C={type:"label",name:"Pages tagged with "+m[1],thumb:"/images/tag_blue.png",url:"/FindPage?SearchFor="+encodeURI(A)}}$(gAcOutId).innerHTML="";if(!A.length){gIndicesOfMatches=new Array();gSelectionIndex=-1;gSelected=null;C=null;return }else{if(A!=gAcPreviousInputValue){gIndicesOfMatches=matching_elements(A)}gAcPreviousInputValue=A}var B="";var E=new Element("div",{"class":"content"});if(gIndicesOfMatches.length||C){if(C){var G=false;if(gSelectionIndex==-1){gSelected=C;G=true}E.appendChild(buildSearchListHeader(C,G))}var F;if(gIndicesOfMatches.length){F=new Element("ul");for(j=0;j<gIndicesOfMatches.length;j++){var D=gBundle[gIndicesOfMatches[j]];var G=false;if(j==gSelectionIndex){gSelected=D;G=true}F.appendChild(buildSearchListForItem(D,G,A));if(j>kMatchShowMax){break}}E.appendChild(F)}if(gIndicesOfMatches.length>kMatchShowMax){E.appendChild(new Element("div",{"class":"footer"}).update("&hellip; and "+(gIndicesOfMatches.length-kMatchShowMax)+" more"))}$(gAcOutId).appendChild(E)}}function buildSearchListHeader(A){var B=new Element("div",{"class":"header"});B.appendChild(new Element("a",{href:A.url}).update(A.name));return B}function buildSearchListForItem(N,J,F){var B=new Element("li",{"class":"acitem"});if(J){B.addClassName("active")}if(N.url){B.setAttribute("title",N.url)}var C=new Element("a");B.appendChild(C);if(N.url){C.href=N.url;C.observe("click",function(T){if(T.target&&T.target.parentElement&&T.target.parentElement.href){document.location.href=T.target.parentElement.href}});if(N.type&&N.type=="file"){C.target="_blank"}}else{if(N.members){C.observe("click",function(T){$(gAcInId).value="tag:"+this.name;gSelected=null;gSelectionIndex=-1;doStop=false;Event.stop(T);autocomplete_repaint()}.bind(N))}}var M=null;if(th=N.thumb){}else{if(N.type=="page"){th="/layout/common/icons/page_white_edit.png"}else{if(N.type=="tag"){th="/images/tag_blue.png"}}}if(th){var S=new Element("img");S.src=th;C.appendChild(S)}var I=N.name;if(gAcDressMatches&&F){var D=F.split(" ");for(t=0;t<D.length;t++){var R=D[t];if(!R.length){continue}var G=I;var A=R;if(gMatchedUsingLower){G=G.toLowerCase();R=A.toLowerCase()}var H=G.split(A);var E="";if(H.length>2){E=H.slice(2,H.length-1).join(A);H=H.slice(0,1)}if(H.length==2){var Q=I.substr(0,H[0].length);var O=I.substr(I.length-H[1].length,H[1].length);var P=I.substr(H[0].length,R.length);I=Q+'<span class="acqterm">'+P+"</span>"+O+E}}}var K=document.createTextNode(I);var L=new Element("span").appendChild(K);C.appendChild(L);return B;if(N.author&&(N.author!="unknown")){B+=' <span style="color:#8E3616">'+N.author.replace(" ","&nbsp;")+"</span>"}if(N.size){B+=' <span style="color:#777">'+n_readable(N.size)+"</span>"}if(N.mtime){B+=' <span style="color:#777">'+time_readable(N.mtime).replace(" ","&nbsp;")+"</span>"}if(N.url){B+="</a>"}B+="</li>";return B}function match_against_tag(A){bigArray=new Array();for(i in gBundle){if((gBundle[i].name==A)&&(gBundle[i].members)){for(j=0;j<gBundle[i].members.length;j++){for(k in gBundle){if(gBundle[k].name==gBundle[i].members[j]){bigArray.push(k)}}}}}return bigArray}function matching_elements(C){var D=new Array();if(!C){return D}strLower=C.toLowerCase();strToSearch=strLower;shouldLower=true;if(C&&(tma=C.match(/^tag:(.+)/))){return match_against_tag(tma[1])}if(C!=strLower){strToSearch=C;shouldLower=false}if(gAcCaseInsensitive){shouldLower=true;strToSearch=strLower}gMatchedUsingLower=shouldLower;var B=strToSearch.split(" ");for(i=0;i<gBundle.length;i++){if(!gBundle[i].name||!C||!C.length){continue}name=gBundle[i].name;if(shouldLower){name=name.toLowerCase()}if(B.length>=1){var A=true;for(k=0;k<B.length;k++){strSearchSub=B[k];if(!strSearchSub.length){continue}if(A&&(!name.match(strSearchSub))){A=false}}if(A){D.push(i)}}}return D}function n_readable(D){var A=["B","kB","mB","gB"];var B=A[0];var C="&nbsp;";for(i=1;i<A.length;i++){if(D>=1024){D/=1024;B=A[i]}}if(B==A[0]){return parseInt(D)+C+A[0]}return D.toPrecision(3)+C+B}function epoch_days(A){var C=new Date(A.toGMTString());var D=extractYear(C);var E=C.getMonth();var B=C.getDate();var F=(Date.UTC(D,E,B,0,0,0))/(86400*1000);return F}function time_readable(E){var D=new Date(parseInt(E)*1000);var C=new Date();var A=epoch_days(D);var F=epoch_days(C);var G=F-A;if(G<0){return""}unit="days";if(G>730){G=Math.floor(G/365);unit="yrs"}else{if(G>60){G=Math.floor(G/30);unit="mos"}else{if(G>14){G=Math.floor(G/7);unit="wks"}}}var B="";if(G==0){B+="today"}else{if(G==1){B+="yesterday"}else{B+=G+"&nbsp;"+unit+"&nbsp;ago"}}return B}function extractYear(A){x=A.getYear();var B=x%100;B+=(B<38)?2000:1900;return B}function setSelectionRange(C,D,A){if(is_gecko||is_safari){C.setSelectionRange(D,A)}else{D++;A++;var B=C.createTextRange();B.collapse(true);B.moveStart("character",D);B.moveEnd("character",A-D);B.select()}}function getSelectionStart(D){if(is_gecko||is_safari){return D.selectionStart}var C=document.selection.createRange();var B=C.compareEndPoints("StartToEnd",C)==0;if(!B){C.collapse(true)}var A=C.getBookmark();return A.charCodeAt(2)-2}function getSelectionEnd(D){if(is_gecko||is_safari){return D.selectionEnd}var C=document.selection.createRange();var B=C.compareEndPoints("StartToEnd",C)==0;if(!B){C.collapse(false)}var A=C.getBookmark();return A.charCodeAt(2)-2}var Droppables={drops:[],remove:function(A){this.drops=this.drops.reject(function(B){return B.element==$(A)})},removeAll:function(){this.drops=new Array()},add:function(B){B=$(B);var A=Object.extend({greedy:true,hoverclass:null,tree:false},arguments[1]||{});if(A.containment){A._containers=[];var C=A.containment;if(Object.isArray(C)){C.each(function(D){A._containers.push($(D))})}else{A._containers.push($(C))}}if(A.accept){A.accept=[A.accept].flatten()}A.element=B;this.drops.push(A)},findDeepestChild:function(A){deepest=A[0];for(i=1;i<A.length;++i){if(Element.isParent(A[i].element,deepest.element)){deepest=A[i]}}return deepest},isContained:function(B,A){var C;if(A.tree){C=B.treeNode}else{C=B.parentNode}return A._containers.detect(function(D){return C==D})},isAffected:function(A,C,B){return((B.element!=C)&&((!B._containers)||this.isContained(C,B))&&((!B.accept)||(Element.classNames(C).detect(function(D){return B.accept.include(D)})))&&Position.within(B.element,A[0],A[1]-((Prototype.Browser.WebKit)?40:0)))},deactivate:function(A){if(A.hoverclass){Element.removeClassName(A.element,A.hoverclass)}this.last_active=null},activate:function(A){if(A.hoverclass){Element.addClassName(A.element,A.hoverclass)}this.last_active=A},show:function(A,C){if(!this.drops.length){return }var B,D=[];this.drops.each(function(E){if(Droppables.isAffected(A,C,E)){D.push(E)}});if(D.length>0){B=Droppables.findDeepestChild(D)}if(this.last_active&&this.last_active!=B){this.deactivate(this.last_active)}if(B){Position.within(B.element,A[0],A[1]);if(B.onHover){B.onHover(C,B.element,Position.overlap(B.overlap,B.element))}if(B!=this.last_active){Droppables.activate(B)}}},fire:function(B,A){if(!this.last_active){return }Position.prepare();if(this.isAffected([Event.pointerX(B),Event.pointerY(B)],A,this.last_active)){if(this.last_active.onDrop){this.last_active.onDrop(A,this.last_active.element,B);return true}}},reset:function(){if(this.last_active){this.deactivate(this.last_active)}}};var Draggables={drags:[],observers:[],register:function(A){if(this.drags.length==0){this.eventMouseUp=this.endDrag.bindAsEventListener(this);this.eventMouseMove=this.updateDrag.bindAsEventListener(this);this.eventKeypress=this.keyPress.bindAsEventListener(this);Event.observe(document,"mouseup",this.eventMouseUp);Event.observe(document,"mousemove",this.eventMouseMove);Event.observe(document,"keypress",this.eventKeypress)}this.drags.push(A)},unregister:function(A){this.drags=this.drags.reject(function(B){return B==A});if(this.drags.length==0){Event.stopObserving(document,"mouseup",this.eventMouseUp);Event.stopObserving(document,"mousemove",this.eventMouseMove);Event.stopObserving(document,"keypress",this.eventKeypress)}},activate:function(A){if(A.options.delay){this._timeout=setTimeout(function(){Draggables._timeout=null;window.focus();Draggables.activeDraggable=A}.bind(this),A.options.delay)}else{try{window.focus()}catch(B){}this.activeDraggable=A}},deactivate:function(){this.activeDraggable=null},updateDrag:function(A){if(!this.activeDraggable){return }var B=[Event.pointerX(A),Event.pointerY(A)];if(this._lastPointer&&(this._lastPointer.inspect()==B.inspect())){return }this._lastPointer=B;this.activeDraggable.updateDrag(A,B)},endDrag:function(A){if(this._timeout){clearTimeout(this._timeout);this._timeout=null}if(!this.activeDraggable){return }this._lastPointer=null;this.activeDraggable.endDrag(A);this.activeDraggable=null},keyPress:function(A){if(this.activeDraggable){this.activeDraggable.keyPress(A)}},addObserver:function(A){this.observers.push(A);this._cacheObserverCallbacks()},removeObserver:function(A){this.observers=this.observers.reject(function(B){return B.element==A});this._cacheObserverCallbacks()},notify:function(B,A,C){if(this[B+"Count"]>0){this.observers.each(function(D){if(D[B]){D[B](B,A,C)}})}if(A.options[B]){A.options[B](A,C)}},_cacheObserverCallbacks:function(){["onStart","onEnd","onDrag"].each(function(A){Draggables[A+"Count"]=Draggables.observers.select(function(B){return B[A]}).length})}};var Draggable=Class.create({initialize:function(B){var C={handle:false,reverteffect:function(F,E,D){F.style.top=F.style.left=""},endeffect:function(E){var D=Object.isNumber(E._opacity)?E._opacity:1;E.setOpacity(1);Draggable._dragging[E]=false},zindex:1000,revert:false,quiet:false,scroll:false,scrollSensitivity:20,scrollSpeed:15,snap:false,delay:0};if(!arguments[1]||Object.isUndefined(arguments[1].endeffect)){Object.extend(C,{starteffect:function(D){D._opacity=Element.getOpacity(D);Draggable._dragging[D]=true;D.setOpacity(0.9)}})}var A=Object.extend(C,arguments[1]||{});this.element=$(B);if(A.handle&&Object.isString(A.handle)){this.handle=this.element.down("."+A.handle,0)}if(!this.handle){this.handle=$(A.handle)}if(!this.handle){this.handle=this.element}if(A.scroll&&!A.scroll.scrollTo&&!A.scroll.outerHTML){A.scroll=$(A.scroll);this._isScrollChild=Element.childOf(this.element,A.scroll)}if(!A.proxy){Element.makePositioned(this.element)}this.options=A;this.dragging=false;this.eventMouseDown=this.initDrag.bindAsEventListener(this);Event.observe(this.handle,"mousedown",this.eventMouseDown);Draggables.register(this)},destroy:function(){Event.stopObserving(this.handle,"mousedown",this.eventMouseDown);Draggables.unregister(this)},currentDelta:function(){return([parseInt(Element.getStyle(this.element,"left")||"0"),parseInt(Element.getStyle(this.element,"top")||"0")])},initDrag:function(A){if(!Object.isUndefined(Draggable._dragging[this.element])&&Draggable._dragging[this.element]){return }if(Event.isLeftClick(A)){var C=Event.element(A);if((tag_name=C.tagName.toUpperCase())&&(tag_name=="INPUT"||tag_name=="SELECT"||tag_name=="OPTION"||tag_name=="BUTTON"||tag_name=="TEXTAREA")){return }var B=[Event.pointerX(A),Event.pointerY(A)];var D=Position.cumulativeOffset(this.element);this.offset=[0,1].map(function(E){return(B[E]-D[E])});Draggables.activate(this);Event.stop(A)}},startDrag:function(C){this.dragging=true;if(!this.delta&&!this.options.proxy){this.delta=this.currentDelta()}if(this.options.zindex){this.originalZ=parseInt(Element.getStyle(this.element,"z-index")||0);this.element.style.zIndex=this.options.zindex}if(this.options.ghosting){this._clone=this.element.cloneNode(true);this.element._originallyAbsolute=(this.element.getStyle("position")=="absolute");if(!this.element._originallyAbsolute){Position.absolutize(this.element)}this.element.parentNode.insertBefore(this._clone,this.element)}if(this.options.proxy){this.oldElement=this.element;var B=new Element("div",{id:"proxy"}).setStyle({top:Event.pointerX(C)+"px",left:Event.pointerY(C)+"px",position:"absolute"}).addClassName("objectdragproxy");B=this.options.proxy(B,this.oldElement);document.body.appendChild(B);this.element=B}if(this.options.scroll){if(this.options.scroll==window){var A=this._getWindowScroll(this.options.scroll);this.originalScrollLeft=A.left;this.originalScrollTop=A.top}else{this.originalScrollLeft=this.options.scroll.scrollLeft;this.originalScrollTop=this.options.scroll.scrollTop}}Draggables.notify("onStart",this,C);if(this.options.starteffect){this.options.starteffect(this.element)}},updateDrag:function(event,pointer){if(!this.dragging){this.startDrag(event)}if(!this.options.quiet){Position.prepare();Droppables.show(pointer,this.element)}Draggables.notify("onDrag",this,event);this.draw(pointer);if(this.options.change){this.options.change(this)}if(this.options.scroll){this.stopScrolling();var p;if(this.options.scroll==window){with(this._getWindowScroll(this.options.scroll)){p=[left,top,left+width,top+height]}}else{p=Position.page(this.options.scroll);p[0]+=this.options.scroll.scrollLeft+Position.deltaX;p[1]+=this.options.scroll.scrollTop+Position.deltaY;p.push(p[0]+this.options.scroll.offsetWidth);p.push(p[1]+this.options.scroll.offsetHeight)}var speed=[0,0];if(pointer[0]<(p[0]+this.options.scrollSensitivity)){speed[0]=pointer[0]-(p[0]+this.options.scrollSensitivity)}if(pointer[1]<(p[1]+this.options.scrollSensitivity)){speed[1]=pointer[1]-(p[1]+this.options.scrollSensitivity)}if(pointer[0]>(p[2]-this.options.scrollSensitivity)){speed[0]=pointer[0]-(p[2]-this.options.scrollSensitivity)}if(pointer[1]>(p[3]-this.options.scrollSensitivity)){speed[1]=pointer[1]-(p[3]-this.options.scrollSensitivity)}this.startScrolling(speed)}if(Prototype.Browser.WebKit){window.scrollBy(0,0)}Event.stop(event)},finishDrag:function(B,E){this.dragging=false;if(this.options.quiet){Position.prepare();var D=[Event.pointerX(B),Event.pointerY(B)];Droppables.show(D,this.element)}if(this.options.ghosting){if(!this.element._originallyAbsolute){Position.relativize(this.element)}else{delete this.element._originallyAbsolute}Element.remove(this._clone);this._clone=null}if(this.options.proxy){this.element.remove();this.element=this.oldElement}var F=false;if(E){F=Droppables.fire(B,this.element);if(!F){F=false}}if(F&&this.options.onDropped){this.options.onDropped(this.element)}Draggables.notify("onEnd",this,B);var A=this.options.revert;if(A&&Object.isFunction(A)){A=A(this.element)}if(!this.options.proxy){var C=this.currentDelta()}if(A&&this.options.reverteffect){if(F==0||A!="failure"){this.options.reverteffect(this.element,C[1]-this.delta[1],C[0]-this.delta[0])}}else{this.delta=C}if(this.options.zindex){this.element.style.zIndex=this.originalZ}if(this.options.endeffect){this.options.endeffect(this.element)}Draggables.deactivate(this);Droppables.reset()},keyPress:function(A){if(A.keyCode!=Event.KEY_ESC){return }this.finishDrag(A,false);Event.stop(A)},endDrag:function(A){if(!this.dragging){return }this.stopScrolling();this.finishDrag(A,true);Event.stop(A)},draw:function(A){if(!this.options.proxy){var F=Position.cumulativeOffset(this.element);var E=this.currentDelta();F[0]-=E[0];F[1]-=E[1]}if(this.options.ghosting){var C=Position.realOffset(this.element);F[0]+=C[0]-Position.deltaX;F[1]+=C[1]-Position.deltaY}if(this.options.scroll&&(this.options.scroll!=window&&this._isScrollChild)){F[0]-=this.options.scroll.scrollLeft-this.originalScrollLeft;F[1]-=this.options.scroll.scrollTop-this.originalScrollTop}if(!this.options.proxy){var D=[0,1].map(function(G){return(A[G]-F[G]-this.offset[G])}.bind(this))}else{var D=[A[0]+20,A[1]]}if(this.options.snap){if(Object.isFunction(this.options.snap)){D=this.options.snap(D[0],D[1],this)}else{if(Object.isArray(this.options.snap)){D=D.map(function(G,H){return(G/this.options.snap[H]).round()*this.options.snap[H]}.bind(this))}else{D=D.map(function(G){return(G/this.options.snap).round()*this.options.snap}.bind(this))}}}var B=this.element.style;if((!this.options.constraint)||(this.options.constraint=="horizontal")){B.left=D[0]+"px"}if((!this.options.constraint)||(this.options.constraint=="vertical")){B.top=D[1]+"px"}if(B.visibility=="hidden"){B.visibility=""}},stopScrolling:function(){if(this.scrollInterval){clearInterval(this.scrollInterval);this.scrollInterval=null;Draggables._lastScrollPointer=null}},startScrolling:function(A){if(!(A[0]||A[1])){return }this.scrollSpeed=[A[0]*this.options.scrollSpeed,A[1]*this.options.scrollSpeed];this.lastScrolled=new Date();this.scrollInterval=setInterval(this.scroll.bind(this),10)},scroll:function(){var current=new Date();var delta=current-this.lastScrolled;this.lastScrolled=current;if(this.options.scroll==window){with(this._getWindowScroll(this.options.scroll)){if(this.scrollSpeed[0]||this.scrollSpeed[1]){var d=delta/1000;this.options.scroll.scrollTo(left+d*this.scrollSpeed[0],top+d*this.scrollSpeed[1])}}}else{this.options.scroll.scrollLeft+=this.scrollSpeed[0]*delta/1000;this.options.scroll.scrollTop+=this.scrollSpeed[1]*delta/1000}Position.prepare();Droppables.show(Draggables._lastPointer,this.element);Draggables.notify("onDrag",this);if(this._isScrollChild){Draggables._lastScrollPointer=Draggables._lastScrollPointer||$A(Draggables._lastPointer);Draggables._lastScrollPointer[0]+=this.scrollSpeed[0]*delta/1000;Draggables._lastScrollPointer[1]+=this.scrollSpeed[1]*delta/1000;if(Draggables._lastScrollPointer[0]<0){Draggables._lastScrollPointer[0]=0}if(Draggables._lastScrollPointer[1]<0){Draggables._lastScrollPointer[1]=0}this.draw(Draggables._lastScrollPointer)}if(this.options.change){this.options.change(this)}},_getWindowScroll:function(w){var T,L,W,H;with(w.document){if(w.document.documentElement&&documentElement.scrollTop){T=documentElement.scrollTop;L=documentElement.scrollLeft}else{if(w.document.body){T=body.scrollTop;L=body.scrollLeft}}if(w.innerWidth){W=w.innerWidth;H=w.innerHeight}else{if(w.document.documentElement&&documentElement.clientWidth){W=documentElement.clientWidth;H=documentElement.clientHeight}else{W=body.offsetWidth;H=body.offsetHeight}}}return{top:T,left:L,width:W,height:H}}});Draggable._dragging={};var SortableObserver=Class.create({initialize:function(B,A){this.element=$(B);this.observer=A;this.lastValue=Sortable.serialize(this.element)},onStart:function(){this.lastValue=Sortable.serialize(this.element)},onEnd:function(){Sortable.unmark();if(this.lastValue!=Sortable.serialize(this.element)){this.observer(this.element)}}});var Sortable={SERIALIZE_RULE:/^[^_\-](?:[A-Za-z0-9\-\_]*)[_](.*)$/,sortables:{},_findRootElement:function(A){while(A.tagName.toUpperCase()!="BODY"){if(A.id&&Sortable.sortables[A.id]){return A}A=A.parentNode}},options:function(A){A=Sortable._findRootElement($(A));if(!A){return }return Sortable.sortables[A.id]},destroy:function(A){var B=Sortable.options(A);if(B){Draggables.removeObserver(B.element);B.droppables.each(function(C){Droppables.remove(C)});B.draggables.invoke("destroy");delete Sortable.sortables[B.element.id]}},create:function(C){C=$(C);var B=Object.extend({element:C,tag:"li",dropOnEmpty:false,tree:false,treeTag:"ul",overlap:"vertical",constraint:"vertical",containment:C,handle:false,only:false,delay:0,hoverclass:null,ghosting:false,quiet:false,scroll:false,scrollSensitivity:20,scrollSpeed:15,format:this.SERIALIZE_RULE,elements:false,handles:false,onChange:Prototype.emptyFunction,onUpdate:Prototype.emptyFunction},arguments[1]||{});this.destroy(C);var A={revert:true,quiet:B.quiet,scroll:B.scroll,scrollSpeed:B.scrollSpeed,scrollSensitivity:B.scrollSensitivity,delay:B.delay,ghosting:B.ghosting,constraint:B.constraint,handle:B.handle};if(B.starteffect){A.starteffect=B.starteffect}if(B.reverteffect){A.reverteffect=B.reverteffect}else{if(B.ghosting){A.reverteffect=function(F){F.style.top=0;F.style.left=0}}}if(B.endeffect){A.endeffect=B.endeffect}if(B.zindex){A.zindex=B.zindex}var D={overlap:B.overlap,containment:B.containment,tree:B.tree,hoverclass:B.hoverclass,onHover:Sortable.onHover};var E={onHover:Sortable.onEmptyHover,overlap:B.overlap,containment:B.containment,hoverclass:B.hoverclass};Element.cleanWhitespace(C);B.draggables=[];B.droppables=[];if(B.dropOnEmpty||B.tree){Droppables.add(C,E);B.droppables.push(C)}(B.elements||this.findElements(C,B)||[]).each(function(H,F){var G=B.handles?$(B.handles[F]):(B.handle?$(H).select("."+B.handle)[0]:H);B.draggables.push(new Draggable(H,Object.extend(A,{handle:G})));Droppables.add(H,D);if(B.tree){H.treeNode=C}B.droppables.push(H)});if(B.tree){(Sortable.findTreeElements(C,B)||[]).each(function(F){Droppables.add(F,E);F.treeNode=C;B.droppables.push(F)})}this.sortables[C.id]=B;Draggables.addObserver(new SortableObserver(C,B.onUpdate))},findElements:function(B,A){return Element.findChildren(B,A.only,A.tree?true:false,A.tag)},findTreeElements:function(B,A){return Element.findChildren(B,A.only,A.tree?true:false,A.treeTag)},onHover:function(E,D,A){if(Element.isParent(D,E)){return }if(A>0.33&&A<0.66&&Sortable.options(D).tree){return }else{if(A>0.5){Sortable.mark(D,"before");if(D.previousSibling!=E){var B=E.parentNode;E.style.visibility="hidden";D.parentNode.insertBefore(E,D);if(D.parentNode!=B){Sortable.options(B).onChange(E)}Sortable.options(D.parentNode).onChange(E)}}else{Sortable.mark(D,"after");var C=D.nextSibling||null;if(C!=E){var B=E.parentNode;E.style.visibility="hidden";D.parentNode.insertBefore(E,C);if(D.parentNode!=B){Sortable.options(B).onChange(E)}Sortable.options(D.parentNode).onChange(E)}}}},onEmptyHover:function(E,G,H){var I=E.parentNode;var A=Sortable.options(G);if(!Element.isParent(G,E)){var F;var C=Sortable.findElements(G,{tag:A.tag,only:A.only});var B=null;if(C){var D=Element.offsetSize(G,A.overlap)*(1-H);for(F=0;F<C.length;F+=1){if(D-Element.offsetSize(C[F],A.overlap)>=0){D-=Element.offsetSize(C[F],A.overlap)}else{if(D-(Element.offsetSize(C[F],A.overlap)/2)>=0){B=F+1<C.length?C[F+1]:null;break}else{B=C[F];break}}}}G.insertBefore(E,B);Sortable.options(I).onChange(E);A.onChange(E)}},unmark:function(){if(Sortable._marker){Sortable._marker.hide()}},mark:function(B,A){var D=Sortable.options(B.parentNode);if(D&&!D.ghosting){return }if(!Sortable._marker){Sortable._marker=($("dropmarker")||Element.extend(document.createElement("DIV"))).hide().addClassName("dropmarker").setStyle({position:"absolute"});document.getElementsByTagName("body").item(0).appendChild(Sortable._marker)}var C=Position.cumulativeOffset(B);Sortable._marker.setStyle({left:C[0]+"px",top:C[1]+"px"});if(A=="after"){if(D.overlap=="horizontal"){Sortable._marker.setStyle({left:(C[0]+B.clientWidth)+"px"})}else{Sortable._marker.setStyle({top:(C[1]+B.clientHeight)+"px"})}}Sortable._marker.show()},_tree:function(E,B,F){var D=Sortable.findElements(E,B)||[];for(var C=0;C<D.length;++C){var A=D[C].id.match(B.format);if(!A){continue}var G={id:encodeURIComponent(A?A[1]:null),element:E,parent:F,children:[],position:F.children.length,container:$(D[C]).down(B.treeTag)};if(G.container){this._tree(G.container,B,G)}F.children.push(G)}return F},tree:function(D){D=$(D);var C=this.options(D);var B=Object.extend({tag:C.tag,treeTag:C.treeTag,only:C.only,name:D.id,format:C.format},arguments[1]||{});var A={id:null,parent:null,children:[],container:D,position:0};return Sortable._tree(D,B,A)},_constructIndex:function(B){var A="";do{if(B.id){A="["+B.position+"]"+A}}while((B=B.parent)!=null);return A},sequence:function(B){B=$(B);var A=Object.extend(this.options(B),arguments[1]||{});return $(this.findElements(B,A)||[]).map(function(C){return C.id.match(A.format)?C.id.match(A.format)[1]:""})},setSequence:function(B,C){B=$(B);var A=Object.extend(this.options(B),arguments[2]||{});var D={};this.findElements(B,A).each(function(E){if(E.id.match(A.format)){D[E.id.match(A.format)[1]]=[E,E.parentNode]}E.parentNode.removeChild(E)});C.each(function(E){var F=D[E];if(F){F[1].appendChild(F[0]);delete D[E]}})},serialize:function(C){C=$(C);var B=Object.extend(Sortable.options(C),arguments[1]||{});var A=encodeURIComponent((arguments[1]&&arguments[1].name)?arguments[1].name:C.id);if(B.tree){return Sortable.tree(C,arguments[1]).children.map(function(D){return[A+Sortable._constructIndex(D)+"[id]="+encodeURIComponent(D.id)].concat(D.children.map(arguments.callee))}).flatten().join("&")}else{return Sortable.sequence(C,arguments[1]).map(function(D){return A+"[]="+encodeURIComponent(D)}).join("&")}}};Element.isParent=function(B,A){if(!B.parentNode||B==A){return false}if(B.parentNode==A){return true}return Element.isParent(B.parentNode,A)};Element.findChildren=function(D,B,A,C){if(!D.hasChildNodes()){return null}C=C.toUpperCase();if(B){B=[B].flatten()}var E=[];$A(D.childNodes).each(function(G){if(G.tagName&&G.tagName.toUpperCase()==C&&(!B||(Element.classNames(G).detect(function(H){return B.include(H)})))){E.push(G)}if(A){var F=Element.findChildren(G,B,A,C);if(F){E.push(F)}}});return(E.length>0?E.flatten():[])};Element.offsetSize=function(A,B){return A["offset"+((B=="vertical"||B=="height")?"Height":"Width")]};Page.OrderSidebar={initialize:function(){if($("sidebarModules")){Sortable.SERIALIZE_RULE=/^[^_\-](?:[A-Za-z0-9\-\_]*)[:](.*)$/;var A=Sortable.create("sidebarModules",{tag:"div",handle:"header",onUpdate:Page.OrderSidebar.updateOrder})}},updateOrder:function(A){new Ajax.Request(UserPrefs.Manager.url,{postBody:Sortable.serialize(A)})}};PBwiki.init(Page.OrderSidebar);SearchHilite=Class.create({initialize:function(){if(/SearchFor\=/.test(window.location.search)){var C=window.location.search.replace(/[a-zA-Z0-9\?\&\=\%\#]+SearchFor\=(\w+)(\&.*)?/,"$1");var A=C.replace(/\%20|\+/g,"|");var B=A.split("|");this.highlight($("wikipage-inner"),B);this.highlight($("comments"),B)}},highlight:function(C,E){for(var B=0;B<E.length;B++){var D=new RegExp(">([^<]*)?("+E[B]+")([^>]*)?<","ig");var A=C.innerHTML;C.innerHTML=A.replace(D,'>$1<span class="searchhilitepage">$2</span>$3<')}}});PBwiki.init(SearchHilite);Page.AjaxSave={initialize:function(){if(PBwiki.feature("ajaxsave")){document.observe("ui:fckeditor_oncomplete",Page.AjaxSave.activate.bind(Page.AjaxSave))}},activate:function(){this.saveButton=$("edit-toolbar").down(".button");this.saveButton.observe("click",this.saveContent.bind(this));this.saveButton.setAttribute("onclick","");this.tagfield=$("tagfield");this.initialTags=this.tagfield.value;document.observe("ui:autosaveSuccess",this.autosaveSuccess.bind(this));document.observe("ui:autosaveFailure",this.autosaveFailure.bind(this));document.observe("ui:savepage",this.saveContent.bind(this))},saveContent:function(D){if(D){D.stop()}this.disableSave();this.setMsg("Saving "+PBwiki.getPageName().toString().escapeHTML()+"...",true);var C=[];var A=window.location.search.toQueryParams()||{};if(A.folder||A.security){var B={page:PBwiki.getPageName()};if(A.folder){B.folder=decodeURIComponent(A.folder.toString().replace(/\+/g," "))}if(A.security){B.security=A.security}C.push(["CreatePage",B,{onFailure:this.saveFail.bind(this),onSuccess:this.saveSuccess.bind(this),incUsess:true}])}var B={create_if_missing:true};B.page=PBwiki.getPageName();B.html=Page.AjaxEdit.getEditor().GetData(true);C.push(["PutPage",B,{onFailure:this.saveFail.bind(this),onSuccess:this.saveSuccess.bind(this),incUsess:true}]);C.push(["UnlockPage",{page:PBwiki.getPageName()},{onFailure:this.saveFail.bind(this)}]);if(this.initialTags!=this.tagfield.value){C.push(["SetPageTags",{page:PBwiki.getPageName(),tags:this.tagfield.value},{onFailure:this.saveFail.bind(this)}])}new PBwiki.MultiAPIRequest(C,{incUsess:true,onFailure:this.saveFail.bind(this)})},autosaveSuccess:function(){if(this.getMsg()==this.autosaveErrorMsg){this.clearMsg()}},autosaveFailure:function(A){if($("save_msg").style.display!="inline"){this.autosaveErrorMsg=A.memo;this.setMsg(A.memo)}},saveSuccess:function(B){Page.EditPage.cancel=true;this.setMsg("Page Saved Successfully",false,true);var A="/"+(B.page?B.page:PBwiki.getPageName());if(Prototype.Browser.WebKit){A+=((window.location.search.indexOf("?unlock=true")!=-1)?"":"?unlock=true")}A+="&saved=1";window.location=A},saveFail:function(B,A){if(A==403&&$H(PBwiki.getSessCookie()).values()[0]==""){this.setMsg("You have been logged out in another window.  Log back in and try again",false)}else{this.setMsg(B,false)}this.enableSave()},setMsg:function(B,A){var C=$("save_msg");C.style.display="inline";C.innerHTML=B;C.style.background=(A)?"url(/images/spin_bw.gif) no-repeat center left":"none"},clearMsg:function(){$("save_msg").style.display="none"},getMsg:function(){return $("save_msg").innerHTML},disableSave:function(){Page.EditPage.AutoSave.stop();this.saveButton.addClassName("disabled");this.saveButton.onclick=null;this.saveButton.setAttribute("href","javascript:void(0);");$("cancelButton").onclick=null;$("cancelButton").addClassName("disabled");try{this.saveButton.blur()}catch(A){}Page.EditPage.cancel=true},enableSave:function(){Page.EditPage.AutoSave.start();this.saveButton.removeClassName("disabled");$("cancelButton").removeClassName("disabled");Page.EditPage.cancel=false}};PBwiki.init(Page.AjaxSave);PBwiki.AutoComplete=function(){if($("input-search")){new PBwiki.Components.SearchAutoComplete({elm:$("input-search")})}};PBwiki.Components=PBwiki.Components||{};PBwiki.Components.AutoComplete=Class.create({initialize:function(A){if(!PBwiki.feature("autocomplete_v2")){return }this.options=A;this.elm=this.options.elm;this.container=new Element("div",{"class":"accontainer"});this.elm.insert({after:this.container});this.hide();this.acout=new Element("div",{id:"acout"});this.container.appendChild(this.acout);this.content=new Element("div",{"class":"content"});this.acout.appendChild(this.content);this.header=new Element("div",{"class":"header"});this.content.appendChild(this.header);this.ul=new Element("ul",{"class":"ul"});this.content.appendChild(this.ul);this.footer=new Element("div",{"class":"footer"});this.content.appendChild(this.footer);this.elm.observe("focus",this.addKeyListener.bind(this));this.elm.observe("blur",this.removeKeyListener.bind(this));this.elm.observe("blur",this.hide.bind(this));this.elm.up("form").observe("submit",this.onSearch.bind(this))},keyDown:function(F){if(this.elm.value!=""){this.show()}else{this.hide();return }var E=F.keyCode||F.charCode;if(E==Event.KEY_DOWN||E==Event.KEY_UP||E==Event.KEY_TAB){var D=this.ul.down("li.active");if(D){D.removeClassName("active")}if(E==Event.KEY_UP){var A=(D)?D.previous():this.ul.lastChild;if(!A){A=this.ul.lastChild}}else{if(E==Event.KEY_DOWN||E==Event.KEY_TAB){var A=(D)?D.next():this.ul.down();if(!A){A=this.ul.down()}}}if(A){PBwiki.info("adding selection");PBwiki.info(A);A.addClassName("active")}}else{var C="/FindPage?SearchFor="+encodeURIComponent(this.elm.value);var B=new Element("a",{href:C}).update("or look in page content for: "+this.elm.value).observe("mousedown",function(G){G.stop();window.location=C});this.header.update("");this.header.appendChild(B);this.keyPressed=true;if(this.refreshTimer){clearTimeout(this.refreshTimer)}PBwiki.info("doing refresh");this.hasData=PBwiki.Data.getInstance("DOMObjectListNonVerbose").hasData();this.refreshTimer=setTimeout(this.doRefresh.bind(this),(this.hasData)?10:200)}},doRefresh:function(){if(this.isLoading){return }this.isLoading=true;this.refreshTimer=null;Object.extend(this.requestOptions,{filter:this.elm.value});this.filter=this.elm.value;this.request=new PBwiki.APIRequest(this.apiMethod,this.requestOptions,{onSuccess:function(A){this.isLoading=false;this.draw(this.elm.value,A)}.bind(this),onFailure:function(A){this.isLoading=false}.bind(this),method:"get",priority:PBwiki.Data.HIGH_PRIORITY,cacheablility:["filetime","foldertime","pagetime","permtime"]})},draw:function(A,B){this.request=null;this.ul.update("");(B.objects.length==0)?this.ul.hide():this.ul.show();B.objects.each(function(G){var C=new Element("li",{"class":(G.type=="page")?"tbpage":"tbfile"});var F=Util.iconMap[Util.getFileExtension(G.name.toString())];var E=(G.type=="page")?"/"+Util.dashified_link(G.name.toString()):"/f/"+encodeURIComponent(G.name);C.observe("mousedown",function(H){H.stop();window.location=E});Util.addObjectTooltip(C,G);var D=new Element("a",{href:E});C.appendChild(D);D.appendChild(new Element("span").addClassName("fileicon").addClassName(F));D.appendChild(document.createTextNode(G.name.toString()));this.ul.appendChild(C)}.bind(this));if(B._total_count>10){this.footer.update("... and "+B._total_count+" more");this.footer.show()}else{this.footer.hide()}if(A!=this.elm.value&&!this.refreshTimer){this.refreshTimer=setTimeout(this.doRefresh.bind(this),10)}this.lastTxt=A;this.show()},drawLoading:function(){var A=new Element("li").update("Loading...");this.ul.update("");this.footer.hide()},onSearch:function(B){var A=this.ul.down("li.active");if(this.listener&&A){B.stop();window.location.href=A.down("a").getAttribute("href")}},addKeyListener:function(){PBwiki.info("add key listener");if(!this.listener){this.listener=this.keyDown.bindAsEventListener(this);$(document).observe("keyup",this.listener)}},removeKeyListener:function(){PBwiki.info("remove key listener");if(this.listener){$(document).stopObserving("keyup",this.listener);this.listener=null}},show:function(){this.container.show()},hide:function(){this.container.hide()}});PBwiki.Components.SearchAutoComplete=Class.create(PBwiki.Components.AutoComplete,{apiMethod:"GetObjects",requestOptions:{sortby:"mtime",reverse:true,count:10,offset:0,verbose:true,detail:"partial"}});PBwiki.init(PBwiki.AutoComplete);var PBconst=PBconst||{};Object.extend(PBconst,{kPolicyValidEmailRegex:"/^([a-zA-Z0-9])+([a-zA-Z0-9\\._+&'-])*@([a-zA-Z0-9-])+\\.([a-zA-Z0-9\\.-]+)+$/",kInvalidPageCharacters:".[]?&|/\\+#%",kMaxPageNameLength:100,kInvalidFileCharacters:"%$?\\/|`",kMaxFileNameLength:100,kInvalidFolderCharacters:".!@#$&%+'\"",kMaxFolderNameLength:127,kMaxWikiNameLength:50,kMinWikiNameLength:4,kPolicyValidWikiNameRegex:"/^[a-zA-Z0-9]+[a-zA-Z0-9-]*[a-zA-Z0-9]$/",kTrackingCookie:"pb_stat"});